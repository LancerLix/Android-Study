<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>

<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/hm.js"></script><script id="allmobilize" charset="utf-8" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/allmobilize.js"></script><style type="text/css"></style><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" media="handheld" href="#">

<meta http-equiv="Content-Type" content="text/html; charset=gbk">
<title>Android应用程序资源的查找过程分析 - 老罗的Android之旅 - 51CTO技术博客</title>
<meta name="description" content="&nbsp;&nbsp;&nbsp;&nbsp;我们知道，在Android系统中，每一个应用程序一般都会配置很多资源，用来适配不同密度、大小和方向的屏幕，以及适配不同的国家、地区和语言等等。这些资源是在应用程序运行时自动根据设备..">
<meta name="keywords" content="Resource,Android,AssetManager,setContentView,资源查找">
<meta http-equiv="Cache-Control" content="private">
<!-- base href="http://shyluo.blog.51cto.com/" -->
<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/def.js"></script>
<script language="javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/message.js" type="text/javascript"></script>
<script language="javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/user_comment.js" type="text/javascript"></script>
<script language="javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/base2.js" type="text/javascript"></script>
<script language="javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/dialog_utf8.js" type="text/javascript"></script>
<link href="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/31.css" rel="stylesheet" type="text/css">
<link rel="alternate" href="http://shyluo.blog.51cto.com/rss.php?uid=5725845" type="application/rss+xml" title="RSS 2.0">
<link rel="edituri" type="application/rsd+xml" title="rsd" href="http://shyluo.blog.51cto.com/xmlrpc.php?rsd=1">
<link href="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/header_master_top.css" rel="stylesheet" type="text/css">
<link href="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/base.css" rel="stylesheet" type="text/css">
<style type="text/css">
	.mainNav li a{display:inline-block}
</style>
<script>
var myid = "";
function add_flink(){
	if(myid==""){

        var refurlk = "http://shyluo.blog.51cto.com/5725845/1229259";

				//commentSubmit("",refurlk);
				location.href="http://home.51cto.com/index.php?reback="+encodeURIComponent(encodeURIComponent(refurlk));
				
				return false;
	}else{
		var mtk = "8bf4c698a90d573ec6429020ce7be64e";
      		var url='/mod/edit_flink.php?type=addflink&uid=5725845&flink=http://shyluo.blog.51cto.com&mtk='+mtk;
		var ajax = InitAjax1();
		ajax.open("GET", url, true);
		ajax.onreadystatechange = function() {
			if (ajax.readyState == 4 && ajax.status == 200) {
				/*if(myid == 5290427){
					alert(ajax.responseText);
				}*/
				if(ajax.responseText==""){
					alert("添加成功。");
				}
				if(ajax.responseText=="1"){
				alert("链接指向自己。");
				}
				if(ajax.responseText=="2"){
				alert("友情链接已存在。")
				}
				if(ajax.responseText=="4"){
					alert("验证已过期。")
					}
			}
		}
		ajax.send(null);
	}



}
function sendmessage(){

	var refurlk = "http://shyluo.blog.51cto.com/5725845/1229259";

	if(myid){
		return true;
	}else{
		commentSubmit("",refurlk);
		return false;
	}
}
function copylink(ourl){
	if(!ourl){
		var clipBoardContent = "http://shyluo.blog.51cto.com";
	}else{
		var clipBoardContent = ourl;
	}
	window.clipboardData.setData("Text",clipBoardContent);
	alert("复制成功!");
	return false;
}
function correctPNG() {
if (document.getElementById('blog_touxian'))
{
var img = document.getElementById('blog_touxian');
      var imgName = img.src.toUpperCase()
      var imgID = (img.id) ? "id='" + img.id + "' " : ""
      var imgClass = (img.className) ? "class='" + img.className + "' " : ""
      var imgTitle = (img.title) ? "title='" + img.title + "' " : "title='" + img.alt + "' "
      var imgStyle = "display:inline-block;" + img.style.cssText
      if (img.align == "left") imgStyle = "float:left;" + imgStyle
      if (img.align == "right") imgStyle = "float:right;" + imgStyle
      if (img.parentElement.href) imgStyle = "cursor:hand;" + imgStyle
      var strNewHTML = "<span " + imgID + imgClass + imgTitle
         + " style=\"" + "width:" + img.width + "px; height:" + img.height + "px;" + imgStyle + ";"
         + "filter:progid:DXImageTransform.Microsoft.AlphaImageLoader"
         + "(src=\'" + img.src + "\', sizingMethod='scale');\"></span>" ;
      img.outerHTML = strNewHTML;
}
}
//window.attachEvent("onload", correctPNG);
window.onload=correctPNG;

function copy(){
var text=document.getElementById("txtUser").value;
if(copy2Clipboard(text)!=false){ 
alert("复制成功了！ "); 
} 
}
function copy2Clipboard(txt){ 
if(window.clipboardData){ 
window.clipboardData.clearData(); 
window.clipboardData.setData("Text",txt); 
}else if(navigator.userAgent.indexOf("Opera")!=-1){ 
window.location=txt; 
}else if(window.netscape){ 
try{ 
netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"); 
} 
catch(e){ 
alert("您使用的浏览器不支持此复制功能，请使用Ctrl+C或鼠标右键。"); 
return false; 
} 
var clip=Components.classes['@mozilla.org/widget/clipboard;1'].createInstance(Components.interfaces.nsIClipboard); 
if(!clip)return; 
var trans=Components.classes['@mozilla.org/widget/transferable;1'].createInstance(Components.interfaces.nsITransferable); 
if(!trans)return; 
trans.addDataFlavor('text/unicode'); 
var str=new Object(); 
var len=new Object(); 
var str=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString); 
var copytext=txt;str.data=copytext; 
trans.setTransferData("text/unicode",str,copytext.length*2); 
var clipid=Components.interfaces.nsIClipboard; 
if(!clip)return false; 
clip.setData(trans,null,clipid.kGlobalClipboard); 
return true;
} 
}

function mod_close(){
  document.getElementById('mod_tg').style.display="none";
}

function match_invite(uid) {
    var url='/mod/match_invite.php';
	var ajax = InitAjax();
    var re = 'uid=' + uid;
	ajax.open("POST", url, true);
    ajax.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
	ajax.send(re);
    ajax.onreadystatechange = function() {
        if (ajax.readyState == 4 && ajax.status == 200) {
            if(ajax.responseText == 1){
                alert("邀请信息已经发送成功。");
            } else if(ajax.responseText=="-1"){
                alert("邀请失败，请稍候再试。");
            } else if(ajax.responseText=="2"){
                alert("该用户已经报名了。")
            }
        }
    }
}

</script>
<style type="text/css">
/*
.artContent img {max-width:450px !important;}
.showContent img{max-width:650px!important;}
*/

.artContent img{max-width: 450px; width:expression(this.width > 450 ? "450px" : this.width)}
/*
.showContent img{max-width: 450px; width:expression(this.width > 650 ? "650px" : this.width)}
*/


</style>
<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/share.js"></script><style id="table">
.showContent table.noBorderTable td,.showContent table.noBorderTable th,.showContent table.noBorderTable caption{border:1px dashed #ddd !important}.showContent table{margin-bottom:10px;border-collapse:collapse;display:table;}.showContent td,.showContent th{ background:white; padding: 5px 10px;border: 1px solid #DDD;}.showContent caption{border:1px dashed #DDD;border-bottom:0;padding:3px;text-align:center;}.showContent th{border-top:2px solid #BBB;background:#F7F7F7;}.showContent td p{margin:0;padding:0;}
.showContent table.noBorderTable td,.showContent table.noBorderTable th,.showContent table.noBorderTable caption{border:1px dashed #ddd !important}.showContent table{margin-bottom:10px;border-collapse:collapse;display:table;}.showContent td,.showContent th{ background:white; padding: 5px 10px;border: 1px solid #DDD;}.showContent caption{border:1px dashed #DDD;border-bottom:0;padding:3px;text-align:center;}.showContent th{border-top:2px solid #BBB;background:#F7F7F7;}.showContent td p{margin:0;padding:0;}</style><link rel="stylesheet" href="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/share_style1_32.css"></head>

<body>

<div id="home_top">
<div class="top_nav" style="width:990px;">
<div class="left" style="margin-top:10px; width:600px;"><a href="http://blog.51cto.com/" target="_blank"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/head_blog_sibebar_logo.gif" style="margin-top:-4px;" align="absmiddle"></a><!--<a target="_blank" href="http://www.51cto.com">51CTO首页</a>--><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/top_bg_xian.gif" style="margin-top:-4px;" width="16" height="25" align="absmiddle"><a href="http://blog.51cto.com/" target="_blank">首页</a><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/top_bg_xian.gif" style="margin-top:-4px;" width="16" height="25" align="absmiddle"><a href="http://home.51cto.com/?reback=http%253A%252F%252Fshyluo.blog.51cto.com%252F5725845%252F1229259">我的博客</a><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/top_bg_xian.gif" style="margin-top:-4px;" width="16" height="25" align="absmiddle">


   <a href="http://blog.51cto.com/artcommend">推荐博文</a>
    <img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/top_bg_xian.gif" style="margin-top:-4px;" width="16" height="25" align="absmiddle"><a href="http://blog.51cto.com/original/">最新原创</a>
    <img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/top_bg_xian.gif" style="margin-top:-4px;" width="16" height="25" align="absmiddle"><a href="http://blog.51cto.com/expert">专家博客</a>
    <img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/top_bg_xian.gif" style="margin-top:-4px;" width="16" height="25" align="absmiddle"><a href="http://blog.51cto.com/blogcommend">推荐博客</a>
    <img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/top_bg_xian.gif" style="margin-top:-4px;" width="16" height="25" align="absmiddle"><a target="_blank" href="http://so.51cto.com/">搜索</a>
    <!--<a href="javascript:void(0);" style="color:#FF0000; text-decoration:underline; display:none" id="showMessagerDim">每日博报</a>-->
</div>

<div class="right" style="width:380px;">
<div class="more"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/top_shequ.gif" width="27" height="16" align="absmiddle"><a href="javascript:viod(0);" onmouseout="popupClose()" onmouseover="show(3,this)">网站导航<img style="padding-left: 4px;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/nav_ico1.gif" align="absmiddle"></a>            </div>            <span id="login_status"><div class="login" style="padding-top:8px; text-align:right;"><a href="http://home.51cto.com/index?reback=http://shyluo.blog.51cto.com/5725845/1229259" target="_self">登录</a><a href="http://home.51cto.com/user/register?reback=http://shyluo.blog.51cto.com/5725845/1229259" target="_self">注册</a><a href="http://home.51cto.com/members/in-fo?down" target="_blank"><span class="jsVipDrop" style="position: relative;"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/vip_grey2.png" style="float:right; margin-top:5px"><div id="vip_mes_top" style="display:none;position: absolute;right:-75px;top: 17px;width: 137px;z-index: 99;"><div style="background: #faf7e6 none repeat scroll 0 0;border: 1px solid #ecb7a5;color: #666;font-size: 12px;padding: 3px 5px;position: relative;"><span style="background: rgba(0, 0, 0, 0) url(https://static3.51cto.com/home/web/images/hidearro.png) no-repeat scroll center center;display: inline-block;height: 7px;position: absolute;right: 57px;top: -6px;width: 12px;"></span><div style="color:#f60; text-align:center;">一个会员，全站特权</div></div></div></span></a></div></span>                </div>    </div></div>



<div class="subMenu3" id="s3" onmouseover="popupNoClose()" onmouseout="popupClose()">
<ul>

<li><a href="http://edu.51cto.com/" target="_blank">学院</a></li>
<li><a href="http://blog.51cto.com/" target="_blank">博客</a></li>
<li><a href="http://bbs.51cto.com/" target="_blank">论坛</a></li>
<li><a href="http://down.51cto.com/" target="_blank">下载</a></li>
    <li><a href="http://home.51cto.com/" target="_blank">家园</a></li>
<li><a href="http://wot.51cto.com/?blog" target="_blank">WOT峰会</a></li>
    <li><a href="http://www.51cto.com/" target="_blank">51CTO主站</a></li>
</ul>
</div>
<!--简导航end-->



<div class="headerBox">
<div class="header">
<div class="header_l">
<div class="logo_blogname">


<div class="blogLogo">
<a href="http://blog.51cto.com/blogcommend" target="_blank"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/blogLogo01.png" width="161px;" height="70px;"></a>
</div>


<div class="blogName">
<a href="http://shyluo.blog.51cto.com/"><h1>老罗的Android之旅</h1></a>
</div>
</div><!--logo_blogname end-->
<div class="blogLink">

<a href="http://shyluo.blog.51cto.com/">http://shyluo.blog.51cto.com</a> <input id="txtUser" size="32" value="http://shyluo.blog.51cto.com" type="hidden">   <a href="javascript:void(0);" onclick="copy();">【复制】</a> <a href="http://shyluo.blog.51cto.com/rss.php?uid=5725845" target="_blank"></a><a href="http://shyluo.blog.51cto.com/rss.php?uid=5725845" target="_blank">【订阅】</a>

</div>



</div><!--header_l end-->
<div class="header_r">
<div class="blogInfo"><span><a href="http://shyluo.blog.51cto.com/5725845/o" title="察看Luoshengyang所有原创文章">原创</a>:213</span><span><a href="http://shyluo.blog.51cto.com/5725845/t" title="察看Luoshengyang所有翻译文章">翻译</a>:0</span><span><a href="http://shyluo.blog.51cto.com/5725845/c" title="察看Luoshengyang所有转载文章">转载</a>:0</span></div>

</div>
</div>
<!--header end-->
</div><!--headerBox end-->
<div class="mainNav">
<span class="mainNavT"></span>
<ul>
<li><a href="http://shyluo.blog.51cto.com/">主页</a></li>|<li><a href="http://shyluo.blog.51cto.com/5725845/d-1">Android</a></li>|<li><a href="http://shyluo.blog.51cto.com/5725845/d-2">随笔感悟</a></li>
</ul>
<span class="mainNavB"></span>
</div>
<!--mainNav end-->


<style>
.wrap_box{width:750px;float:left;}
.box1{width:368px;background: #fff; border: 0px solid #626262;float:left;height: 162px;}
.mr10{margin-right:10px;}
.newcrumbox{ width:193px; margin:0 auto;}
.a_lsits a{display: inline-block;  height:22px; line-height:22px; padding-left: 28px; color:#555; border:1px solid #d6d6d6; border-radius: 3px; background: #efefef; font-size:12px; margin-bottom: 8px; text-decoration: none; background:url(https://s4.51cto.com/wyfs02/M01/98/95/wKiom1k-Wz6DbAw-AAAQL3nX74k572.png) no-repeat;}
.a_lsits .newicon_d{ width:55px;}
.a_lsits .newicon_l{ width:70px;}
.a_lsits .newicon_1{ background-position: 8px 4px;}
.a_lsits .newicon_2{ background-position: 8px -22px;}
.a_lsits .newicon_3{ background-position: 8px -49px;}
.a_lsits .newicon_4{ background-position: 8px -102px;}
.a_lsits .newicon_5{ background-position: 8px -74px;}
.a_listbot{ text-align: center; margin-top: 5px;}
.a_listbot a{ display: inline-block;font-size:12px;padding-left: 35px;background:url(https://s4.51cto.com/wyfs02/M01/98/95/wKiom1k-Wz6DbAw-AAAQL3nX74k572.png) no-repeat;height:22px; line-height:22px; color:#E93504;text-decoration: none;}
.a_listbot a.style_1{background-position: 8px -74px; }
.a_listbot a.style_2{background-position: 8px -131px;}
</style>
<script type="text/javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/jquery-1.js"></script>
<!--[if IE 6]>
  <script type="text/javascript" src="http://images.watchstor.com/newhomes/png.js"></script>
  <script>
    DD_belatedPNG.fix('img,input,ul,li, .get-box, div, .add, .sub, .ui-slider-handle, .footer-chopper');
  </script>
<![endif]-->
<link type="text/css" rel="stylesheet" href="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/fck_editorarea.css">
<script type="text/javascript" charset="gbk" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/shCores.js"></script>
<link rel="stylesheet" type="text/css" href="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/shCoreDefault.css">
<script type="text/javascript" charset="gbk" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/uparse.js"></script>
<script type="text/javascript">
	uParse('.showContent');
	$(function(){
		//SyntaxHighlighter.config.clipboardSwf = 'http://bbs.51cto.com/plugins/syntaxhighlighter/scripts/clipboard.swf';
		//为了在编辑器之外能展示高亮代码
		SyntaxHighlighter.highlight();
	});
</script>


<script type="text/javascript">
/**
 * 回复评论需要用的js
 * 2012-5-14
 * by:chengtao
 */
 jQuery(function(){
	blogpost.init();//初始化博客回复功能
 })
 /**
  * 处理博文评论功能优化
  */
 blogpost={
	abstruct_list:null,
	init:function(){
		blogpost.bind();//绑定一些时间
		this.abstruct_list=new Array();//初始化保存评论信息的数组
	},
	/**
	 * 博客回复需要绑定的一些事件
	 */
	bind:function(){
		/**
		 * 点击回复的事件
		 */
		jQuery('.repost').live('click',function(){
			blogpost.repost(jQuery(this).attr('user_name'),jQuery(this).attr('parentid'));
			return false;
		});
		/**
		 * 点击楼层进行翻页且找到锚点
		 */
		jQuery('.anchor_page').live('click',function(){
			var parentid = $(this).attr('parentid');
			var tid=$(this).attr('tid');
			$.get('/comments.php?tid='+tid+'&parentid='+parentid,function(data){
				$('#artcomment').html(data);
				window.location.hash=''+parentid;
			})
			return false;
		}),
		jQuery('.anchor_page').live('mouseover',function(){
			var parentid = $(this).attr('parentid');
			if(!blogpost.abstruct_list[parentid]){
				var this_t = $(this);
				$.get('/comments.php?cid='+parentid,function(data,textStatus){
					blogpost.abstruct_list[parentid]=data;
					this_t.attr('title',this_t.text()+':'+ blogpost.abstruct_list[parentid]);
				});
			}else{
				$(this).attr('title',$(this).text()+':'+blogpost.abstruct_list[parentid]);
			}
		})
	},
	/**
	 * @param user_name 用户名
	 * @param parentid  父评论id
	 */
	repost:function(user_name,parentid){
		window.location.hash='comment';
		jQuery('#parentid').val(parentid);
		jQuery('#commentcontent').val('回复 '+user_name+":\n").focus();
		if(!$.browser.mozilla){
			var elem = jQuery('#commentcontent')[0];
			var caretPos = elem.value.length;
			if (elem.createTextRange) {
				var range = elem.createTextRange();
				range.move('character', caretPos);
				range.select();
			}else{
				elem.setSelectionRange(caretPos, caretPos);
			}
		}
	},
	/**
	 * 发送完毕之后清理表单数据 不是ajax可能用不到
	 */
	clean:function(){

	}
 }
</script>
<script type="text/javascript">
jQuery(function(){
	var anchor = document.location.hash;
	var comment_id=anchor.split('#')[1];
	if(!isNaN(parseInt(comment_id))){//是整形
		jQuery.get('/comments.php?tid=1229259&parentid='+comment_id,function(data){
			jQuery('#artcomment').html(data);
			window.location.hash=''+comment_id;
		})
	}
});
</script>

<link type="text/css" rel="stylesheet" href="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/expert_show_layout.css">
<script type="text/javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/expert_show.js"></script>

<script type="text/javascript">
var is_login = false;
var task_rb = 'http://home.51cto.com/index.php?reback=http%253A%252F%252Fshyluo.blog.51cto.com%252F5725845%252F1229259';
</script>




<script type="text/javascript">
jQuery(function() {
	jQuery('#favourdiv').mouseover(function(){
		if(jQuery(this).attr('className') == 'support01')
		{
			jQuery(this).attr('className', "support02");
			jQuery(this).html('+1人');
			jQuery(this).attr('title', "赞一个，我支持TA");
		}
		else if(jQuery(this).attr('className') == 'support03')
		{
			jQuery(this).attr('title', "你已经赞了这篇博文！");
		}

	});
	jQuery('#favourdiv').mouseout(function(){
		if(jQuery(this).attr('className') == 'support02')
		{
			jQuery(this).attr('className', "support01");
			jQuery(this).html("0人");
		}
	});
	jQuery('.blog_match_yq').click(function(){
		var wind_uid = '';
		if(!wind_uid){
			alert("请先登录！");
			return false;
		}
		jQuery.ajax({
			   type: "POST",
			   url:"/contest2012/index.php?mod=sendmsg",
			   dataType: "html",
			   data: "vuid=" + 5725845,
			   success: function(data) {
					if(data == 0)
					{
						alert("查无此人！");
						return false;
					}else if(data == 1){
						alert("请先登录！");
						return false;
					}else if(data == 2){
						alert("不能邀请自己！");
						return false;
					}else if(data == 22){
						alert("邀请信息已发出！");
						return false;
					}
			   }
		  });
	});
	jQuery('#favourdiv').click(function(){
			jQuery.ajax({
			   type: "POST",
			   url:"/mod/favour.php",
			   dataType: "html",
			   data: "tid=" + 1229259,
			   success: function(data) {
					if(data == 0)
					{
						alert("您还未登录或者已过期，请重新登录");
						location.href = "http://home.51cto.com/index.php?reback=http%253A%252F%252Fshyluo.blog.51cto.com%252F5725845%252F1229259";
						return false;
					}
					else if(data == '-1')
					{
						alert("参数传递错误！");
						return false;
					}
					else if(data == '-2')
					{
						alert("该博文已被删除或者不存在！");
						return false;
					}
					else if(data == '-3')
					{
						alert("您已经赞过了！");
						return false;
					}
					else if(data == '-4')
					{
						alert("赞操作失败！");
						return false;
					}
					else
					{
						//alert("操作成功，你已经赞了这篇博文！");
						jQuery('#favourdiv').attr('className', "support03");

						var num = 0 + 1 + "人";
						jQuery('#favourdiv').html(num);
						jQuery('#favourer').html(data);
						return false;
					}
			   }
		  });
	});
	//Jaydar http://blog.51cto.com/js/header.php?uid=blogdb[uid]&tid=tid
	jQuery.post('/js/header.php',{uid:5725845,tid:1229259},function(data){
		jQuery('#readNum').html(data[0]);
		jQuery('#cmtNum').html(data[1]);
	},'json');


})

jQuery(function(){
	jQuery('#darid').bind('click',function(){
		if(confirm("你确定删除此篇文章？")){
			jQuery.ajax({
				'type':'post',
				'url':'user_index.php?action=delarticle',
				'data':{'job':'del', 'selid':'1229259', 'mhash':''},
				'dataType':'html',
				'success':function(res){
					if('ok' == res){
						location.href="http://.blog.51cto.com";
					}

				}
			});
		}
	});
});
</script>




<style type="text/css">
.m_sharelinks{
	line-height:30px;
	text-align:left;
	padding-left:20px;
	//background:url(http://img1.51cto.com/images/share/ico_lb.gif) no-repeat left center;
	float:left;
	width:600px;
	height:30px;
}
.m_sharelinks a{ margin-left:10px;}
.m_sharebtn{ height:50px; width:726px; margin:0 auto;}
.m_sharebtn01{width:520px; float:left;}
.weibo_51cto{ background:url(http://img1.51cto.com/images/share/ico_mweibo.gif) no-repeat center center; display:block; width:33px; height:33px; float:left; margin:3px 3px 0 0;cursor:pointer;}
.shareMored {
    line-height: 30px;
	float:right;
	text-align:right;
	width:100px;
	height:30px;
}

.showContent {
	margin:20px 15px 8px;
}
.userImage img {
    text-align: center;
	border:0;
	padding:0;
}
.photo_links{ line-height:30px; padding-top:5px; font-size:13px;width:170px; margin:0 auto;}
.photo_links_blue{ text-align:center;}
.photo_links_blue a:link,.photo_links_blue a:visited,.photo_links_blue a:hover,.photo_links_blue a:active{ color:#015F91; text-decoration: underline;}
.photo_links_red{ text-align:left;}
.photo_links_red a:link,.photo_links_red a:visited,.photo_links_red a:hover,.photo_links_red a:active{ color:#fc4343; text-decoration:underline;}
.photo_links_red02{ text-align:center;}

.vlist{ margin:10px 10px; height:65px;}
.vlist img{ float:left; margin-right:10px;}
.vlist dl{ text-align:left;}
.vlist dl dt{ height:40px;line-height: 20px; overflow:hidden; padding-top:5px;}
.vlist dl dt,.vlist dl dt a{ color:#262626;}
.vlist dl dd,.vlist dl dd a{ color:#777;}

.video-icon{
    position: relative;
}
.video-icon a.i_video {
    background: url("http://www.51cto.com/images/homepage/Images/eduplay.png") repeat scroll 0 0 rgba(0, 0, 0, 0);
    display: block;
    height: 25px;
    left:31px;
    position: absolute;
    top:22px;
    width: 25px;
    z-index: 10;
}

.ipadFload{ position:fixed; width:136px; height:194px; background:url("http://bbs.51cto.com/images/IPad-bg.png") left top no-repeat #fff; font-family:"微软雅黑"; padding-left:18px;}
.ipadClose{ text-align:right; font-size:14px; line-height:20px;}
.ipadImg{ padding-top:38px;}
.ipadImg img{ width:105px; height:105px;}
.iPadair2{ font-size:12px;}
.iPadair2 a{ color:#659b01; text-decoration:none; background:url("http://bbs.51cto.com/images/51CTO-IPAD-BOTTOM.png") right center no-repeat; display:block; line-height:30px;}

</style>
<div id="add_sys_type_div" style="width:600px;border:1px #58B0DD solid; background-color:#FFF; position:absolute;left:30%;top:300px;display:none;z-index:255"></div>
<div id="add_sys_type_dvs" style="width:550px;border:1px #58B0DD solid; background-color:#FFF; position:absolute;left:30%;top:300px;display:none;z-index:255"></div>




<div class="blogMain">
<div class="blogLeft" style="overflow: visible;">


<div class="box moduleUser">
<div class="title">
<h2><a href="http://shyluo.blog.51cto.com/"><strong>Luoshengyang</strong> 的BLOG  </a></h2>
<div class="floatimg" style="display:none"></div></div>
<div class="modCon">

<div class="blogLevel" uid="5725845"><a href="http://blog.51cto.com/expert" target="_blank" style="display:block;width:46px;height:62px;text-indent:-999px;"><!--<img src="http://blog.51cto.com/image/skin/31.css/zj.png">--></a></div>

<div class="userImage" style="margin: 10px auto 5px;text-align: center;width: 130px;border: 1px solid #D4D4D4;">
	<table width="100%" cellspacing="0" cellpadding="0">
		<tbody><tr>
			<td class="position_r" valign="middle" height="130" align="center"><a href="http://shyluo.blog.51cto.com/"><script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/userface.htm"></script><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar.jpg" id="userface"></a></td>
		</tr>
	</tbody></table>
</div>
<div class="photo_links">
</div>









<div style="width:179px; height:54px; margin:0 auto; clear:both;">
		<a href="http://blog.51cto.com/contest2012/5725845" target="_blank"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/jcbk10.gif"></a>
	</div>

    <div class="newcrumbox">
        <div class="a_lsits">
            <a href="http://home.51cto.com/index.php?s=/Notify/write/uid/5725845" class="newicon_3 newicon_d">发私信</a>
            <a href="http://shyluo.blog.51cto.com/" onclick="add_flink(5725845);return false" class="newicon_5 newicon_l">加友情链接</a>
        </div>
    </div>

<div style="width:239px;height:64px;display:none;">


<div style="float:left;"><p style="padding:15px 0 0 28px; line-height:20px;">2012年度IT博客大赛<br><a target="_blank" href="http://blog.51cto.com/contest2012/#top10000" style="color:#F00; text-decoration:underline;">十大杰出IT博客诞生</a></p></div>
<div style="float:right;"><a target="_blank" href="http://blog.51cto.com/contest2012/5725845"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/blog_match_endlook.jpg" style="margin:23px 20px 0 0;" width="57" height="27"></a></div>



<div class="clear"></div>
</div>


</div><!--modCon end-->
<span class="modBot"></span>
</div>


<div class="infoList box">
<div class="title">
<h2>博客统计信息</h2>
</div>
<div class="modCon">
<p>
<span class="infoListHead"><a href="http://blog.51cto.com/expert" target="_blank" class="operlink"><b>51CTO专家博客</b></a> <a href="http://blog.51cto.com/blogcommend" target="_blank" class="operlink"><b>51CTO推荐博客</b></a> <br></span>
用户名：Luoshengyang<br>
文章数：213<br>
评论数：40<br>
访问量：251844<br>
<a href="http://home.51cto.com/index.php?s=/Account/credit" target="_blank">无忧币</a>：60<br>
<a href="http://51ctoblog.blog.51cto.com/26414/5591" target="_blank">博客积分</a>：2140<br>
<a href="http://51ctoblog.blog.51cto.com/26414/5591" target="_blank">博客等级</a>：6<br>
注册日期：2012-08-13<br>
</p>
</div>
<span class="modBot"></span>
</div>


<div class="infoList box">
	<div class="title">
		<h2 class="fl">热门专题</h2>
		<a target="_blank" class="fr" href="http://blog.51cto.com/zt">更多&gt;&gt;</a>
	</div>
	<div class="modCon" style="height: 348px;">


		<div class="vlist">
		  <a href="http://blog.51cto.com/zt/705" target="_blank"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/wKioL1kxBvqDXivDAAA4F7mg1So675.jpg" width="63" height="63"></a>
		<dl>
		<dt>
		  <a href="http://blog.51cto.com/zt/705" target="_blank" title="Oracle零基础成长之路">Oracle零基础成长之路</a></dt>
		<dd>阅读量：1297</dd>
		</dl>
		</div>

		<div class="vlist">
		  <a href="http://blog.51cto.com/zt/706" target="_blank"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/wKioL1k_SpejGPpUAAA3gnotfPU742.png" width="63" height="63"></a>
		<dl>
		<dt>
		  <a href="http://blog.51cto.com/zt/706" target="_blank" title="原来你也在这里（征文）">原来你也在这里（征文）</a></dt>
		<dd>阅读量：3317</dd>
		</dl>
		</div>

		<div class="vlist">
		  <a href="http://blog.51cto.com/zt/14" target="_blank"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1304672337_index.jpg" width="63" height="63"></a>
		<dl>
		<dt>
		  <a href="http://blog.51cto.com/zt/14" target="_blank" title="从菜鸟到老鸟-教你玩转Mac操作系统">从菜鸟到老鸟-教你玩转Mac操作系统</a></dt>
		<dd>阅读量：448317</dd>
		</dl>
		</div>

		<div class="vlist">
		  <a href="http://blog.51cto.com/zt/20" target="_blank"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1306310178_index.jpg" width="63" height="63"></a>
		<dl>
		<dt>
		  <a href="http://blog.51cto.com/zt/20" target="_blank" title="QT学习之路：从入门到精通">QT学习之路：从入门到精通</a></dt>
		<dd>阅读量：1133261</dd>
		</dl>
		</div>


	</div>
	<span class="modBot"></span>
</div>


<div class="hotArt box">
<div class="title">
<h2>热门文章</h2>
</div>
<div class="modCon">
<ul>
<li><a href="http://shyluo.blog.51cto.com/5725845/1091894">“2012年度IT博客大赛”..</a></li>
<li><a href="http://shyluo.blog.51cto.com/5725845/1338267">从NDK在非Root手机上的调..</a></li>
<li><a href="http://shyluo.blog.51cto.com/5725845/967027">Android系统的开机画面显..</a></li>
<li><a href="http://shyluo.blog.51cto.com/5725845/965994">Android应用程序启动过程..</a></li>
<li><a href="http://shyluo.blog.51cto.com/5725845/967043">Android系统的开机画面显..</a></li>
<li><a href="http://shyluo.blog.51cto.com/5725845/1229285">Android窗口管理服务Wind..</a></li>
<li><a href="http://shyluo.blog.51cto.com/5725845/966525">Android系统默认Home应用..</a></li>
<li><a href="http://shyluo.blog.51cto.com/5725845/966609">Android应用程序键盘（Ke..</a></li>

</ul>
</div>
<span class="modBot"></span>
</div>
<div class="search box">
<div class="title"><h2>搜索BLOG文章</h2></div>
<div class="modCon">
<form method="post" action="search.php?" tabindex="99">
<input name="step" value="2" type="hidden">
<input name="authorid" value="5725845" type="hidden">
<input name="sch_area" value="S" type="hidden">
<input name="keyword" class="searchInput" type="text">
<input value="搜 索" class="searchBtn" type="submit">
</form>
</div><!--modCon end-->
<span class="modBot"></span>
</div>


<div class="box recentGuests">
<div class="title">
<h2>最近访客</h2>
</div>
<div class="modCon">
<ul>

<li><a href="http://10779018.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_008.gif"></a>


<p><a href="http://10779018.blog.51cto.com/">yahos..</a></p>

</li><li><a href="http://5233354.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_011.gif"></a>


<p><a href="http://5233354.blog.51cto.com/">jt705</a></p>

</li><li><a href="http://12923574.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_004.gif"></a>


<p><a href="http://12923574.blog.51cto.com/">Anrui..</a></p>

</li><li><a href="http://2154555.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_007.gif"></a>


<p><a href="http://2154555.blog.51cto.com/">zhupe..</a></p>

</li><li><a href="http://9814162.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_009.gif"></a>


<p><a href="http://9814162.blog.51cto.com/">我是幻神</a></p>

</li><li><a href="http://13058061.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_002.gif"></a>


<p><a href="http://13058061.blog.51cto.com/">wx595..</a></p>

</li><li><a href="http://13153902.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar.gif"></a>


<p><a href="http://13153902.blog.51cto.com/">oolllpp</a></p>

</li><li><a href="http://10868928.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_005.gif"></a>


<p><a href="http://10868928.blog.51cto.com/">zqnxyz</a></p>

</li><li><a href="http://3075256.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_002.jpg"></a>


<p><a href="http://3075256.blog.51cto.com/">残狼吞月</a></p>

</li><li><a href="http://10265097.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_003.gif"></a>


<p><a href="http://10265097.blog.51cto.com/">哈哈..</a></p>

</li><li><a href="http://1820902.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_006.gif"></a>


<p><a href="http://1820902.blog.51cto.com/">cyminge</a></p>

</li><li><a href="http://6820351.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_010.gif"></a>


<p><a href="http://6820351.blog.51cto.com/">gj1203</a></p>

</li></ul>
<span class="clear"></span>
</div>
<span class="modBot"></span>
</div>


<div class="newComments box">
<div class="title">
<h2>最新评论

</h2>



</div>
<div class="modCon">
<ul>

<li><a href="http://5542675.blog.51cto.com/" class="operlink" target="_blank"><b>会飞的神</b></a>：<a href="http://shyluo.blog.51cto.com/5725845/1890906" target="_blank">技术大神的世界就是不一样啊</a></li>

<li><a href="http://9695178.blog.51cto.com/" class="operlink" target="_blank"><b>我愿乘峰</b></a>：<a href="http://shyluo.blog.51cto.com/5725845/965994" target="_blank">uml流程图看不清楚</a></li>

<li><a href="http://8233697.blog.51cto.com/" class="operlink" target="_blank"><b>JM_TD</b></a>：<a href="http://shyluo.blog.51cto.com/5725845/1338267" target="_blank">为什么点击这篇文章里的链接都显示404</a></li>

<li><a href="http://7831224.blog.51cto.com/" class="operlink" target="_blank"><b>smth_flydream</b></a>：<a href="http://shyluo.blog.51cto.com/5725845/967084" target="_blank">那其中的vsync_len和hsync_len有什..</a></li>

<li><a href="http://cthhqu.blog.51cto.com/" class="operlink" target="_blank"><b>cthhqu</b></a>：<a href="http://shyluo.blog.51cto.com/5725845/965994" target="_blank">老罗，这篇文章第一张图，也就是那..</a></li>


</ul>
</div>
<span class="modBot"></span>
</div>


<div class="hotBlogArt box">
<div class="title">
  <h2 class="fl">51CTO推荐博文</h2>
  <a href="http://blog.51cto.com/artcommend" class="fr">更多&gt;&gt;</a></div>
<div class="modCon">
<ul>
<li><a href="http://xiaofw.blog.51cto.com/50361/1934224" title="51CTO博客移动化意味着什么？IT博主可以搞事情了！" target="_blank">51CTO博客移动化意味着什么？IT博..</a></li>
<li><a href="http://1754966750.blog.51cto.com/7455444/1919608" title="ActiveMQ（13）：ActiveMQ的集群" target="_blank">ActiveMQ（13）：ActiveMQ的集群</a></li>
<li><a href="http://namesam.blog.51cto.com/12364721/1913232" title="MySQL高可用解决方案MMM" target="_blank">MySQL高可用解决方案MMM</a></li>
<li><a href="http://hubuxcg.blog.51cto.com/2559426/1911803" title="迁移Exchange队列至其它服务器继续传送队列邮件" target="_blank">迁移Exchange队列至其它服务器继..</a></li>
<li><a href="http://renzhiyuan.blog.51cto.com/10433137/1902287" title="HAProxy Nginx LVS Apache总结篇" target="_blank">HAProxy Nginx LVS Apache总结篇</a></li>
<li><a href="http://renzhiyuan.blog.51cto.com/10433137/1898689" title="一次和公司总监的聊天..." target="_blank">一次和公司总监的聊天...</a></li>
<li><a href="http://weiweidefeng.blog.51cto.com/1957995/1895261" title="Linux轻量级自动运维工具-Ansible浅析" target="_blank">Linux轻量级自动运维工具-Ansible..</a></li>
<li><a href="http://yolynn.blog.51cto.com/11575833/1886151" title="运维工作中的bootstraping之PXE自动安装操作系统" target="_blank">运维工作中的bootstraping之PXE自..</a></li>
<li><a href="http://xmdevops.blog.51cto.com/11144840/1877695" title="消息队列_RabbitMQ-0002.深入MQ生产者/信道/交换机/队列/消费者?" target="_blank">消息队列_RabbitMQ-0002.深入MQ生..</a></li>
<li><a href="http://zhang789.blog.51cto.com/11045979/1873435" title="高可用高性能负载均衡软件HAproxy详解指南-第二章（配置文件、关键字、ACL）" target="_blank">高可用高性能负载均衡软件HAproxy..</a></li>
<li><a href="http://jackcui.blog.51cto.com/11877206/1858989" title="由浅入深学习Apache httpd原理与配置" target="_blank">由浅入深学习Apache httpd原理与配置</a></li>

</ul>
</div><!--modCon end-->
<span class="modBot"></span>
</div>


<div class="friendLink box">
<div class="title">
  <h2>友情链接</h2>
</div>
<div class="modCon">
<ul>

<li><a href="http://chenguang.blog.51cto.com/" title="李晨光原创技术博客" target="_blank">李晨光原创技术博客</a></li>

</ul>
</div><!--modCon end-->
<span class="modBot"></span>
</div>



</div>
<!--left end-->

<script type="text/javascript">
    var favor_url = "http://shyluo.blog.51cto.com/5725845/1229259";
    var favor_title = "Android应用程序资源的查找过程分析";
    var favor_fuid = "5725845";
</script>
<script type="text/javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/favorbox.js"></script>


<div class="blogRight" rel="5725845######Resource Android AssetManager setContentView 资源查找" id="article_edu_void">
<input value="8" id="edu_jia" type="hidden">

	<!--<p style="clear:both;"  class="edu_insert"></p>-->
	<style type="text/css">
.vlist {
    float: left;
    padding: 2px 0 0 10px;
    width: 218px;

}
.vlist img {
    float: left;
    margin-right: 10px;
}
.vlist dl {
    float: left;
    text-align: left;
    width: 122px;
}
.vlist dl dt {
    height: 44px;
    overflow: hidden;
    padding-top: 5px;
}
.vlist dl dt, .vlist dl dt a {
    color: #262626;
}
.vlist dl dd, .vlist dl dd a {
    color: #777777;
}
.vbox_tit {
    border-bottom: 1px solid #B3D0E6;
    color: #666666;
    font-size: 14px;
    margin-top: 10px;
    text-align: left;
}
.video-icon {
    position: relative;
}
.video-icon a.i_video {
    background: url("http://www.51cto.com/images/homepage/Images/eduplay.png") repeat scroll 0 0 rgba(0, 0, 0, 0);
    display: block;
    height: 25px;
    left: 41px;
    position: absolute;
    top: 22px;
    width: 25px;
    z-index: 10;
}
.vbox2 .vlist1{margin:0;}
.edu-col-a{ float:left;margin-right:6px;}
.edu-col-b{ float:left;}
	</style><!--modCon end-->
	<div class="artShow box" style="margin-top:5px;">
   	  <div class="share" id="share">

    <div class="shareItem">
		<div class="m_sharelinks"><a target="_blank" href="" style="color:red;"></a><a target="_blank" href="" style="color:blue;"></a><a target="_blank" href="" style="color:blue;"></a></div>
		<p class="shareMored"><a href="http://shyluo.blog.51cto.com/all/5725845">博主的更多文章&gt;&gt;</a></p>
	</div>
      </div>
       <div class="modCon">
   	  <div class="showBox" style="margin:0 0 10px;">
      <div class="line_hd_r"></div>
      <div class="art_tj">

      </div>


    		<div class="showHead">
    		  <div class="showTitleBOx" style="text-align:center">
              <div class="showTitle">

             <img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/artType01.jpg">


    		    Android应用程序资源的查找过程分析
                </div>
  		    </div>
   		    <span class="artTime">2013-04-28 00:56:00</span></div><!--showHead end-->
    <div class="showTags">标签：<a href="http://blog.51cto.com/tag-Resource.html" target="_blank" class="operlink">Resource</a> <a href="http://blog.51cto.com/tag-Android.html" target="_blank" class="operlink">Android</a> <a href="http://blog.51cto.com/tag-AssetManager.html" target="_blank" class="operlink">AssetManager</a> <a href="http://blog.51cto.com/tag-setContentView.html" target="_blank" class="operlink">setContentView</a> <a href="http://blog.51cto.com/tag-%E8%B5%84%E6%BA%90%E6%9F%A5%E6%89%BE.html" target="_blank" class="operlink">资源查找</a>

	</div>

			<div class="CopyrightStatement lh22">
            原创作品，允许转载，转载时请务必以超链接形式标明文章 <a href="http://shyluo.blog.51cto.com/5725845/1229259" target="_blank" style="text-decoration:underline">原始出处</a> 、作者信息和本声明。否则将追究法律责任。<a href="http://shyluo.blog.51cto.com/5725845/1229259">http://shyluo.blog.51cto.com/5725845/1229259</a>
            </div>


            <!--正文 begin-->


		  <div class="showContent">
    		  <p> &nbsp; &nbsp; &nbsp; 
&nbsp;我们知道，在Android系统中，每一个应用程序一般都会配置很多资源，用来适配不同密度、大小和方向的屏幕，以及适配不同的国家、地区和
语言等等。这些资源是在应用程序运行时自动根据设备的当前配置信息进行适配的。这也就是说，给定一个相同的资源ID，在不同的设备配置之下，查找到的可能
是不同的资源。这个资源查找过程对应用程序来说，是完全透明的。在本文中，我们就详细分析资源管理框架是如何根据ID来查找资源的。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;从前面<a href="http://shyluo.blog.51cto.com/5725845/1229260" target="_blank">Android应用程序资源管理器（Asset Manager）的创建过程分析</a>一
文可以知道，Android资源管理框架实际就是由AssetManager和Resources两个类来实现的。其中，Resources类可以根据
ID来查找资源，而AssetManager类根据文件名来查找资源。事实上，如果一个资源ID对应的是一个文件，那么Resources类是先根据ID
来找到资源文件名称，然后再将该文件名称交给AssetManager类来打开对应的文件的，这个过程如图1所示。</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1366046940_6832.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图1 应用程序查找资源的过程示意图</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;在图1中，Resources类根据资源ID来查到资源名称实际上也是要通过AssetManager类来实现的，这是因为资源ID与资源名
称的对应关系是由打包在APK里面的resources.arsc文件中的。当Resources类查找的资源对应的是一个文件的时候，它就会再次将资源
名称交给AssetManager，以便后者可以打开对应的文件，否则的话，上一步找到的资源名称就是最终的查找结果。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;从前面<a href="http://shyluo.blog.51cto.com/5725845/1229261" target="_blank">Android应用程序资源的编译和打包过程分析</a>一文可以知道，APK包里面的resources.arsc文件是在编译应用程序资源的时候生成的，然后连同其它被编译的以及原生的资源一起打包在一个APK包里面。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;从前面<a href="http://shyluo.blog.51cto.com/5725845/1229262" target="_blank">Android资源管理框架（Asset Manager）简要介绍和学习计划</a>一
文又可以知道，Android应用程序资源是可以划分是很多类别的，但是从资源查找的过程来看，它们可以归结为两大类。第一类资源是不对应有文件的，而第
二类资源是对应有文件的，例如，字符串资源是直接编译在resources.arsc文件中的，而界面布局资源是在APK包里面是对应的单独的文件的。如
上所述，不对应文件的资源只需要执行从资源ID到资源名称的转换即可，而对应有文件的资源还需要根据资源名称来打开对应的文件。在本文中，我们就以界面布
局资源的查找过程为例，来说明Android资源管理框架查找资源的过程。</p><p> &nbsp; &nbsp; &nbsp; 
我们知道，每一个Activity组件创建的时候，它的成员函数onCreate都会被调用，而在Activity组件的成员函数onCreate中，我
们基本上都无一例外地调用setContentView来设置Activity组件的界面。在调用Activity组件的成员函数
setContentView的时候，需要指定一个layout类型的资源ID，以便Android资源管理框架可以找到指定的Xml资源文件来填充
（inflate）为Activity组件的界面。接下来，我们就从Activity类的成员函数setContentView开始，分析Android
资源管理框架查找layout资源的过程，如图2所示。</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1366398825_4498.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload="" width="614"><br></p><p style="text-align:center;">图2 类型为layout的资源的查找过程</p><p> &nbsp; &nbsp; &nbsp; &nbsp;这个过程可以分为22个步骤，接下来我们就详细分析每一个步骤。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 1. Activity.setContentView</p><p><br></p><div><div id="highlighter_284329" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">Activity </code><code class="java keyword">extends</code> <code class="java plain">ContextThemeWrapper</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">implements</code> <code class="java plain">LayoutInflater.Factory,</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Window.Callback, KeyEvent.Callback,</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">OnCreateContextMenuListener, ComponentCallbacks {</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java plain">Window mWindow;</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">Window getWindow() {</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">mWindow;</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">.....</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">setContentView(</code><code class="java keyword">int</code> <code class="java plain">layoutResID) {</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">getWindow().setContentView(layoutResID);</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number16 index15 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/core/java/android/app/Activity.java中。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;从前面Android应用程序窗口（Activity）的窗口对象（Window）的创建过程分析一文可以知道，Activity类的成员变
量mWindow指向的是一个PhoneWindow对象，因此，Activity类的成员函数setContentView实际上是调用
PhoneWindow类的成员函数setContentView来进一步操作。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 2. PhoneWindow.setContentView</p><p><br></p><div><div id="highlighter_749774" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">PhoneWindow </code><code class="java keyword">extends</code> <code class="java plain">Window </code><code class="java keyword">implements</code> <code class="java plain">MenuBuilder.Callback {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// This is the view in which the window contents are placed. It is either</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// mDecor itself, or a child of mDecor where the contents go.</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java plain">ViewGroup mContentParent;</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java plain">LayoutInflater mLayoutInflater;</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">setContentView(</code><code class="java keyword">int</code> <code class="java plain">layoutResID) {</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(mContentParent == </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">installDecor();</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mContentParent.removeAllViews();</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mLayoutInflater.inflate(layoutResID, mContentParent);</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java plain">Callback cb = getCallback();</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(cb != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">cb.onContentChanged();</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number23 index22 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/policy/src/com/android/internal/policy/impl/PhoneWindow.java中。</p><p><br></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;PhoneWindow类的成员变量mContentParent用来描述一个类型为DecorView的视图对象，或者这个类型为
DecorView的视图对象的一个子视图对象，用作UI容器。当它的值等于null的时候，就说明当前正在处理的Activity组件的视图对象还没有
创建。在这种情况下，就会调用成员函数installDecor来创建当前正在处理的Activity组件的视图对象。否则的话，就说明是要重新设置当前
正在处理的Activity组件的视图。在重新设置之前，首先调用成员变量mContentParent所描述的一个ViewGroup对象来移除原来的
UI内容。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;PhoneWindow类的成员变量mLayoutInflater指向的是一个PhoneLayoutInflater对象。
PhoneLayoutInflater类是从LayoutInflater类继续下来的，同时它也继承了LayoutInflater类的成员函数
inflate。通过调用PhoneWindow类的成员变量mLayoutInflater所指向的一个PhoneLayoutInflater对象的
成员函数inflate，也就是从父类继承下来的成员函数inflate，就可以将参数layoutResID所描述的一个UI布局设置到
mContentParent所描述的一个视图容器中去。这样就可以将当前正在处理的Activity组件的UI创建出来。</p><p> &nbsp;
 &nbsp; &nbsp; 
&nbsp;最后，PhoneWindow类的成员函数还会调用一个Callback接口的成员函数onContentChanged来通知当前正在处理
的Activity组件，它的视图内容发生改变了。从前面Android应用程序窗口（Activity）的窗口对象（Window）的创建过程分析一文
可以知道，每一个Activity组件都实现了一个Callback接口，并且将这个Callback接口设置到了与它所关联的PhoneWindow的
内部去，因此，最后调用的实际上是Activity类的成员函数onContentChanged。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;接下来，我们就继续分析LayoutInflater类的成员函数inflate的实现，以便可以了解Android资源管理框架是如何找到参数layoutResID所描述的UI布局文件的。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 3. LayoutInflater.inflate</p><p><br></p><div><div id="highlighter_304549" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">abstract</code> <code class="java keyword">class</code> <code class="java plain">LayoutInflater {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">View inflate(</code><code class="java keyword">int</code> <code class="java plain">resource, ViewGroup root) {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">inflate(resource, root, root != </code><code class="java keyword">null</code><code class="java plain">);</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">View inflate(</code><code class="java keyword">int</code> <code class="java plain">resource, ViewGroup root, </code><code class="java keyword">boolean</code> <code class="java plain">attachToRoot) {</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">XmlResourceParser parser = getContext().getResources().getLayout(resource);</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code> <code class="java plain">{</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">inflate(parser, root, attachToRoot);</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">finally</code> <code class="java plain">{</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">parser.close();</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number17 index16 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/core/java/android/view/LayoutInflater.java中。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;LayoutInflater类两个参数版本的成员函数inflate通过调用三个参数版本的成员函数inflate来查找参数resource所描述的UI布局文件。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;在LayoutInflater类三个参数版本的成员函数inflate中，首先是获得用来描述当前运行上下文环境的一个Resources
对象，然后接调用这个Resources对象的成员函数getLayout来查找参数resource所描述的UI布局文件。</p><p> 
&nbsp; &nbsp; &nbsp; 
&nbsp;Resources类的成员函数getLayout找到了指定的UI布局文件之后，就会打开它。由于Android系统的UI布局文件是一个
Xml文件，因此，Resources类的成员函数getLayout打开它之后，得到的是一个XmlResourceParser对象。有了这个
XmlResourceParser对象之后，LayoutInflater类三个参数版本的成员函数inflate就将它传递给另外一个三个参数版本的
成员函数inflate，以便后者可以通过它来创建一个UI界面。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;接下来，我们就首先分析Resources类的成员函数getLayout的实现，然后再分析LayoutInflater类的另外一个三个参数版本的成员函数inflate的实现。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 4. Resources.getLayout</p><p><br></p><div><div id="highlighter_821453" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">Resources {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">XmlResourceParser getLayout(</code><code class="java keyword">int</code> <code class="java plain">id) </code><code class="java keyword">throws</code> <code class="java plain">NotFoundException {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">loadXmlResourceParser(id, </code><code class="java string">"layout"</code><code class="java plain">);</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number7 index6 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/core/java/android/content/res/Resources.java中。</p><p><br></p><p> &nbsp; &nbsp; &nbsp; &nbsp;Resources类的成员函数getLayout的实现很简单，它通过调用另外一个成员函数loadXmlResourceParser来查找并且打开由参数id所描述的一个UI布局文件。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 5. Resources.loadXmlResourceParser</p><p><br></p><div><div id="highlighter_104060" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">Resources {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">/*package*/</code> <code class="java plain">XmlResourceParser loadXmlResourceParser(</code><code class="java keyword">int</code> <code class="java plain">id, String type)</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throws</code> <code class="java plain">NotFoundException {</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">synchronized</code> <code class="java plain">(mTmpValue) {</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TypedValue value = mTmpValue;</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">getValue(id, value, </code><code class="java keyword">true</code><code class="java plain">);</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(value.type == TypedValue.TYPE_STRING) {</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">loadXmlResourceParser(value.string.toString(), id,</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">value.assetCookie, type);</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throw</code> <code class="java keyword">new</code> <code class="java plain">NotFoundException(</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java string">"Resource ID #0x"</code> <code class="java plain">+ Integer.toHexString(id) + </code><code class="java string">" type #0x"</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">+ Integer.toHexString(value.type) + </code><code class="java string">" is not valid"</code><code class="java plain">);</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number18 index17 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/core/java/android/content/res/Resources.java中。</p><p><br></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;参数id描述的是一个资源ID，Resources类的成员函数loadXmlResourceParser首先调用另外一个成员函数
getValue来获得该资源ID所对应的资源值，并且保存在一个类型为TypedValue的变量value中。在我们这个情景中，参数id描述的是一
个类型为layout的资源ID，从前面<a href="http://shyluo.blog.51cto.com/5725845/1229261" target="_blank">Android应用程序资源的编译和打包过程分析</a>一
文可以知道，类型为layout的资源ID对应的资源值即为一个UI布局文件名称。有了这个UI布局文件名称之后，Resources类的成员函数
loadXmlResourceParser接着再调用另外一个四个参数版本的成员函数loadXmlResourceParser来加载对应的UI布局
文件，并且得到一个XmlResourceParser对象返回给调用者。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;注意，如果Resources类的成员函数getValue没有找到与参数id所描述的资源，或者找到的资源的值不是字符串类型的，那么
Resources类的成员函数loadXmlResourceParser就会抛出一个类型为NotFoundException的异常。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;接下来，我们就首先分析Resources类的成员函数getValue的实现，接着再分析Resources类四个参数版本的成员函数loadXmlResourceParser的实现。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 6. Resources.getValue</p><p><br></p><div><div id="highlighter_464479" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">Resources {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">/*package*/</code> <code class="java keyword">final</code> <code class="java plain">AssetManager mAssets;</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">getValue(</code><code class="java keyword">int</code> <code class="java plain">id, TypedValue outValue, </code><code class="java keyword">boolean</code> <code class="java plain">resolveRefs)</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throws</code> <code class="java plain">NotFoundException {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">boolean</code> <code class="java plain">found = mAssets.getResourceValue(id, outValue, resolveRefs);</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(found) {</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code><code class="java plain">;</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throw</code> <code class="java keyword">new</code> <code class="java plain">NotFoundException(</code><code class="java string">"Resource ID #0x"</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">+ Integer.toHexString(id));</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number15 index14 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p><br></p><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/core/java/android/content/res/Resources.java中。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;Resources类的成员变量mAssets指向的是一个AssetManager对象，Resources类的成员函数getValue
通过调用它的成员函数getResourceValue来获得与参数id所对应的资源的值。注意，如果AssetManager类的成员函数
getResourceValue查找不到与参数id所对应的资源，那么Resources类的成员函数getValue就会抛出一个类型为
NotFoundException的异常。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;接下来，我们就继续分析AssetManager类的成员函数getResourceValue的实现。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 7. AssetManager.getResourceValue</p><p><br></p><div><div id="highlighter_876043" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">final</code> <code class="java keyword">class</code> <code class="java plain">AssetManager {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java plain">StringBlock mStringBlocks[] = </code><code class="java keyword">null</code><code class="java plain">;</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">/*package*/</code> <code class="java keyword">final</code> <code class="java keyword">boolean</code> <code class="java plain">getResourceValue(</code><code class="java keyword">int</code> <code class="java plain">ident,</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TypedValue outValue,</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">boolean</code> <code class="java plain">resolveRefs)</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">{</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">int</code> <code class="java plain">block = loadResourceValue(ident, outValue, resolveRefs);</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(block &gt;= </code><code class="java value">0</code><code class="java plain">) {</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(outValue.type != TypedValue.TYPE_STRING) {</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java keyword">true</code><code class="java plain">;</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">outValue.string = mStringBlocks[block].get(outValue.data);</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java keyword">true</code><code class="java plain">;</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java keyword">false</code><code class="java plain">;</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number20 index19 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p><br></p><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/core/java/android/content/res/AssetManager.java中。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;AssetManager类的成员函数getResourceValue通过调用另外一个成员函数loadResourceValue来加载
参数ident所描述的资源。如果加载成功，那么结果就会保存在参数outValue所描述的一个TypedValue对象中，并且
AssetManager类的成员函数loadResourceValue的返回值block大于等于0。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;从前面<a href="http://shyluo.blog.51cto.com/5725845/1229260" target="_blank" textvalue="Android应用程序资源管理器（Asset Manager）的创建过程分析">Android应用程序资源管理器（Asset Manager）的创建过程分析</a>一
文可以知道，AssetManager类的成员变量mStringBlock描述的是一个StringBlock数组。这个StringBlock数组中
的每一个StringBlock对象描述的都是当前应用程序使用的每一个资源索引表的资源项值字符串资源池。关于资源索引表的格式以及生成过程，可以参考
前面<a href="http://shyluo.blog.51cto.com/5725845/1229261" target="_blank" textvalue="Android应用程序资源的编译和打包过程分析">Android应用程序资源的编译和打包过程分析</a>一文。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;了解了上述背景之后，我们就可以知道，当AssetManager类的成员函数loadResourceValue的返回值block大于等
于0的时候，实际上就表示参数ident所描述的资源项在当前应用程序使用的第block个资源索引表中，而当参数ident所描述的资源项是一个字符串
时，那么就可以在第block个资源索引表的资源项值字符串资源池中找到对应的字符串，并且保存在参数outValue所描述的一个TypedValue
对象的成员变量string中，以便返回给调用者使用。注意，最终得到的字符串在第block个资源索引表的资源项值字符串资源池中的位置就保存在参数
outValue所描述的一个TypedValue对象的成员变量data中。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;接下来，我们就继续分析AssetManager类的成员函数loadResourceValue的实现。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 8. AssetManager.loadResourceValue</p><p><br></p><div><div id="highlighter_924614" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">final</code> <code class="java keyword">class</code> <code class="java plain">AssetManager {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">/** Returns true if the resource was found, filling in mRetStringBlock and</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java preprocessor">*&nbsp; mRetData. */</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">native</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">loadResourceValue(</code><code class="java keyword">int</code> <code class="java plain">ident, TypedValue outValue,</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">boolean</code> <code class="java plain">resolve);</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number8 index7 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/core/java/android/content/res/AssetManager.java中。</p><p><br></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;AssetManager类的成员函数loadResourceValue是一个JNI方法，它是由C++层的函数
android_content_AssetManager_loadResourceValue来实现的，如下所示：</p><p><br></p><div><div id="highlighter_318286" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">static</code> <code class="java plain">jint android_content_AssetManager_loadResourceValue(JNIEnv* env, jobject clazz,</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">jint ident,</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">jobject outValue,</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">jboolean resolve)</code></div><div class="line number5 index4 alt2"><code class="java plain">{</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">AssetManager* am = assetManagerForJavaObject(env, clazz);</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(am == NULL) {</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java value">0</code><code class="java plain">;</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">ResTable&amp; res(am-&gt;getResources());</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Res_value value;</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ResTable_config config;</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t typeSpecFlags;</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ssize_t block = res.getResource(ident, &amp;value, </code><code class="java keyword">false</code><code class="java plain">, &amp;typeSpecFlags, &amp;config);</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t ref = ident;</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(resolve) {</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">block = res.resolveReference(&amp;value, block, &amp;ref);</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">block &gt;= </code><code class="java value">0</code> <code class="java plain">? copyValue(env, outValue, &amp;res, value, ref, block, typeSpecFlags, &amp;config) : block;</code></div><div class="line number22 index21 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/core/jni/android_util_AssetManager.cpp中。</p><p><br></p><p> &nbsp; &nbsp; &nbsp; &nbsp;函数android_content_AssetManager_loadResourceValue主要是执行以下五个操作：</p><p>
 &nbsp; &nbsp; &nbsp; &nbsp;1. 
调用函数assetManagerForJavaObject来将参数clazz所描述的一个Java层的AssetManager对象的成员变量
mObject转换为一个C++层的AssetManager对象。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;2. 调用上述得到的C++层的AssetManager对象的成员函数getResources来获得一个ResTable对象，这个ResTable对象描述的是一个资源表。</p><p>
 &nbsp; &nbsp; &nbsp; &nbsp;3. 
调用上述得到的ResTable对象的成员函数getResource来获得与参数ident所对应的资源项值及其配置信息，并且保存在类型为
Res_value的变量value以及类型为ResTable_config的变量config中。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;4. 如果参数resolve的值等于true，那么就继续调用上述得到的ResTable对象的成员函数resolveReference来解析前面所得到的资源项值。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;5. 调用函数copyValue将上述得到的资源项值及其配置信息拷贝到参数outValue所描述的一个Java层的TypedValue对象中去，返回调用者可以获得与参数ident所对应的资源项内容。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;接下来，我们就主要分析第2~4操作，即AssetManager对象的成员函数getResources以及ResTable类的成员函数
getResource和resolveReference的实现，以便可以了解Android应用程序资源的查找过程。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 9. AssetManager.getResources</p><p><br></p><div><div id="highlighter_903268" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">const</code> <code class="java plain">ResTable&amp; AssetManager::getResources(bool required) </code><code class="java keyword">const</code></div><div class="line number2 index1 alt1"><code class="java plain">{</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">ResTable* rt = getResTable(required);</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">*rt;</code></div><div class="line number5 index4 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/libs/utils/AssetManager.cpp中。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;AssetManager类的成员函数getResources通过调用另外一个成员函数getResTable来获得当前应用程序所使用的资源表，后者的实现如下所示：</p><p><br></p><div><div id="highlighter_7153" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div><div class="line number74 index73 alt1">74</div><div class="line number75 index74 alt2">75</div><div class="line number76 index75 alt1">76</div><div class="line number77 index76 alt2">77</div><div class="line number78 index77 alt1">78</div><div class="line number79 index78 alt2">79</div><div class="line number80 index79 alt1">80</div><div class="line number81 index80 alt2">81</div><div class="line number82 index81 alt1">82</div><div class="line number83 index82 alt2">83</div><div class="line number84 index83 alt1">84</div><div class="line number85 index84 alt2">85</div><div class="line number86 index85 alt1">86</div><div class="line number87 index86 alt2">87</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">const</code> <code class="java plain">ResTable* AssetManager::getResTable(bool required) </code><code class="java keyword">const</code></div><div class="line number2 index1 alt1"><code class="java plain">{</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ResTable* rt = mResources;</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(rt) {</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">rt;</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Iterate through all asset packages, collecting resources from each.</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">AutoMutex _l(mLock);</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(mResources != NULL) {</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">mResources;</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">size_t N = mAssetPaths.size();</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">for</code> <code class="java plain">(size_t i=</code><code class="java value">0</code><code class="java plain">; i&lt;N; i++) {</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Asset* ass = NULL;</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ResTable* sharedRes = NULL;</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">bool shared = </code><code class="java keyword">true</code><code class="java plain">;</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">asset_path&amp; ap = mAssetPaths.itemAt(i);</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Asset* idmap = openIdmapLocked(ap);</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(ap.type != kFileTypeDirectory) {</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(i == </code><code class="java value">0</code><code class="java plain">) {</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The first item is typically the framework resources,</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// which we want to avoid parsing every time.</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">sharedRes = const_cast&lt;AssetManager*&gt;(</code><code class="java keyword">this</code><code class="java plain">)-&gt;</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mZipSet.getZipResourceTable(ap.path);</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(sharedRes == NULL) {</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ass = const_cast&lt;AssetManager*&gt;(</code><code class="java keyword">this</code><code class="java plain">)-&gt;</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mZipSet.getZipResourceTableAsset(ap.path);</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(ass == NULL) {</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ass = const_cast&lt;AssetManager*&gt;(</code><code class="java keyword">this</code><code class="java plain">)-&gt;</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">openNonAssetInPathLocked(</code><code class="java string">"resources.arsc"</code><code class="java plain">,</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Asset::ACCESS_BUFFER,</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ap);</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(ass != NULL &amp;&amp; ass != kExcludedAsset) {</code></div><div class="line number38 index37 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ass = const_cast&lt;AssetManager*&gt;(</code><code class="java keyword">this</code><code class="java plain">)-&gt;</code></div><div class="line number39 index38 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mZipSet.setZipResourceTableAsset(ap.path, ass);</code></div><div class="line number40 index39 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number41 index40 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number42 index41 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(i == </code><code class="java value">0</code> <code class="java plain">&amp;&amp; ass != NULL) {</code></div><div class="line number43 index42 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// If this is the first resource table in the asset</code></div><div class="line number44 index43 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// manager, then we are going to cache it so that we</code></div><div class="line number45 index44 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// can quickly copy it out for others.</code></div><div class="line number46 index45 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">LOGV(</code><code class="java string">"Creating shared resources for %s"</code><code class="java plain">, ap.path.string());</code></div><div class="line number47 index46 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">sharedRes = </code><code class="java keyword">new</code> <code class="java plain">ResTable();</code></div><div class="line number48 index47 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">sharedRes-&gt;add(ass, (</code><code class="java keyword">void</code><code class="java plain">*)(i+</code><code class="java value">1</code><code class="java plain">), </code><code class="java keyword">false</code><code class="java plain">, idmap);</code></div><div class="line number49 index48 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">sharedRes = const_cast&lt;AssetManager*&gt;(</code><code class="java keyword">this</code><code class="java plain">)-&gt;</code></div><div class="line number50 index49 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mZipSet.setZipResourceTable(ap.path, sharedRes);</code></div><div class="line number51 index50 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number52 index51 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number53 index52 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number54 index53 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number55 index54 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Asset* ass = const_cast&lt;AssetManager*&gt;(</code><code class="java keyword">this</code><code class="java plain">)-&gt;</code></div><div class="line number56 index55 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">openNonAssetInPathLocked(</code><code class="java string">"resources.arsc"</code><code class="java plain">,</code></div><div class="line number57 index56 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Asset::ACCESS_BUFFER,</code></div><div class="line number58 index57 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ap);</code></div><div class="line number59 index58 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">shared = </code><code class="java keyword">false</code><code class="java plain">;</code></div><div class="line number60 index59 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number61 index60 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">((ass != NULL || sharedRes != NULL) &amp;&amp; ass != kExcludedAsset) {</code></div><div class="line number62 index61 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(rt == NULL) {</code></div><div class="line number63 index62 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mResources = rt = </code><code class="java keyword">new</code> <code class="java plain">ResTable();</code></div><div class="line number64 index63 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">updateResourceParamsLocked();</code></div><div class="line number65 index64 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number66 index65 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number67 index66 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(sharedRes != NULL) {</code></div><div class="line number68 index67 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number69 index68 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">rt-&gt;add(sharedRes);</code></div><div class="line number70 index69 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number71 index70 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number72 index71 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">rt-&gt;add(ass, (</code><code class="java keyword">void</code><code class="java plain">*)(i+</code><code class="java value">1</code><code class="java plain">), !shared, idmap);</code></div><div class="line number73 index72 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number74 index73 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(!shared) {</code></div><div class="line number75 index74 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">delete ass;</code></div><div class="line number76 index75 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number77 index76 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number78 index77 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(idmap != NULL) {</code></div><div class="line number79 index78 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">delete idmap;</code></div><div class="line number80 index79 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number81 index80 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number82 index81 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number83 index82 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(!rt) {</code></div><div class="line number84 index83 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mResources = rt = </code><code class="java keyword">new</code> <code class="java plain">ResTable();</code></div><div class="line number85 index84 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number86 index85 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">rt;</code></div><div class="line number87 index86 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/libs/utils/AssetManager.cpp中。</p><p><br></p><p> &nbsp; &nbsp; &nbsp; &nbsp;AssetManager类的成员函数getResources的实现看起来比较复杂，但是它要做的事情就是解析当前应用程序所使用的资源包里面的resources.arsc文件。从前面<a href="http://shyluo.blog.51cto.com/5725845/1229260" target="_blank" textvalue="Android应用程序资源管理器（Asset Manager）的创建过程分析">Android应用程序资源管理器（Asset Manager）的创建过程分析</a>一
文可以知道，当前应用程序所使用的资源包有两个，其中一个是系统资源包，即/system/framework/framework-res.apk，另
外一个就是自己的APK文件。这些APK文件的路径都分别使用一个asset_path对象来描述，并且保存在AssetManager类的成员变量
mAssetPaths中。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;AssetManager类的成员变量mResources指向的是一个ResTable对象，如果它的值不等于NULL，那么就说明当前应
用程序已经解析过它使用的资源包里面的resources.arsc文件，因此，这时候AssetManager类的成员函数getResources就
可以直接将该ResTable对象返回给调用者。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;如果当前应用程序还没有解析过它使用的资源包里面的resources.arsc文件，那么AssetManager类的成员函数
getResources就会先获取由成员变量mLock所描述的一个互斥锁，避免多个线程同时去解析当前应用程序还没有解析过它使用的资源包里面的
resources.arsc文件。注意，获取锁成功之后，有可能其它线程已经抢先一步解析了当前应用程序使用的资源包里面的
resources.arsc文件了，因此，这时候就需要再次判断 
AssetManager类的成员函数mResources是否等于NULL。如果不等于NULL，就可以将它所指向的ResTable对象返回给调用者
了。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;AssetManager类的成员函数getResources接下来按照以下步骤来解析当前应用程序所使用的每一个资源包里面的resources.arsc文件：</p><p>
 &nbsp; &nbsp; &nbsp; &nbsp;1. 
检查资源包里面的resources.arsc文件已经提取出来。如果已经提取出来的话，那么以当前正在处理的资源包路径为参数，调用当前正在处理的
AssetManager对象的成员变量mZipSet所指向的一个ZipSet对象的成员函数getZipResourceTableAsset就可以
获得一个对应的Asset对象。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;2. 
如果资源包里面的resources.arsc文件还没有提取出来，那么就会调用当前正在处理的AssetManager对象的成员函数
openNonAssetInPathLocked来将该resources.arsc文件提取出来。提取的结果就是获得一个对应的Asset对象，保存
在变量ass中。注意，如果当前提取出来的Asset对象的地址值不等于全局变量kExcludedAsset的值，那么就将该Asset对象设置为当前
正在处理的AssetManager对象的成员变量mZipSet所指向的一个ZipSet对象中去，这是通过调用该ZipSet对象的成员函数
setZipResourceTableAsset来实现的。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;3. 
将上面获得的用来描述resources.arsc文件的Asset对象ass添加到变量rt所描述的一个ResTable对象中去，这是通过调用该
ResTable对象的成员函数add来实现的。注意，如果该ResTable对象还没有创建，那么它就会首先被创建，并且同时保存在
AssetManager类的成员变量mResources和变量rt中。另外一个地方需要注意的是，ResTable类的成员函数add在增加一个
Asset对象时，会对该Asset对象所描述的resources.arsc文件的内容进行解析，结果就是得到一个系列的Package信息。每一个
Package又包含了一个资源类型字符串资源池和一个资源项名称字符串资源池，以及一系列的资源类型规范数据块和一系列的资源项数据块。这些内容可以参
考前面<a href="http://shyluo.blog.51cto.com/5725845/1229261" target="_blank" textvalue="Android应用程序资源的编译和打包过程分析">Android应用程序资源的编译和打包过程分析</a>一文。还有第三个地方需要注意的是，每一个资源包里面的所有Pacakge形成一个PackageGroup，保存在变量rt所指向的一个ResTable对象的成员变量mPackageGroups中。总之，ResTable类的作用就类似于在前面<a href="http://shyluo.blog.51cto.com/5725845/1229261" target="_blank" textvalue="Android应用程序资源的编译和打包过程分析">Android应用程序资源的编译和打包过程分析</a>一文所介绍的ResourceTable类。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;一般来说，在AssetManager类的成员变量mAssetPaths中，第一个资源包路径指向的就是系统资源包，而系统资源包在当前正
在处理的AssetManager对象创建的时候，可能就已经提取或者初始化过了，也就是它的resources.arsc文件已经提取或者解析过了。如
果已经解析过，那么在代码中的for循环中，当i等于0时，调用当前正在处理的AssetManager对象的成员变量mZipSet所指向的一个
ZipSet对象的成员函数getZipResourceTable就可以获得一个ResTable对象，并且保存在变量sharedRes中，最终就可
以直接将该ResTable对象添加到变量rt所指向的一个ResTable对象中去，也就是添加到AssetManager类的成员变量
mResources所指向的一个ResTable对象中去。如果只是提取过，但是还没有解析过，那么就会首先对它进行解析，并且将得到的
ResTable对象保存在变量sharedRes中，最后再将该ResTable对象添加到变量rt所指向的一个ResTable对象中去。</p><p>
 &nbsp; &nbsp; &nbsp; &nbsp; 
此外，AssetManager类的成员变量mAssetPaths保存的资源包路径指向可能不是一个APK文件，而是一个目录文件。在这种情况
下，AssetManager类的成员函数getResources就会直接调用另外一个成员函数openNonAssetInPathLocked来打
开该目录下的resources.arsc文件，并且获得一个Asset对象，同样是保存在变量ass中。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;在前面<a href="http://shyluo.blog.51cto.com/5725845/1229260" target="_blank" textvalue="Android应用程序资源管理器（Asset Manager）的创建过程分析">Android应用程序资源管理器（Asset Manager）的创建过程分析</a>一
文还提到，Android系统的资源管理框架提供了一种idmap机制，用来个性化定制一个资源包里面已有的资源项，也就是说，每一个资源包都可能有一个
对应的idmap文件，用来描述它所个性化定制的资源项。在提取和解析资源包的过程中，如果该资源包存在idmap文件，那么该idmap文件也会被解
析，并且解析得到的一个Asset对象也会同时被增加到变量rt所指向的一个ResTable对象中去。</p><p> &nbsp; &nbsp; 
&nbsp; 
&nbsp;经过上述的一系列操作之后，AssetManager类的成员变量mResources所指向的一个ResTable对象就包含了当前应用程
序所使用的资源包的所有信息，该ResTable对象最后就会返回给调用者来使用。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;这一步执行完成之后，回到前面的Step 
8中，即AssetManager类的成员函数loadResourceValue中，接下来它就会调用前面所获得的一个ResTable对象的成员函数
getResource来获得指定的资源项内容。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 10. ResTable.getResource</p><p><br></p><div><div id="highlighter_84735" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div><div class="line number74 index73 alt1">74</div><div class="line number75 index74 alt2">75</div><div class="line number76 index75 alt1">76</div><div class="line number77 index76 alt2">77</div><div class="line number78 index77 alt1">78</div><div class="line number79 index78 alt2">79</div><div class="line number80 index79 alt1">80</div><div class="line number81 index80 alt2">81</div><div class="line number82 index81 alt1">82</div><div class="line number83 index82 alt2">83</div><div class="line number84 index83 alt1">84</div><div class="line number85 index84 alt2">85</div><div class="line number86 index85 alt1">86</div><div class="line number87 index86 alt2">87</div><div class="line number88 index87 alt1">88</div><div class="line number89 index88 alt2">89</div><div class="line number90 index89 alt1">90</div><div class="line number91 index90 alt2">91</div><div class="line number92 index91 alt1">92</div><div class="line number93 index92 alt2">93</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">ssize_t ResTable::getResource(uint32_t resID, Res_value* outValue, bool mayBeBag,</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t* outSpecFlags, ResTable_config* outConfig) </code><code class="java keyword">const</code></div><div class="line number3 index2 alt2"><code class="java plain">{</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">ssize_t p = getResourcePackageIndex(resID);</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java keyword">int</code> <code class="java plain">t = Res_GETTYPE(resID);</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java keyword">int</code> <code class="java plain">e = Res_GETENTRY(resID);</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">Res_value* bestValue = NULL;</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">Package* bestPackage = NULL;</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ResTable_config bestItem;</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">memset(&amp;bestItem, </code><code class="java value">0</code><code class="java plain">, sizeof(bestItem)); </code><code class="java comments">// make the compiler shut up</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(outSpecFlags != NULL) *outSpecFlags = </code><code class="java value">0</code><code class="java plain">;</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Look through all resource packages, starting with the most</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// recently added.</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">PackageGroup* </code><code class="java keyword">const</code> <code class="java plain">grp = mPackageGroups[p];</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">size_t ip = grp-&gt;packages.size();</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">while</code> <code class="java plain">(ip &gt; </code><code class="java value">0</code><code class="java plain">) {</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ip--;</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">int</code> <code class="java plain">T = t;</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">int</code> <code class="java plain">E = e;</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">Package* </code><code class="java keyword">const</code> <code class="java keyword">package</code> <code class="java plain">= grp-&gt;packages[ip];</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(</code><code class="java keyword">package</code><code class="java plain">-&gt;header-&gt;resourceIDMap) {</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t overlayResID = </code><code class="java value">0x0</code><code class="java plain">;</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">status_t retval = idmapLookup(</code><code class="java keyword">package</code><code class="java plain">-&gt;header-&gt;resourceIDMap,</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">package</code><code class="java plain">-&gt;header-&gt;resourceIDMapSize,</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">resID, &amp;overlayResID);</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(retval == NO_ERROR &amp;&amp; overlayResID != </code><code class="java value">0x0</code><code class="java plain">) {</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// for this loop iteration, this is the type and entry we really want</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">T = Res_GETTYPE(overlayResID);</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">E = Res_GETENTRY(overlayResID);</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// resource not present in overlay package, continue with the next package</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">continue</code><code class="java plain">;</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number38 index37 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number39 index38 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">ResTable_type* type;</code></div><div class="line number40 index39 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">ResTable_entry* entry;</code></div><div class="line number41 index40 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">Type* typeClass;</code></div><div class="line number42 index41 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ssize_t offset = getEntry(</code><code class="java keyword">package</code><code class="java plain">, T, E, &amp;mParams, &amp;type, &amp;entry, &amp;typeClass);</code></div><div class="line number43 index42 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(offset &lt;= </code><code class="java value">0</code><code class="java plain">) {</code></div><div class="line number44 index43 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// No {entry, appropriate config} pair found in package. If this</code></div><div class="line number45 index44 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// package is an overlay package (ip != 0), this simply means the</code></div><div class="line number46 index45 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// overlay package did not specify a default.</code></div><div class="line number47 index46 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Non-overlay packages are still required to provide a default.</code></div><div class="line number48 index47 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(offset &lt; </code><code class="java value">0</code> <code class="java plain">&amp;&amp; ip == </code><code class="java value">0</code><code class="java plain">) {</code></div><div class="line number49 index48 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number50 index49 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">offset;</code></div><div class="line number51 index50 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number52 index51 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">continue</code><code class="java plain">;</code></div><div class="line number53 index52 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number54 index53 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">((dtohs(entry-&gt;flags)&amp;entry-&gt;FLAG_COMPLEX) != </code><code class="java value">0</code><code class="java plain">) {</code></div><div class="line number55 index54 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number56 index55 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">continue</code><code class="java plain">;</code></div><div class="line number57 index56 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number58 index57 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number59 index58 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">Res_value* item =</code></div><div class="line number60 index59 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">(</code><code class="java keyword">const</code> <code class="java plain">Res_value*)(((</code><code class="java keyword">const</code> <code class="java plain">uint8_t*)type) + offset);</code></div><div class="line number61 index60 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ResTable_config thisConfig;</code></div><div class="line number62 index61 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">thisConfig.copyFromDtoH(type-&gt;config);</code></div><div class="line number63 index62 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(outSpecFlags != NULL) {</code></div><div class="line number64 index63 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(typeClass-&gt;typeSpecFlags != NULL) {</code></div><div class="line number65 index64 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">*outSpecFlags |= dtohl(typeClass-&gt;typeSpecFlags[E]);</code></div><div class="line number66 index65 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number67 index66 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">*outSpecFlags = -</code><code class="java value">1</code><code class="java plain">;</code></div><div class="line number68 index67 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number69 index68 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number70 index69 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(bestPackage != NULL &amp;&amp;</code></div><div class="line number71 index70 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">(bestItem.isMoreSpecificThan(thisConfig) || bestItem.diff(thisConfig) == </code><code class="java value">0</code><code class="java plain">)) {</code></div><div class="line number72 index71 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Discard thisConfig not only if bestItem is more specific, but also if the two configs</code></div><div class="line number73 index72 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// are identical (diff == 0), or overlay packages will not take effect.</code></div><div class="line number74 index73 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">continue</code><code class="java plain">;</code></div><div class="line number75 index74 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number76 index75 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">bestItem = thisConfig;</code></div><div class="line number77 index76 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">bestValue = item;</code></div><div class="line number78 index77 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">bestPackage = </code><code class="java keyword">package</code><code class="java plain">;</code></div><div class="line number79 index78 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number80 index79 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number81 index80 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(bestValue) {</code></div><div class="line number82 index81 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">outValue-&gt;size = dtohs(bestValue-&gt;size);</code></div><div class="line number83 index82 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">outValue-&gt;res0 = bestValue-&gt;res0;</code></div><div class="line number84 index83 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">outValue-&gt;dataType = bestValue-&gt;dataType;</code></div><div class="line number85 index84 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">outValue-&gt;data = dtohl(bestValue-&gt;data);</code></div><div class="line number86 index85 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(outConfig != NULL) {</code></div><div class="line number87 index86 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">*outConfig = bestItem;</code></div><div class="line number88 index87 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number89 index88 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number90 index89 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">bestPackage-&gt;header-&gt;index;</code></div><div class="line number91 index90 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number92 index91 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">BAD_VALUE;</code></div><div class="line number93 index92 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p><br></p><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/libs/utils/ResourceTypes.cpp中。<br></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;参数resID描述的是要查找的资源的ID，ResTable类的成员函数getResource分别获得它的Pakcage 
ID、Type ID以及Entry ID，保存在变量p、t以及e中。知道了Pakcage 
ID之后，就可以在ResTable类的成员变量mPackageGroups中找到对应的PakcageGroup。</p><p> &nbsp; 
&nbsp; &nbsp; 
&nbsp;注意，前面获得的PakcageGroup可能包含有多个Package，这些Package都保存在PakcageGroup的成员变量
packages所描述的一个数组中，因此，ResTable类的成员函数getResource就通过一个while循环来在每一个Package中查
找最符合条件的资源项。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;如果当前正在处理的Package的成员变量header所描述的一个Header对象的成员变量resourceIDMap的值不等于
NULL，那么它所指向的就是一个idmap，同时也说明当前正在处理的Package是一个Overlay 
Package，也就是说，它是用来覆盖已存在的资源项的。在这种情况下，ResTable类的成员函数getResource就会将参数resID所描
述的资源ID映射为覆盖后的资源ID。注意，如果不能将参数resID所描述的资源ID映射为覆盖后的ID，那么当前正在处理的Package就会被跳
过。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;无论当前正在处理的Package是否是一个Overlay 
Package，最要要找到的资源项的Type ID和Entry 
ID都保存在变量T和E中，接下来ResTable类的成员函数getResource就会以这两个变量为参数来调用另外一个成员函数getEntry来
在当前正在处理的Package中检查是否存在符合条件的资源项。如果存在的话，那么调用ResTable类的成员函数getEntry得到的返回值
offset就会大于0，同时还会得到三个类型分别为ResTable_type、ResTable_entry和Type结构体，分别保存在变量
type、entry和typeClass中。其中，ResTable_type用来描述一个资源类型，ResTable_entry用来描述一个资源
项，而Type用来描述一个资源类型规范，关于这些结构的详细解释可以参考前面<a href="http://shyluo.blog.51cto.com/5725845/1229261" target="_blank" textvalue="Android应用程序资源的编译和打包过程分析">Android应用程序资源的编译和打包过程分析</a>一文。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;从前面<a href="http://shyluo.blog.51cto.com/5725845/1229261" target="_blank" textvalue="Android应用程序资源的编译和打包过程分析">Android应用程序资源的编译和打包过程分析</a>一
文还可以知道，对于一个普通的资源项来说，它在资源表文件resources.arsc中，由一个ResTable_entry和一个Res_value
结构体前面连接在一起表示，其中，结构体ResTable_entry用来描述资源项的头部，而结构体Res_value用来描述资源项的值，并且这两个
结构体是嵌入在一个ResTable_type结构体里面的。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;理解了上述背景知道之后，我们就可以解释前面得到的返回值offset的含义了，它表示一个Res_value结构体在一个
ResTable_type结构体中的偏移，也就是说，将前面获得的ResTable_type结构体type的开始地址，再加偏移量offset，就可
以得到一个Res_value结构体item，而这个Res_value结构体就是表示资源ID等于resID的资源项的值。</p><p> 
&nbsp; &nbsp; &nbsp; 
&nbsp;注意，在调用ResTable类的成员函数getEntry来在当前正在处理的Package中查找与参数resID对应的资源项时，还会指
定设备的当前配置信息。设备的当前配置信息是由ResTable类的成员变量mParams所指向的一个ResTable_config结构体来描述的。
如果ResTable类的成员函数getEntry能成功找到一个匹配的资源项，那么它还会通过ResTable_type结构体type的成员变量
config所指向的一个ResTable_config结构体来返回该资源项的实际配置信息，并且保存在另外一个ResTable_config结构体
thisConfig中。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;现在一切就准备就绪了，ResTable类的成员函数getResource要做的事情就是比较在前后两个Package中找到的两个资源项
中，哪一个资源项更匹配设备的当前配置信息。注意，在前一个Package中找到的资源项的值及其所对应的Package和配置信息分别保存在
Res_value结构体bestValue、Package结构体bestPackage和ResTable_config结构体bestItem中，
而在后一个Package中找到的资源项对应的配置信息保存在ResTable_config结构体thisConfig中。</p><p> 
&nbsp; &nbsp; &nbsp; 
&nbsp;如果ResTable_config结构体bestItem描述的配置信息比ResTable_config结构体thisConfig描述
的配置信息更具体，或者它们完全是一样的，那么ResTable类的成员函数getResource就会认为在前一个Package中找到的资源项更匹配
设备的当前配置信息，于是就保持Res_value结构体bestValue、Package结构体bestPackage和
ResTable_config结构体bestItem的值不变，否则的话，就会将在后一个Package中找到的资源项的值及其所对应的Package
和配置信息分别保存在Res_value结构体bestValue、Package结构体bestPackage和ResTable_config结构体
bestItem中。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;ResTable类的成员函数getResource执行完成中间的while循环之后，最终得到的资源项的值以及配置信息就保存在
Res_value结构体bestValue和ResTable_config结构体bestItem，最后就可以分别将它们的内容拷贝到输出参数
outValue和outConfig中去，以便可以返回给调用者。同时，ResTable类的成员函数getResource还会将最终得到的资源项所
在的Package的索引返回给调用者。通过这个Package的索引值，调用者就可以知道它所找到的资源项是在哪一个资源包中找到的，例如，是在系统资
源包找到的，还是在应用程序本身的资源包找到的。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;事实上，ResTable类的成员函数getResource返回给调用者的还有一个很重要的信息，那就是参数resID所描述的资源项的配
置状况，也就是说，参数resID所描述的资源项的配置差异性信息。这个配置差异性信息就保存在前面得到的Type结构体typeClass的成员变量
typeSpecFlags所描述的一个uint32_t数组中的第E个元素中，这是因为参数resID所描述的资源项的Entry 
ID等于E。关于资源项的配置差异性信息的详细描述，可以参考前面<a href="http://shyluo.blog.51cto.com/5725845/1229261" target="_blank" textvalue="Android应用程序资源的编译和打包过程分析">Android应用程序资源的编译和打包过程分析</a>一文所提到的ResTable_typeSpec结构体。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;在ResTable类的成员函数getResource查找资源的过程中，还有两个地方是需要注意的。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;第一个地方是ResTable类的成员函数getResource是从后往前遍历Pakcage 
ID等于p的PackageGroup中的每一个Package的。在一个PackageGroup中，第一个Package是一个Base 
Package，其它的Package都是属于Overlay Package，其中，在Overlay 
Package中定义的资源是用来覆盖在Base 
Package中定义的资源的。如果ResTable类的成员函数getResource在调用另外一个成员函数getEntry来在某一个
package中找不到对应的资源项时，即调用ResTable类的成员函数getEntry得到的返回值offset小于等于0的时候，需要进一步检查
该package是一个Base Package还是一个Overlay Package。如果是一个Overlay 
Package，那么这种情况是允许发生的，因为一个Overlay Package只需要定义它需要覆盖的资源。另一方面，如果是一个Base 
Package，那么就是这种情况就是异常的，因为一个Base 
Package无论如何都要保证在给定一个合法的资源ID的前提下，一定可以找到一个对应的资源项，在最坏的情况下，这个资源项就是一个default类
型的。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;第二个地方是只有当调用ResTable类的成员函数getEntry得到资源项是一个普通资源项时，即得到的ResTable_entry
结构体entry的成员变量flags的值的FLAG_COMPLEX位等于0时，才可以将得到的ResTable_type结构体type的偏移位置
offset转换为一个Res_value结构体来访问。这是因为如果找到的资源项不是一个普通资源项，而是一个Bag资源项时，得到的
ResTable_type结构体type的偏移位置offset是一个ResTable_map结构体数组，而不是一个Res_value结构体，这一
点可以参考前面<a href="http://shyluo.blog.51cto.com/5725845/1229261" target="_blank" textvalue="Android应用程序资源的编译和打包过程分析">Android应用程序资源的编译和打包过程分析</a>一文。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;接下来，我们就继续分析ResTable类的成员函数getEntry的实现，以便可以了解它是如何在一个Package中找到指定Type ID、Entry ID以及配置信息的资源项的，如下所示：</p><p><br></p><div><div id="highlighter_648713" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">ssize_t ResTable::getEntry(</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">Package* </code><code class="java keyword">package</code><code class="java plain">, </code><code class="java keyword">int</code> <code class="java plain">typeIndex, </code><code class="java keyword">int</code> <code class="java plain">entryIndex,</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">ResTable_config* config,</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">ResTable_type** outType, </code><code class="java keyword">const</code> <code class="java plain">ResTable_entry** outEntry,</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">Type** outTypeClass) </code><code class="java keyword">const</code></div><div class="line number6 index5 alt1"><code class="java plain">{</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">ResTable_package* </code><code class="java keyword">const</code> <code class="java plain">pkg = </code><code class="java keyword">package</code><code class="java plain">-&gt;</code><code class="java keyword">package</code><code class="java plain">;</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">Type* allTypes = </code><code class="java keyword">package</code><code class="java plain">-&gt;getType(typeIndex);</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">ResTable_type* type = NULL;</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t offset = ResTable_type::NO_ENTRY;</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ResTable_config bestConfig;</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">memset(&amp;bestConfig, </code><code class="java value">0</code><code class="java plain">, sizeof(bestConfig)); </code><code class="java comments">// make the compiler shut up</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">size_t NT = allTypes-&gt;configs.size();</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">for</code> <code class="java plain">(size_t i=</code><code class="java value">0</code><code class="java plain">; i&lt;NT; i++) {</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">ResTable_type* </code><code class="java keyword">const</code> <code class="java plain">thisType = allTypes-&gt;configs[i];</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(thisType == NULL) </code><code class="java keyword">continue</code><code class="java plain">;</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ResTable_config thisConfig;</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">thisConfig.copyFromDtoH(thisType-&gt;config);</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Check to make sure this one is valid for the current parameters.</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(config &amp;&amp; !thisConfig.match(*config)) {</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">continue</code><code class="java plain">;</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Check if there is the desired entry in this type.</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">uint8_t* </code><code class="java keyword">const</code> <code class="java plain">end = ((</code><code class="java keyword">const</code> <code class="java plain">uint8_t*)thisType)</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">+ dtohl(thisType-&gt;header.size);</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">uint32_t* </code><code class="java keyword">const</code> <code class="java plain">eindex = (</code><code class="java keyword">const</code> <code class="java plain">uint32_t*)</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">(((</code><code class="java keyword">const</code> <code class="java plain">uint8_t*)thisType) + dtohs(thisType-&gt;header.headerSize));</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t thisOffset = dtohl(eindex[entryIndex]);</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(thisOffset == ResTable_type::NO_ENTRY) {</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">continue</code><code class="java plain">;</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(type != NULL) {</code></div><div class="line number38 index37 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Check if this one is less specific than the last found.&nbsp; If so,</code></div><div class="line number39 index38 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// we will skip it.&nbsp; We check starting with things we most care</code></div><div class="line number40 index39 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// about to those we least care about.</code></div><div class="line number41 index40 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(!thisConfig.isBetterThan(bestConfig, config)) {</code></div><div class="line number42 index41 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number43 index42 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">continue</code><code class="java plain">;</code></div><div class="line number44 index43 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number45 index44 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number46 index45 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">type = thisType;</code></div><div class="line number47 index46 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">offset = thisOffset;</code></div><div class="line number48 index47 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">bestConfig = thisConfig;</code></div><div class="line number49 index48 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number50 index49 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(!config) </code><code class="java keyword">break</code><code class="java plain">;</code></div><div class="line number51 index50 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number52 index51 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(type == NULL) {</code></div><div class="line number53 index52 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number54 index53 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">BAD_INDEX;</code></div><div class="line number55 index54 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number56 index55 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">offset += dtohl(type-&gt;entriesStart);</code></div><div class="line number57 index56 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number58 index57 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">ResTable_entry* </code><code class="java keyword">const</code> <code class="java plain">entry = (</code><code class="java keyword">const</code> <code class="java plain">ResTable_entry*)</code></div><div class="line number59 index58 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">(((</code><code class="java keyword">const</code> <code class="java plain">uint8_t*)type) + offset);</code></div><div class="line number60 index59 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number61 index60 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">*outType = type;</code></div><div class="line number62 index61 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">*outEntry = entry;</code></div><div class="line number63 index62 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(outTypeClass != NULL) {</code></div><div class="line number64 index63 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">*outTypeClass = allTypes;</code></div><div class="line number65 index64 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number66 index65 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">offset + dtohs(entry-&gt;size);</code></div><div class="line number67 index66 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/libs/utils/ResourceTypes.cpp中。</p><p><br></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;ResTable类的成员函数getEntry首先是在参数pakcage所描述的一个Package中找到与参数typeIndex所对应
的一个Type结构体allTypes。这个Type结构体综合了我们在前面<a href="http://shyluo.blog.51cto.com/5725845/1229261" target="_blank" textvalue="Android应用程序资源的编译和打包过程分析">Android应用程序资源的编译和打包过程分析</a>一
文所描述的资源项的ResTable_typeSpec数据块和ResTable_type数据块，也就是，这个Type结构体的成员变量
typeSpecFlags所指向的一个uint32_t数组描述了同一种类型的所有资源项的配置差异性性信息，即相当于一系列
ResTable_typeSpec数据块，而成员变量configs所指向的一个ResTable_type数组描述的同一种类型的资源项的具体内容，
即相当于一系列ResTable_type数据块。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;结合前面<a href="http://shyluo.blog.51cto.com/5725845/1229261" target="_blank" textvalue="Android应用程序资源的编译和打包过程分析">Android应用程序资源的编译和打包过程分析</a>一
文对ResTable_typeSpec数据块和ResTable_type数据块的描述，我们就可以比较容易理解ResTable类的成员函数
getEntry的实现了。由于Type结构体allTypes的成员变量configs所指向的一个ResTable_type数组描述的所有类型为
typeIndex的资源项的具体内容，因此，ResTable类的成员函数getEntry只要遍历这个ResTable_type数组，并且找到与参
数entryIdex所对应的最匹配资源项即可，也就是最能匹配参数config所描述的配置信息的资源项即可。</p><p> &nbsp; 
&nbsp; &nbsp; 
&nbsp;我们知道，在每一个ResTable_type结构体中，都包含有一个类型为uint32_t的偏移数组。偏移数组中的第
entryIndex个元素的值就表示Entry 
ID等于entryIndex的资源项的具体内容相对于ResTable_type结构体的偏移值。有了这个偏移值之后，我们就得到Entry 
ID等于entryIndex的资源项的具体内容了，也就是得到一个对应的ResTable_entry结构体。</p><p> &nbsp; 
&nbsp; &nbsp; 
&nbsp;注意，每一个ResTable_type结构体都有一个成员变量config，它描述的是一个ResTable_config对象，表示该
ResTable_type结构体的配置信息。如果该配置信息要求的配置信息不匹配，也就是与参数config所描述的设置配置信息不匹配，那么就不需要
进一步检查该ResTable_type结构体是否存在Entry ID等于entryIndex的资源项了。</p><p> &nbsp; 
&nbsp; &nbsp; 
&nbsp;如果一个ResTable_type结构体的配置信息与参数config所描述的设置配置信息匹配，但是它不存在Entry 
ID等于entryIndex的资源项，即它的偏移数组中的第entryIndex个元素的值等于ResTable_type::NO_ENTRY，那么
也不需要进一步对该ResTable_type结构体进行处理了。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;如果一个ResTable_type结构体的配置信息与参数config所描述的设置配置信息匹配，并且它也存在Entry 
ID等于entryIndex的资源项，那么就需要比较前后两个ResTable_type结构体的配置信息与参数config所描述的设置配置信息相
比，哪一个更具体一些。具有更具体的配置信息的资源项将作为最匹配的资源项返回给调用者。注意，前一个ResTable_type结构体及其配置信息分别
保存在变量type和bestConfig中，并且在该ResTable_type结构体中Entry 
ID等于entryIndex的资源项相对它的偏移值保存在变量offset中。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;遍历完成上面所述的ResTable_type数组之后，最终得到的最区配资源项的相关信息就保存在变量type、bestConfig和
offset中。这时候将变量type所描述的ResTable_type结构体的起始位置，加上它的成员变量entriesStart的值，以及再加上
变量offset的值，就可以得到一个对应的ResTable_entry结构体entry。这个ResTable_entry结构体entry就是用来
描述最终在参数package所描述的Package中，找到与参数typeIndex、entryIndex和config最匹配的资源项的信息了。</p><p>
 &nbsp; &nbsp; &nbsp; 
最终，ResTable类的成员函数getEntry就将前面所得到的ResTable_entry结构体entry、ResTable_type结构体
type以及Type结构体allTypes分别保存在输出参数outEntry、outType和outTypeClass返回给调用者了。同
时，ResTable类的成员函数getEntry还会将变量offset的值加上ResTable_entry结构体entry的大小的结果返回给调用
者。调用都得到这个结果之后，就可以将它作为输出参数outType所指向的ResTable_type结构体的偏移量，从而可以得到参数
outEntry所指向的ResTable_entry结构体所描述的资源项的具体内容，也就是得到一个Res_value结构体，这个具体就可以参考前
面对ResTable类的成员函数getResource的分析。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;这一步执行完成之后，回到前面的Step 
8中，即AssetManager类的成员函数loadResourceValue中，接下来它就会调用前面所获得的一个ResTable对象的成员函数
resolveReference来解析前面所获得的资源项的内容了。</p><p> &nbsp; &nbsp; &nbsp; &nbsp; Step 11. ResTable.resolveReference</p><div><div id="highlighter_766020" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">ssize_t ResTable::resolveReference(Res_value* value, ssize_t blockIndex,</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t* outLastRef, uint32_t* inoutTypeSpecFlags,</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ResTable_config* outConfig) </code><code class="java keyword">const</code></div><div class="line number4 index3 alt1"><code class="java plain">{</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">int</code> <code class="java plain">count=</code><code class="java value">0</code><code class="java plain">;</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">while</code> <code class="java plain">(blockIndex &gt;= </code><code class="java value">0</code> <code class="java plain">&amp;&amp; value-&gt;dataType == value-&gt;TYPE_REFERENCE</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">&amp;&amp; value-&gt;data != </code><code class="java value">0</code> <code class="java plain">&amp;&amp; count &lt; </code><code class="java value">20</code><code class="java plain">) {</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(outLastRef) *outLastRef = value-&gt;data;</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t lastRef = value-&gt;data;</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t newFlags = </code><code class="java value">0</code><code class="java plain">;</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">ssize_t newIndex = getResource(value-&gt;data, value, </code><code class="java keyword">true</code><code class="java plain">, &amp;newFlags,</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">outConfig);</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(newIndex == BAD_INDEX) {</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">BAD_INDEX;</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">//printf("Getting reference 0x%08x: newIndex=%d\n", value-&gt;data, newIndex);</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(inoutTypeSpecFlags != NULL) *inoutTypeSpecFlags |= newFlags;</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(newIndex &lt; </code><code class="java value">0</code><code class="java plain">) {</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// This can fail if the resource being referenced is a style...</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// in this case, just return the reference, and expect the</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// caller to deal with.</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">blockIndex;</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">blockIndex = newIndex;</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">count++;</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">blockIndex;</code></div><div class="line number29 index28 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/libs/utils/ResourceTypes.cpp中。</p><p><br></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;ResTable类的成员函数resolveReference的实现其实很简单，它就是对参数value所描述的一个资源项值进行解析，前
提是这个资源项值是一个引用，即value所指向的一个Res_value结构体的成员变量dataType的值等于TYPE_REFERENCE，因为
如果不是引用类型的资源项值，就没有必要解析了。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;注意，一个资源项的值有可能是嵌套引用的，也就是可能是引用的引用，因此，ResTable类的成员函数resolveReference需
要使用一个while循环来不断地对参数value所描述的一个资源项值进行解析，直到最后一次解析出来的结果不是引用为止。但是，为了防止无限地解析下
去，该while循环最多只允许执行20次。每一次解析都是调用ResTable类的成员函数getResource来实现的，这个成员函数我们在前面的
Step 10中已经分析过了。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;此外，上述while循环还有两个条件需要满足。第一个条件是每一次调用ResTable类的成员函数getResource来解析参数
value所描述的资源项值之后，得到的返回值blockIndex都必须是大于等于0的，这是因为它表示该次解析是成功的。由于参数
blockIndex最开始的值是由调用者传进来的，因此，也要保证它最开始的值大于等于0，才会执行代码中的while循环对参数value所描述的资
源项值进行解析。第二个条件是参数value所描述的资源项的值不能等于0，即它所指向的一个Res_value结构体的成员变量data的值不能等于
0，这是因为引用者都是不可能等于0的。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;这一步执行完成之后，沿着调用路径最终返回到前面的Step 
5中，即Resources类的成员函数loadXmlResourceParser中，我们就可以得到参数id所描述的资源项的值了。在我们这个情景
中，参数id描述的是一个layout资源ID，它所对应的资源项的值是一个字符串，这个字符串描述的便是一个UI布局文件，即一个经过编译的、以二进制
格式保存的Xml资源文件。有了这个Xml资源文件的路径之后，Resources类的另外一个四个参数版本的成员函数
loadXmlResourceParser就会被调用来对该Xml资源文件进行解析，以便可以得到一个UI布局视图。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 12. Resources.loadXmlResourceParser</p><p><br></p><div><div id="highlighter_898048" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">Resources {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">int</code> <code class="java plain">mLastCachedXmlBlockIndex = -</code><code class="java value">1</code><code class="java plain">;</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">final</code> <code class="java keyword">int</code><code class="java plain">[] mCachedXmlBlockIds = { </code><code class="java value">0</code><code class="java plain">, </code><code class="java value">0</code><code class="java plain">, </code><code class="java value">0</code><code class="java plain">, </code><code class="java value">0</code> <code class="java plain">};</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">final</code> <code class="java plain">XmlBlock[] mCachedXmlBlocks = </code><code class="java keyword">new</code> <code class="java plain">XmlBlock[</code><code class="java value">4</code><code class="java plain">];</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">/*package*/</code> <code class="java plain">XmlResourceParser loadXmlResourceParser(String file, </code><code class="java keyword">int</code> <code class="java plain">id,</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">int</code> <code class="java plain">assetCookie, String type) </code><code class="java keyword">throws</code> <code class="java plain">NotFoundException {</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(id != </code><code class="java value">0</code><code class="java plain">) {</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code> <code class="java plain">{</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// These may be compiled...</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">synchronized</code> <code class="java plain">(mCachedXmlBlockIds) {</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// First see if this block is in our cache.</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">num = mCachedXmlBlockIds.length;</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">for</code> <code class="java plain">(</code><code class="java keyword">int</code> <code class="java plain">i=</code><code class="java value">0</code><code class="java plain">; i&lt;num; i++) {</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(mCachedXmlBlockIds[i] == id) {</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">mCachedXmlBlocks[i].newParser();</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Not in the cache, create a new block and put it at</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// the next slot in the cache.</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">XmlBlock block = mAssets.openXmlBlockAsset(</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">assetCookie, file);</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(block != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">int</code> <code class="java plain">pos = mLastCachedXmlBlockIndex+</code><code class="java value">1</code><code class="java plain">;</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(pos &gt;= num) pos = </code><code class="java value">0</code><code class="java plain">;</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mLastCachedXmlBlockIndex = pos;</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">XmlBlock oldBlock = mCachedXmlBlocks[pos];</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(oldBlock != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">oldBlock.close();</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mCachedXmlBlockIds[pos] = id;</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mCachedXmlBlocks[pos] = block;</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">block.newParser();</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number38 index37 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number39 index38 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(Exception e) {</code></div><div class="line number40 index39 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">NotFoundException rnf = </code><code class="java keyword">new</code> <code class="java plain">NotFoundException(</code></div><div class="line number41 index40 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java string">"File "</code> <code class="java plain">+ file + </code><code class="java string">" from xml type "</code> <code class="java plain">+ type + </code><code class="java string">" resource ID #0x"</code></div><div class="line number42 index41 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">+ Integer.toHexString(id));</code></div><div class="line number43 index42 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">rnf.initCause(e);</code></div><div class="line number44 index43 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throw</code> <code class="java plain">rnf;</code></div><div class="line number45 index44 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number46 index45 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number47 index46 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throw</code> <code class="java keyword">new</code> <code class="java plain">NotFoundException(</code></div><div class="line number48 index47 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java string">"File "</code> <code class="java plain">+ file + </code><code class="java string">" from xml type "</code> <code class="java plain">+ type + </code><code class="java string">" resource ID #0x"</code></div><div class="line number49 index48 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">+ Integer.toHexString(id));</code></div><div class="line number50 index49 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number51 index50 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number52 index51 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/core/java/android/content/res/Resources.java中</p><p><br></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;Resources类有三个成员变量是与Xml资源文件缓存文件有关的，它们分别是mCachedXmlBlocks、
mCachedXmlBlockIds和mLastCachedXmlBlockIndex。其中，mCachedXmlBlocks指向的是一个大小等
于4的XmlBlock数组，mCachedXmlBlockIds指向的也是一个大小等于4的资源ID数组，而
mLastCachedXmlBlockIndex表示上一次缓存的Xml资源文件在上述XmlBlock数组和资源ID数组中的索引。这就是
说，Resources类最多可以缓存最近读取的四个Xml资源文件的内容，读取超过四个Xml资源文件之后 
，上述的XmlBlock数组和资源ID数组就会被循环利用。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;理解了Resources类的上述三个成员变量的含义之后，Resources类的成员函数loadXmlResourceParser的实
现就容易理解了。它首先是在成员变量mCachedXmlBlockIds所指向的资源ID数组中检查是否存在一个资源ID与参数id所描述的资源ID相
等。如果存在的话，那么就会在成员变量mCachedXmlBlocks所指向的XmlBlock数组中找到一个对应的XmlBlock对象，并且调用这
个XmlBlock对象的成员函数newParser来创建一个XmlResourceParser对象返回给调用者。</p><p> &nbsp; 
&nbsp; &nbsp; 
&nbsp;如果在Resources类的成员变量mCachedXmlBlockIds所指向的资源ID数组找到对应的资源ID的话，那么
Resources类的成员函数loadXmlResourceParser就会调用成员变量mAssets所指向的一个Java层的
AssetManager对象的成员函数openXmlBlockAsset来打开参数file所指定的Xml资源文件，从而获得一个XmlBlock对
象block。这个XmlBlock对象block以及参数id所描述的资源ID同时也会被缓存在Resources类的成员变量
mCachedXmlBlocks和mCachedXmlBlockIds所描述的XmlBlock数组和资源ID数组中。</p><p> &nbsp;
 &nbsp; &nbsp; 
&nbsp;最后，Resources类的成员函数loadXmlResourceParser就可以调用前面得到的XmlBlock对象block的成
员函数newParser来创建一个XmlResourceParser对象返回给调用者。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;接下来，我们就首先分析Java层的AssetManager类的成员函数openXmlBlockAsset的实现，接着再分析
XmlBlock类的成员函数newParser的实现，以便可以了解一个Xml资源文件的打开过程。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 13. AssetManager.openXmlBlockAsset</p><p><br></p><div><div id="highlighter_372057" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">final</code> <code class="java keyword">class</code> <code class="java plain">AssetManager {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">/*package*/</code> <code class="java keyword">final</code> <code class="java plain">XmlBlock openXmlBlockAsset(</code><code class="java keyword">int</code> <code class="java plain">cookie, String fileName)</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throws</code> <code class="java plain">IOException {</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">synchronized</code> <code class="java plain">(</code><code class="java keyword">this</code><code class="java plain">) {</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(!mOpen) {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throw</code> <code class="java keyword">new</code> <code class="java plain">RuntimeException(</code><code class="java string">"Assetmanager has been closed"</code><code class="java plain">);</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">int</code> <code class="java plain">xmlBlock = openXmlAssetNative(cookie, fileName);</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(xmlBlock != </code><code class="java value">0</code><code class="java plain">) {</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">XmlBlock res = </code><code class="java keyword">new</code> <code class="java plain">XmlBlock(</code><code class="java keyword">this</code><code class="java plain">, xmlBlock);</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">incRefsLocked(res.hashCode());</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">res;</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throw</code> <code class="java keyword">new</code> <code class="java plain">FileNotFoundException(</code><code class="java string">"Asset XML file: "</code> <code class="java plain">+ fileName);</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number19 index18 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/core/java/android/content/res/AssetManager.java中。</p><p><br></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;AssetManager类的成员函数openXmlBlockAsset首先检查成员变量mOpen的值是否不等于true。如果不等于
true的话，那么就说明当前正在处理的AssetManager对象还没有经过初始化，或者已经关闭了。</p><p> &nbsp; &nbsp; 
&nbsp; 
&nbsp;我们假设AssetManager类的成员变量mOpen的值等于true，那么接下来AssetManager类的成员函数
openXmlBlockAsset就会调用另外一个成员函数openXmlAssetNative来打开参数fileName所指定的Xml资源文件。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;成功打开参数fileName所指向的Xml资源文件之后，就会得到一个C++层的ResXMLTree对象的地址值xmlBlock，最后
AssetManager类的成员函数openXmlBlockAsset就将该C++层的ResXMLTree对象的地址值封装在一个Java层的
XmlBlock对象中，并且将该XmlBlock对象返回给调用者。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;接下来，我们就继续分析AssetManager类的成员函数openXmlAssetNative的实现。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 14. &nbsp;AssetManager.openXmlAssetNative</p><p><br></p><div><div id="highlighter_809116" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">final</code> <code class="java keyword">class</code> <code class="java plain">AssetManager {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">native</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">openXmlAssetNative(</code><code class="java keyword">int</code> <code class="java plain">cookie, String fileName);</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number5 index4 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/core/java/android/content/res/AssetManager.java中。</p><p><br></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;AssetManager类的成员函数openXmlAssetNative是一个JNI方法，它是C++层的函数
android_content_AssetManager_openXmlAssetNative来实现的，如下所示：</p><p><br></p><div><div id="highlighter_718099" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">static</code> <code class="java plain">jint android_content_AssetManager_openXmlAssetNative(JNIEnv* env, jobject clazz,</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">jint cookie,</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">jstring fileName)</code></div><div class="line number4 index3 alt1"><code class="java plain">{</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">AssetManager* am = assetManagerForJavaObject(env, clazz);</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java keyword">char</code><code class="java plain">* fileName8 = env-&gt;GetStringUTFChars(fileName, NULL);</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Asset* a = cookie</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">? am-&gt;openNonAsset((</code><code class="java keyword">void</code><code class="java plain">*)cookie, fileName8, Asset::ACCESS_BUFFER)</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">: am-&gt;openNonAsset(fileName8, Asset::ACCESS_BUFFER);</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">env-&gt;ReleaseStringUTFChars(fileName, fileName8);</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ResXMLTree* block = </code><code class="java keyword">new</code> <code class="java plain">ResXMLTree();</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">status_t err = block-&gt;setTo(a-&gt;getBuffer(</code><code class="java keyword">true</code><code class="java plain">), a-&gt;getLength(), </code><code class="java keyword">true</code><code class="java plain">);</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">a-&gt;close();</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">delete a;</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">(jint)block;</code></div><div class="line number19 index18 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/core/jni/android_util_AssetManager.cpp中。 &nbsp; &nbsp; &nbsp; &nbsp;</p><p><br></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;函数android_content_AssetManager_openXmlAssetNative首先调用另外一个函数
assetManagerForJavaObject来将参数clazz所指向的一个Java层的AssetManager对象成员变量mObject转
换为一个C++层的AssetManager对象。有了这个C++层的AssetManager对象之后，就可以调用它的成员函数
openNonAsset来打开参数fileName所指定的Xml资源文件。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;调用C++层的AssetManager对象的成员函数openNonAsset来成功地打开参数fileName所指定的Xml资源文件之
后，函数android_content_AssetManager_openXmlAssetNative接下来就会创建一个ResXMLTree对
象，并且将前面所打开的Xml资源文件的内容设置到该ResXMLTree对象中去，并且将该ResXMLTree对象的地址值返回给调用者。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;假设参数cookie的值大于0，因此，函数
android_content_AssetManager_openXmlAssetNative实际调用的是C++层的AssetManager类的
三个参数版本的成员函数openNonAsset来打开参数fileName所指定的Xml资源文件，接下来，我们就分析这个函数的实现。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 15. AssetManager.openNonAsset</p><p><br></p><div><div id="highlighter_527654" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">Asset* AssetManager::openNonAsset(</code><code class="java keyword">void</code><code class="java plain">* cookie, </code><code class="java keyword">const</code> <code class="java keyword">char</code><code class="java plain">* fileName, AccessMode mode)</code></div><div class="line number2 index1 alt1"><code class="java plain">{</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">size_t which = ((size_t)cookie)-</code><code class="java value">1</code><code class="java plain">;</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">AutoMutex _l(mLock);</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(which &lt; mAssetPaths.size()) {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Asset* pAsset = openNonAssetInPathLocked(</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">fileName, mode, mAssetPaths.itemAt(which));</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(pAsset != NULL) {</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">pAsset != kExcludedAsset ? pAsset : NULL;</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">NULL;</code></div><div class="line number15 index14 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p><br></p><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/libs/utils/AssetManager.cpp中。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;参数cookie是用来标识另外一个参数fileName所指向的文件是属于哪个APK文件的。从前面<a href="http://shyluo.blog.51cto.com/5725845/1229260" target="_blank" textvalue="Android应用程序资源管理器（Asset Manager）的创建过程分析">Android应用程序资源管理器（Asset Manager）的创建过程分析</a>一
文可以知道，参数cookie实际上是一个整数，将这个整数减去1之后，得到的结果就是参数fileName所指向的文件所属于的APK文件在
AssetManager类的成员变量mAssetPaths所描述的一个数组的索引。AssetManager类的成员变量mAssetPaths描述
的是一个asset_path数组，数组中的每一个元素都是表示一个APK文件路径，这些APK文件就包含了当前应用程序所要使用的资源包。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;AssetManager类的成员函数openNonAsset通过参数cookie知道了当前要打开的文件是位于哪个APK文件之后，接着
就继续调用另外一个成员函数openNonAssetInPathLocked来打开该文件。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 16. AssetManager.openNonAssetInPathLocked</p><p><br></p><div><div id="highlighter_198008" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">Asset* AssetManager::openNonAssetInPathLocked(</code><code class="java keyword">const</code> <code class="java keyword">char</code><code class="java plain">* fileName, AccessMode mode,</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">asset_path&amp; ap)</code></div><div class="line number3 index2 alt2"><code class="java plain">{</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Asset* pAsset = NULL;</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">/* look at the filesystem on disk */</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">if (ap.type == kFileTypeDirectory) {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">String8 path(ap.path);</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">path.appendPath(fileName);</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">pAsset = openAssetFromFileLocked(path, mode);</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">if (pAsset == NULL) {</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">/* try again, this time with ".gz" */</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">path.append(".gz");</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">pAsset = openAssetFromFileLocked(path, mode);</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">}</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">if (pAsset != NULL) {</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">//printf("FOUND NA '%s' on disk\n", fileName);</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">pAsset-&gt;setAssetSource(path);</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">}</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">/* look inside the zip file */</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">} else {</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">String8 path(fileName);</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">/* check the appropriate Zip file */</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">ZipFileRO* pZip;</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">ZipEntryRO entry;</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">pZip = getZipFileLocked(ap);</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">if (pZip != NULL) {</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">//printf("GOT zip, checking NA '%s'\n", (const char*) path);</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">entry = pZip-&gt;findEntryByName(path.string());</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">if (entry != NULL) {</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">//printf("FOUND NA in Zip file for %s\n", appName ? appName : kAppCommon);</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">pAsset = openAssetFromZipLocked(pZip, entry, mode, path);</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">}</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">}</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">if (pAsset != NULL) {</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">/* create a "source" name, for debug/display */</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">pAsset-&gt;setAssetSource(</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">createZipSourceNameLocked(ZipSet::getPathName(ap.path.string()), String8(</code><code class="java string">""</code><code class="java plain">),</code></div><div class="line number38 index37 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String8(fileName)));</code></div><div class="line number39 index38 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number40 index39 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number41 index40 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">pAsset;</code></div><div class="line number42 index41 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/libs/utils/AssetManager.cpp中。</p><p><br></p><p> &nbsp; &nbsp; &nbsp; &nbsp;AssetManager类的成员函数openNonAssetInPathLocked的实现是比较简单的，它按照以下两种方式来打开参数fileName所指向的文件。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;如果参数ap描述的文件路径是一个目录，那么它就会直接将参数fileName所指向的文件名称附加到该目录后面去，然后直接调用另外一个成
员函数openAssetFromFileLocked来打开参数fileName所指向的文件。如果打开失败，那么就再假定参数ap描述的文件路径是一
个以“.gz“为后缀的压缩包，然后再次调用成员函数openAssetFromFileLocked来打开参数fileName所指向的文件。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;如果参数ap描述的文件路径是一个普通文件，那么就意味着参数ap描述的是一个压缩文件，因此，它就会先调用成员函数
getZipFileLocked来打开该压缩文件，然后再调用成员函数openAssetFromZipLocked来在该压缩包将参数
fileName所指向的文件提取出来。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;Android应用程序的资源一般都是打包在一个APK文件里面的，而APK文件就是一个Zip格式的压缩包，因
此，AssetManager类的成员函数openNonAssetInPathLocked一般就是按照第二种方式来打开参数fileName所指向的
文件。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;接下来，我们就继续分析AssetManager类的成员函数openAssetFromZipLocked的实现。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 17. AssetManager.openAssetFromZipLocked</p><p><br></p><div><div id="highlighter_58961" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">Asset* AssetManager::openAssetFromZipLocked(</code><code class="java keyword">const</code> <code class="java plain">ZipFileRO* pZipFile,</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">const</code> <code class="java plain">ZipEntryRO entry, AccessMode mode, </code><code class="java keyword">const</code> <code class="java plain">String8&amp; entryName)</code></div><div class="line number3 index2 alt2"><code class="java plain">{</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Asset* pAsset = NULL;</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// TODO: look for previously-created shared memory slice?</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">int</code> <code class="java plain">method;</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">size_t uncompressedLen;</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(!pZipFile-&gt;getEntryInfo(entry, &amp;method, &amp;uncompressedLen, NULL, NULL,</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">NULL, NULL))</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">{</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">LOGW(</code><code class="java string">"getEntryInfo failed\n"</code><code class="java plain">);</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">NULL;</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">FileMap* dataMap = pZipFile-&gt;createEntryFileMap(entry);</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(dataMap == NULL) {</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">LOGW(</code><code class="java string">"create map from entry failed\n"</code><code class="java plain">);</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">NULL;</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(method == ZipFileRO::kCompressStored) {</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">pAsset = Asset::createFromUncompressedMap(dataMap, mode);</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">LOGV(</code><code class="java string">"Opened uncompressed entry %s in zip %s mode %d: %p"</code><code class="java plain">, entryName.string(),</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">dataMap-&gt;getFileName(), mode, pAsset);</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">pAsset = Asset::createFromCompressedMap(dataMap, method,</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uncompressedLen, mode);</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">LOGV(</code><code class="java string">"Opened compressed entry %s in zip %s mode %d: %p"</code><code class="java plain">, entryName.string(),</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">dataMap-&gt;getFileName(), mode, pAsset);</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(pAsset == NULL) {</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">/* unexpected */</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">LOGW(</code><code class="java string">"create from segment failed\n"</code><code class="java plain">);</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">pAsset;</code></div><div class="line number35 index34 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/libs/utils/AssetManager.cpp中。</p><p><br></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;AssetManager类的成员函数openAssetFromZipLocked的实现也很简单，它无非就是从参数pZipFile所描
述的压缩包中将参数entryName所描述的文件提取出来，并且根据提取出来的内容保存在一个Asset对象中返回给调用者。</p><p> 
&nbsp; &nbsp; &nbsp; 
注意，参数entryName所描述的文件有可能是经过是经过压缩后再打包到参数pZipFile所描述的压缩包去的。在这种情况
下，AssetManager类的成员函数openAssetFromZipLocked就会调用Asset类的静态成员函数
createFromCompressedMap来对它进行解压，然后再将解压完成后得到的内容保存在一个Asset对象中。否则的
话，AssetManager类的成员函数openAssetFromZipLocked就会调用Asset类的静态成员函数
createFromUncompressedMap来将它的内容保存在一个Asset对象中。</p><p> &nbsp; &nbsp; 
&nbsp; &nbsp;这一步执行完成之后，返回到前面的Step 
12中，即Resources类的成员函数loadXmlResourceParser中，接下来就会调用Java层的XmlBlock类的成员函数
newParser来创建一个XmlResourceParser对象，以便可以用来解析前面打开的Xml资源文件。</p><p> &nbsp; &nbsp; &nbsp; Step 18. XmlBlock.newParser</p><p><br></p><div><div id="highlighter_133683" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">final</code> <code class="java keyword">class</code> <code class="java plain">XmlBlock {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">XmlResourceParser newParser() {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">synchronized</code> <code class="java plain">(</code><code class="java keyword">this</code><code class="java plain">) {</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(mNative != </code><code class="java value">0</code><code class="java plain">) {</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java keyword">new</code> <code class="java plain">Parser(nativeCreateParseState(mNative), </code><code class="java keyword">this</code><code class="java plain">);</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java keyword">null</code><code class="java plain">;</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">mNative;</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">native</code> <code class="java keyword">int</code> <code class="java plain">nativeCreateParseState(</code><code class="java keyword">int</code> <code class="java plain">obj);</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number16 index15 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/core/java/android/content/res/XmlBlock.java中。</p><p><br></p><p> &nbsp; &nbsp; &nbsp; &nbsp;XmlBlock类的成员函数mNative指向的是C++层的一个ResXMLTree对象。这个ResXMLTree对象是在前面的Step 14中创建的，用来描述前面所打开的一个Xml资源文件。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;XmlBlock类的成员函数newParser首先是以成员变量mNative所描述的一个C++层的ResXMLTree对象的地址为参
数，来调用JNI方法nativeCreateParseState，用来在C++层创建一个ResXMLParser对象，最后再将该C++层的
ResXMLParser对象封装成Java层的一个Parser对象中，并且将该Parser对象返回给调用者。</p><p> &nbsp; 
&nbsp; &nbsp; &nbsp;这一步执行完成之后，返回到前面的Step 
3中，即LayoutInflater类的成员函数inflate中，接下来它就会以前面所获得的一个Java层的Parser对象来参数，来调用另外一
个重载版本的成员函数inflate，用来解析前面所打开的Xml资源文件，即一个UI布局文件，以便可以创建相应的UI布局出来。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 19. LayoutInflater.inflate</p><p><br></p><div><div id="highlighter_868396" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">abstract</code> <code class="java keyword">class</code> <code class="java plain">LayoutInflater {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">View inflate(XmlPullParser parser, ViewGroup root, </code><code class="java keyword">boolean</code> <code class="java plain">attachToRoot) {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">synchronized</code> <code class="java plain">(mConstructorArgs) {</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java plain">AttributeSet attrs = Xml.asAttributeSet(parser);</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Context lastContext = (Context)mConstructorArgs[</code><code class="java value">0</code><code class="java plain">];</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mConstructorArgs[</code><code class="java value">0</code><code class="java plain">] = mContext;</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">View result = root;</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code> <code class="java plain">{</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Look for the root node.</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">int</code> <code class="java plain">type;</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">while</code> <code class="java plain">((type = parser.next()) != XmlPullParser.START_TAG &amp;&amp;</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">type != XmlPullParser.END_DOCUMENT) {</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Empty</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(type != XmlPullParser.START_TAG) {</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throw</code> <code class="java keyword">new</code> <code class="java plain">InflateException(parser.getPositionDescription()</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">+ </code><code class="java string">": No start tag found!"</code><code class="java plain">);</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java plain">String name = parser.getName();</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(TAG_MERGE.equals(name)) {</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">rInflate(parser, root, attrs);</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Temp is the root view that was found in the xml</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">View temp = createViewFromTag(name, attrs);</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ViewGroup.LayoutParams params = </code><code class="java keyword">null</code><code class="java plain">;</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(root != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Create layout params that match root, if supplied</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">params = root.generateLayoutParams(attrs);</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(!attachToRoot) {</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Set the layout params for temp if we are not</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// attaching. (If we are, we use addView, below)</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">temp.setLayoutParams(params);</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number38 index37 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number39 index38 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number40 index39 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Inflate all children under temp</code></div><div class="line number41 index40 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">rInflate(parser, temp, attrs);</code></div><div class="line number42 index41 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number43 index42 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// We are supposed to attach all the views we found (int temp)</code></div><div class="line number44 index43 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// to root. Do that now.</code></div><div class="line number45 index44 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(root != </code><code class="java keyword">null</code> <code class="java plain">&amp;&amp; attachToRoot) {</code></div><div class="line number46 index45 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">root.addView(temp, params);</code></div><div class="line number47 index46 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number48 index47 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Decide whether to return the root that was passed in or the</code></div><div class="line number49 index48 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// top view found in xml.</code></div><div class="line number50 index49 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(root == </code><code class="java keyword">null</code> <code class="java plain">|| !attachToRoot) {</code></div><div class="line number51 index50 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">result = temp;</code></div><div class="line number52 index51 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number53 index52 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number54 index53 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(XmlPullParserException e) {</code></div><div class="line number55 index54 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number56 index55 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(IOException e) {</code></div><div class="line number57 index56 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number58 index57 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">finally</code> <code class="java plain">{</code></div><div class="line number59 index58 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number60 index59 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number61 index60 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">result;</code></div><div class="line number62 index61 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number63 index62 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number64 index63 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number65 index64 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/core/java/android/view/LayoutInflater.java中。<br></p><p><br></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;LayoutInflater类的成员函数inflate主要负责处理前面所打开的Xml资源文件的根节点，然后再调用另外一个成员函数
rInflate来处理根节点的子节点。每一个节点都表示一个UI控件，这个UI控件是通过调用LayoutInflater类的成员函数
createViewFromTag来创建的。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;LayoutInflater类的成员函数createViewFromTag需要两个参数来创建一个UI控件。这两个参数分别对应于当前正
在处理的Xml节点的名称以及属性集。注意，如果参数root的值不等于null，那么它所描述的一个ViewGroup就是调用
LayoutInflater类的成员函数createViewFromTag获得的UI控件的父控件。因此，调用LayoutInflater类的成员
函数createViewFromTag获得的UI控件及其对应的布局参数，最后都需要添加到参数root所描述的一个ViewGroup中去。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;有一种特殊情况，如果当前正在处理的Xml节点的名称等于TAG_MERGE，即“merge”，那么就表示不用处理的当前正在处理的Xml
节点，而是直接去处理当前正在处理的Xml节点的子节点。这是Android系统为提供的一种UI布局优化机制，实际上就是减少了一层UI嵌套，具体可以
参考官方文档：<a href="http://developer.android.com/training/improving-layouts/reusing-layouts.html">http://developer.android.com/training/improving-layouts/reusing-layouts.html</a>。</p><p>
 &nbsp; &nbsp; &nbsp; &nbsp; 
LayoutInflater类的成员函数rInflate在处理当前节点的子节点的时候，也是通过调用成员函数createViewFromTag来创
建相应的UI控件的，因此，接下来我们就主要分析LayoutInflater类的成员函数createViewFromTag的实现。</p><p> &nbsp; &nbsp; &nbsp; &nbsp; Step 20. LayoutInflater.createViewFromTag</p><p><br></p><div><div id="highlighter_993946" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">abstract</code> <code class="java keyword">class</code> <code class="java plain">LayoutInflater {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java plain">Factory mFactory;</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">View createViewFromTag(String name, AttributeSet attrs) {</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(name.equals(</code><code class="java string">"view"</code><code class="java plain">)) {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">name = attrs.getAttributeValue(</code><code class="java keyword">null</code><code class="java plain">, </code><code class="java string">"class"</code><code class="java plain">);</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code> <code class="java plain">{</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">View view = (mFactory == </code><code class="java keyword">null</code><code class="java plain">) ? </code><code class="java keyword">null</code> <code class="java plain">: mFactory.onCreateView(name,</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mContext, attrs);</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(view == </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(-</code><code class="java value">1</code> <code class="java plain">== name.indexOf(</code><code class="java string">'.'</code><code class="java plain">)) {</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">view = onCreateView(name, attrs);</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">view = createView(name, </code><code class="java keyword">null</code><code class="java plain">, attrs);</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">view;</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(InflateException e) {</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(ClassNotFoundException e) {</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(Exception e) {</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number31 index30 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/core/java/android/view/LayoutInflater.java中。</p><p><br></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;参数name表示当前正在处理的Xml节点的名称。如果它的值等于“view”的话，那么真正要创建的UI控件的类名记录在参数attrs所
描述的一个属性集中的一个名称为“class”的属性中。因此，当参数name的值等于“view”的时候，LayoutInflater类的成员函数
createViewFromTag首先要做的便是从参数attrs所描述的一个属性集中获取接下来真正要创建的UI控件的类名。</p><p> 
&nbsp; &nbsp; &nbsp; 
&nbsp;LayoutInflater类的成员函数createViewFromTag接下来检查成员变量mFactory的值是否不等于null。
如果不等于null的话，那么它就会指向一个Factory对象，该Factory对象描述的是一个UI控件创建工厂，专门用来负责创建UI控件。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;如果LayoutInflater类的成员变量mFactory的值等于null，那么LayoutInflater类的成员函数
createViewFromTag就会调用成员函数onCreateView或者createView来创建由参数name所指定的UI控件，取决于参
数name是否包含了一个“.”字符。注意，如果参数name是否包含了一个“.”字符，那么就说明当前所创建的UI控件是一个用户自定义的UI控件，也
就是不是Android提供的标准控件。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;我们假设LayoutInflater类的成员变量mFactory的值等于null，并且参数name没有包含有“.”字符，那么
LayoutInflater类的成员函数createViewFromTag最后就会调用成员函数onCreateView来创建由参数name所指定
的UI控件。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;LayoutInflater类的成员函数onCreateView是由其子类来重写的。从前面的Step 
2可以知道，当前正在处理的实际上是一个PhoneLayoutInflater对象。PhoneLayoutInflater类继承了
LayoutInflater类，并且重写了成员函数onCreateView。因此，接下来我们就继续分析PhoneLayoutInflater类的
成员函数onCreateView的实现。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 21. PhoneLayoutInflater.onCreateView<br></p><div><div id="highlighter_854896" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">PhoneLayoutInflater </code><code class="java keyword">extends</code> <code class="java plain">LayoutInflater {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java plain">String[] sClassPrefixList = {</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java string">"android.widget."</code><code class="java plain">,</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java string">"android.webkit."</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">};</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code> <code class="java keyword">protected</code> <code class="java plain">View onCreateView(String name, AttributeSet attrs) </code><code class="java keyword">throws</code> <code class="java plain">ClassNotFoundException {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">for</code> <code class="java plain">(String prefix : sClassPrefixList) {</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code> <code class="java plain">{</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">View view = createView(name, prefix, attrs);</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(view != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">view;</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(ClassNotFoundException e) {</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// In this case we want to let the base class take a crack</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// at it.</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java keyword">super</code><code class="java plain">.onCreateView(name, attrs);</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number21 index20 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/policy/src/com/android/internal/policy/impl/PhoneLayoutInflater.java中。</p><p><br></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;PhoneLayoutInflater类的成员函数onCreateView只负责创建两类标准的UI控件，一种是属于
android.widget包的，另一种是属于android.webkit包的，其中，优先创建android.widget包的UI控件。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;如果参数name所描述的UI控件既不属于android.widget包的，也不属于android.webkit包的，那么 
PhoneLayoutInflater类的成员函数onCreateView就会将创建UI控件的操作交给父类来处理，即通过调用父类的成员函数
onCreateView来创建。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;如果参数name所描述的UI控件是属于android.widget包或者android.webkit包的，那么
PhoneLayoutInflater类的成员函数onCreateView就会直接调用父类LayoutInflater的成员函数
createView来创建参数name所描述的UI控件，因此，接下来我们就继续分析LayoutInflater类的成员函数createView的
实现。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 22. LayoutInflater.createView</p><p><br></p><div><div id="highlighter_607322" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">abstract</code> <code class="java keyword">class</code> <code class="java plain">LayoutInflater {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java plain">Filter mFilter;</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">final</code> <code class="java plain">Object[] mConstructorArgs = </code><code class="java keyword">new</code> <code class="java plain">Object[</code><code class="java value">2</code><code class="java plain">];</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java plain">HashMap&lt;String, Constructor&gt; sConstructorMap =</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">new</code> <code class="java plain">HashMap&lt;String, Constructor&gt;();</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java plain">HashMap&lt;String, Boolean&gt; mFilterMap;</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">final</code> <code class="java plain">View createView(String name, String prefix, AttributeSet attrs)</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">throws</code> <code class="java plain">ClassNotFoundException, InflateException {</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Constructor constructor = sConstructorMap.get(name);</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Class clazz = </code><code class="java keyword">null</code><code class="java plain">;</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code> <code class="java plain">{</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(constructor == </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Class not found in the cache, see if it's real, and try to add it</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">clazz = mContext.getClassLoader().loadClass(</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">prefix != </code><code class="java keyword">null</code> <code class="java plain">? (prefix + name) : name);</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(mFilter != </code><code class="java keyword">null</code> <code class="java plain">&amp;&amp; clazz != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">boolean</code> <code class="java plain">allowed = mFilter.onLoadClass(clazz);</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(!allowed) {</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">failNotAllowed(name, prefix, attrs);</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">constructor = clazz.getConstructor(mConstructorSignature);</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">sConstructorMap.put(name, constructor);</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// If we have a filter, apply it to cached constructor</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(mFilter != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Have we seen this name before?</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Boolean allowedState = mFilterMap.get(name);</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(allowedState == </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// New class -- remember whether it is allowed</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">clazz = mContext.getClassLoader().loadClass(</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">prefix != </code><code class="java keyword">null</code> <code class="java plain">? (prefix + name) : name);</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">boolean</code> <code class="java plain">allowed = clazz != </code><code class="java keyword">null</code> <code class="java plain">&amp;&amp; mFilter.onLoadClass(clazz);</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mFilterMap.put(name, allowed);</code></div><div class="line number38 index37 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(!allowed) {</code></div><div class="line number39 index38 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">failNotAllowed(name, prefix, attrs);</code></div><div class="line number40 index39 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number41 index40 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java keyword">if</code> <code class="java plain">(allowedState.equals(Boolean.FALSE)) {</code></div><div class="line number42 index41 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">failNotAllowed(name, prefix, attrs);</code></div><div class="line number43 index42 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number44 index43 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number45 index44 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number46 index45 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Object[] args = mConstructorArgs;</code></div><div class="line number47 index46 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">args[</code><code class="java value">1</code><code class="java plain">] = attrs;</code></div><div class="line number48 index47 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">(View) constructor.newInstance(args);</code></div><div class="line number49 index48 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(NoSuchMethodException e) {</code></div><div class="line number50 index49 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number51 index50 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(ClassNotFoundException e) {</code></div><div class="line number52 index51 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number53 index52 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(Exception e) {</code></div><div class="line number54 index53 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number55 index54 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number56 index55 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number57 index56 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number58 index57 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这个函数定义在文件frameworks/base/core/java/android/view/LayoutInflater.java。<br></p><p><br></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;LayoutInflater类的静态成员变量sConstructorMap指向的是一个HashMap。这个HashMap缓存了当前应
用程序使用过的每一种类型的UI控件类的构造函数。这些构造函数必须具有两个参数，其中第一个参数是一个Context，第二个参数是一个
AttributeSet。LayoutInflater类的成员函数createView在创建一个UI控件的时候，就会将上述两个参数保存在
LayoutInflater类的成员变量mConstructorArgs所描述的一个大小为2的数组中，并且以这个数组为参数，来调用对应的UI控件
类的构造函数。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;LayoutInflater类的mFilter指向的是一个Filter对象。这个Filter对象描述的是一个过滤
器，LayoutInflater类的成员函数createView在创建一个UI控件之前，会先调用该过滤器的成员函数onLoadClass，来询问
该过滤器是允许创建由参数name所描述的UI控件。如果不允许的话，LayoutInflater类的成员函数createView就会调用另外一个成
员函数failNotAllowed来抛出一个异常。</p><p> &nbsp; &nbsp; &nbsp; 
为了避免每次创建一个UI控件时，都去询问过滤器是否允许创建，LayoutInflater类的成员函数createView只会在第一次创建一个名称
为name的UI控件时，才会询问过滤器，并且将询问结果保存在成员变量mFilterMap所指向的一个HashMap。这样当
LayoutInflater类的成员函数createView以后再创建同名的UI控件时，就可以直接通过成员变量mFilterMap所指向的一个
HashMap来知道该UI控件是否是允许创建的。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;理解了LayoutInflater类的静态成员变量sConstructorMap以及成员变量mConstructorArgs、
mFilter和mFilterMap的含义之后，读者就可以自己去理解LayoutInflater类的成员函数createView的实现了。这里需
要重复强调的一点就是，我们在自定义一个UI控件的时候，一定要提供一个具有两个参数类型分别为Context和AttributeSet的构造函数，否
则的话，该自定义控件就不可以在UI布局文件中使用。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;至此，我们就以layout资源为例，详细地分析了Android应用程序资源的查找过程了，并且也完整地分析完成Android系统的资源管理框架了。重新学习Android系统的资源管理框架，请参考前面<a href="http://shyluo.blog.51cto.com/5725845/1229262" target="_blank" textvalue="Android资源管理框架（Asset Manager）简要介绍和学习计划">Android资源管理框架（Asset Manager）简要介绍和学习计划</a>一文。</p><p style="text-align:center;"><span style="font-size:14px;color:#cc0000;"><strong>老罗的新浪微博：<a href="http://weibo.com/shengyangluo" target="_blank">http://weibo.com/shengyangluo</a>，欢迎关注！</strong></span><br></p><p>本文出自 “<a href="http://shyluo.blog.51cto.com/">老罗的Android之旅</a>” 博客，请务必保留此出处<a href="http://shyluo.blog.51cto.com/5725845/1229259">http://shyluo.blog.51cto.com/5725845/1229259</a></p>
		  </div>

			<!--正文 end-->
<script type="text/javascript" language="javascript">
	function iFrameHeight() {
		var ifm= document.getElementById("iframepage");
		var subWeb = document.frames ? document.frames["iframepage"].document : ifm.contentDocument;
		if(ifm != null && subWeb != null) {
			ifm.height = subWeb.body.scrollHeight;
		}
	}
</script>
<script type="text/javascript">
	var kevent = 
'onabort|onblur|onchange|onclick|ondblclick|onerror|onfocus|onkeydown|onkeypress|onkeyup|onload|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|onreset|onresize|onselect|onsubmit|onunload';

	var aevent = kevent.split('|');

	jQuery('.showContent img').each(function(){
		var nimg = this;
		jQuery.each(aevent, function(i, n){
			if (n!='onload') {
				jQuery(nimg).attr(n, '');
			} else {
				if (jQuery(nimg).attr(n) != 'if(this.width>650) this.width=650;') {
					jQuery(nimg).attr(n, '');
				}
			}
		});
	});
</script>
<script type="text/javascript" charset="utf-8">
var encodetitle = encodeURI('一篇很棒的博文分享给大家：《Android应用程序资源的查找过程分析》');

function show51share(){

	
window.open('http://t.51cto.com/index.php?m=share&url=http://shyluo.blog.51cto.com/5725845/1229259&type=l&count=&relateUid=&appkey=3843950324&title='
 + encodetitle);
}
</script>
<div class="m_sharebtn clear">
	<table width="100%" cellspacing="0" cellpadding="0" border="0">
	  <tbody><tr>
		<td width="11%" valign="middle" height="43" align="center"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/ssk.png" alt="分享至"></td>
		<td width="77%" valign="top" align="left">
<!--
<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_mshare" data-cmd="mshare" title="分享到一键分享"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_bdhome" data-cmd="bdhome" title="分享到百度新首页"></a><a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a><a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a><a href="#" class="bds_bdysc" data-cmd="bdysc" title="分享到百度云收藏"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a></div>
<script>
var bds_config = {'wbUid':1706976420};
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false, 'bdPic':'http://blog.51cto.com/attachment/201305/173413310.jpg',"bdStyle":"1","bdSize":"32"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
 -->

<div class="bdsharebuttonbox bdshare-button-style1-32" data-bd-bind="1503367644133"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_mshare" data-cmd="mshare" title="分享到一键分享"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_bdhome" data-cmd="bdhome" title="分享到百度新首页"></a><a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a><a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_bdysc" data-cmd="bdysc" title="分享到百度云收藏"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{"tsina":"2065779340"},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"http://blog.51cto.com/img/blog_down0731.jpg","bdStyle":"1","bdSize":"32"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new
 Date()/36e5)];</script>

	<!-- Baidu Button END --></td>
		<td width="12%" valign="middle" align="right"><a class="bdms_point" data-behavior="favorite" data-method="add" href="javascript:favorBox('open');" title="一键收藏，随时查看，分享好友！"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/favorite_add_small.gif" alt="一键收藏，随时查看，分享好友！" border="0"></a></td>
	  </tr>
	</tbody></table>

</div>
    		<div class="showBottom">
            <!--<div class="reviews"><span class="fl" style="cursor:pointer;"><a onclick="openFavoulist();" id="favourer"></a>

            </span><div id="favourdiv" class="support01">0人</div>
              <span class="fl">了这篇文章</span></div>-->
              <table width="720" cellspacing="0" cellpadding="0" border="0">
  <tbody><tr>
    <td align="right"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/icon01.png" width="15" height="16"> <span style="cursor:pointer;"><a onclick="openFavoulist();" id="favourer"></a></span></td>
    <td width="70" align="left"><div style="line-height:28px;" id="favourdiv" class="support01">0人</div></td>
    <td width="60" align="left">了这篇文章</td>
  </tr>
</tbody></table>




            <div class="showType">类别：<a href="http://shyluo.blog.51cto.com/5725845/d-1" class="operlink">Android</a>┆阅读(<span id="readNum">1157</span>)┆评论(<span id="cmtNum">0</span>)

┆
<a href="http://shyluo.blog.51cto.com/">返回博主首页</a>┆<a href="http://blog.51cto.com/">返回博客首页</a></div>
            <div class="prevNext">

			上一篇 <a href="http://shyluo.blog.51cto.com/5725845/1229258" class="operlink" title="Dalvik虚拟机的运行过程分析">Dalvik虚拟机的运行过程分析</a>


			下一篇 <a href="http://shyluo.blog.51cto.com/5725845/1229260" class="operlink" title="Android应用程序资源管理器（Asset Manager）的创建过程分析">Android应用程序资源管理器（Asset Manager）..</a>


            </div>

            </div>

	  </div><!--showBottom end-->
      </div><!--modCon-->
    <span class="modBot"></span>
    </div><!--artShow end-->
    <span class="blank"></span>




	<div class="relatedArt box">
		<a href="javascript:;"><img src=""></a>
	</div>


<div class="artComm box">
    <div class="title"><a name="replay"></a><h2>文章评论</h2></div>
    <div class="modCon" id="artcomment">
		<div>  &nbsp;</div><div>  &nbsp;</div>
    </div><!--modCon-->
        <span class="modBot"></span>
</div><!--commBox end-->
<a href="" id="com_top_top"></a>
<!--<div class="artComm box" style="750px;height:90px;">
<script type="text/javascript">
    var cpro_id = "u2386995";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
</div>--><form action="/comment.php?" method="post" name="form1" id="form1" onsubmit='return commentSubmit(this,"");'>
<span class="blank1"></span>
<div class="box writeComm" style="min-height:30px;">
<a name="comment"></a>
<input name="action" value="comment" type="hidden">
<input id="commenttid" name="tid" value="1229259" type="hidden">
<input name="com_count_ajax" id="com_count_ajax" value="1" type="hidden">

 <div class="title">
	<h2 class="fl">发表评论&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h2>
	<span class="fl" id="messageTj">
<script type="text/javascript"><!--//<![CDATA[
   var m3_u = 
(location.protocol=='https:'?'https://gg.51cto.com/www/delivery/ajs.php':'http://gg2.51cto.com/www/delivery/ajs.php');

   var m3_r = Math.floor(Math.random()*99999999999);
   if (!document.MAX_used) document.MAX_used = ',';
   document.write ("<scr"+"ipt type='text/javascript' src='"+m3_u);
   document.write ("?zoneid=460");
   document.write ('&amp;cb=' + m3_r);
   if (document.MAX_used != ',') document.write ("&amp;exclude=" + 
document.MAX_used);
   document.write (document.charset ? '&amp;charset='+document.charset :
 (document.characterSet ? '&amp;charset='+document.characterSet : ''));
   document.write ("&amp;loc=" + escape(window.location));
   if (document.referrer) document.write ("&amp;referer=" + 
escape(document.referrer));
   if (document.context) document.write ("&context=" + 
escape(document.context));
   if (document.mmm_fo) document.write ("&amp;mmm_fo=1");
   document.write ("'><\/scr"+"ipt>");
//]]>--></script><script type="text/javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/ajs.php"></script><div id="beacon_0a9cf7dbdf" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/lg.gif" alt="" style="width: 0px; height: 0px;" width="0" height="0"></div>

</span>
	<style type="text/css">
		a.mred:link{ color:#ff0000; text-decoration:underline;}
		a.mred:visited{color:#ff0000;}
		a.mred:hover{color:#ff0000;}
		a.mred:active{color:#ff0000;}
	</style>
</div>
<div style="display:none" rel="" id="ggBox">
<script type="text/javascript"><!--//<![CDATA[
   var m3_u = 
(location.protocol=='https:'?'https://gg.51cto.com/www/delivery/ajs.php':'http://gg2.51cto.com/www/delivery/ajs.php');

   var m3_r = Math.floor(Math.random()*99999999999);
   if (!document.MAX_used) document.MAX_used = ',';
   document.write ("<scr"+"ipt type='text/javascript' src='"+m3_u);
   document.write ("?zoneid=460");
   document.write ('&amp;cb=' + m3_r);
   if (document.MAX_used != ',') document.write ("&amp;exclude=" + 
document.MAX_used);
   document.write (document.charset ? '&amp;charset='+document.charset :
 (document.characterSet ? '&amp;charset='+document.characterSet : ''));
   document.write ("&amp;loc=" + escape(window.location));
   if (document.referrer) document.write ("&amp;referer=" + 
escape(document.referrer));
   if (document.context) document.write ("&context=" + 
escape(document.context));
   if (document.mmm_fo) document.write ("&amp;mmm_fo=1");
   document.write ("'><\/scr"+"ipt>");
//]]>--></script><script type="text/javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/ajs.php"></script><div id="beacon_0a9cf7dbdf" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/lg.gif" alt="" style="width: 0px; height: 0px;" width="0" height="0"></div>

</div>
<script>
document.getElementById("messageTj").innerHTML = document.getElementById("ggBox").innerHTML;
</script>
 <div class="modCon">

 <div class="commForm">
<dl>
<dt>昵&nbsp;&nbsp;称：</dt>
<dd>

<input id="commentusername" name="username" class="commInput fl" type="text"><span><a href="http://home.51cto.com/index.php?reback=http%253A%252F%252Fshyluo.blog.51cto.com%252F5725845%252F1229259" style="text-decoration:underline">登录</a>&nbsp;&nbsp;<a href="http://home.51cto.com/user/register?reback=http%253A%252F%252Fshyluo.blog.51cto.com%252F5725845%252F1229259" target="_blank" style="text-decoration: underline;">快速注册</a></span>



</dd>
</dl>



<dl id="commentyanzheng">


<dt>验证码：</dt>
<dd><input class="code" id="commentauthnum" name="authnum" onclick="displaysecunum();" type="text">

  <img class="fl" id="secunum" onclick="refimg()" style="display:none;" width="78" height="29"><p class="fl"><span style="display:none;" id="spanfont">点击图片可刷新验证码</span><span style="display:inline;" id="clickfont">请点击后输入验证码</span><span class="pl5"><a href="http://51ctoblog.blog.51cto.com/26414/5591" target="_blank" style="text-decoration: underline;">博客过2级，无需填写验证码</a></span></p></dd>
</dl>
<dl>
<dt>内&nbsp;&nbsp;容：</dt>
<dd>
<textarea class="writeCommCon f12" id="commentcontent" name="content"></textarea>
</dd>
</dl>
</div>
<div class="writeCommBot">
  <input name="parentid" value="" id="parentid" type="hidden">
  <input class="commBtn fl" name="submit" id="commentsubmit" value="" onclick="commentSubmitend2()" type="button">

 <p class="fl" style="display:none;"><input class="fl" name="favour" id="favour" checked="checked" value="1" type="checkbox"><span class="fl">同时赞一个</span></p>

</div>
<span class="blank"></span>

</div><!--modCon-->
<span class="modBot"></span>
</div>
</form>
<iframe id="iframe1" name="iframe1" width="0" height="0"></iframe>
<!--发表评论 end-->
</div>
</div>
<!-- <div style="width:100px; height:300px; position:fixed; top:25%;left:50%;margin-left:-613px;z-index:100; _position:absolute; _margin-top: 0; _top:expression(documentElement.scrollTop+(documentElement.clientHeight-this.offsetHeight)/2+50);" id="f_close_box">
<img border="0" usemap="#Map1" src="https://s1.51cto.com/wyfs02/M00/93/21/wKiom1kISujgrYSbAADPIiyteUc221.jpg">
<map id="Map1" name="Map1">
<area onclick="document.getElementById('f_close_box').style.display='none';" href="javascript:void(0);" coords="86,14,10"  shape="circle">
</map>

</div> -->
<iframe src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/get-station-ads.htm" style="position: fixed;left:0; top:240px;width:100px; height:300px;" scrolling="no" frameborder="0"></iframe>
<script language="javascript">
	function refimg(){
		var randval = Math.random();
		document.getElementById("secunum").src="/seccode.php?rnum="+randval;
	}
	function displaysecunum()
	{
		var displaystr = document.getElementById("secunum").style.display;
		if(displaystr == 'none')
		{
			refimg();
			document.getElementById("clickfont").style.display = 'none';
			document.getElementById("secunum").style.display = 'inline';
			document.getElementById("spanfont").style.display = 'inline';
		}
	}

	function showMsn(){
		document.getElementById("c02").style.display = "none";
		document.getElementById("c01").style.display = "block";
		document.getElementById("share").style.height = "83px";
		document.getElementById("share").style.background = "none";
	}
	function showBBS(){
		document.getElementById("c01").style.display = "none";
		document.getElementById("c02").style.display = "block";
		document.getElementById("share").style.height = "83px";
		document.getElementById("share").style.background = "none";
	}

	//资源页面，分享按钮
	function copyShareUrl(title){

		if (window.clipboardData){

			if(document.getElementById("c01").style.display == 'block')
			{
				copy = "推荐：" + title + 
"http://shyluo.blog.51cto.com/5725845/1229259";
				var alertText = "复制成功，你可以粘贴到MSN或QQ中发给好友。";
			}
			else
			{
				copy = "[url=" + "http://shyluo.blog.51cto.com/5725845/1229259" + 
"][u]" + title + "[/u][/url]";
				var alertText = "复制成功，你可以粘贴到论坛分享给坛友。";
			}
			window.clipboardData.clearData();
			window.clipboardData.setData("Text", copy);
			alert(alertText);
		}
		else if (window.netscape){
			alert("您使用的浏览器不支持此复制功能，请使用Ctrl+C或鼠标右键。");
			if(document.getElementById("c01").style.display == 'block')
			{
				document.getElementById("shareTextQM").value = "推荐：" + title + 
"http://shyluo.blog.51cto.com/5725845/1229259";
				document.getElementById("shareTextQM").select();
			}
			else
			{
				document.getElementById("shareTextBBS").value = "[url=" + 
"http://shyluo.blog.51cto.com/5725845/1229259" + "][u]" + title + 
"[/u][/url]";
                document.getElementById("shareTextBBS").select();
			}
		}
		return false;
	}
	function select_login(){
		document.getElementById('fixed').style.display='';
	}
	function commentcheck()
	{
		if(document.form1.content.value == "")
		{
			alert("评论内容为空!");
			document.form1.content.focus();
			return false;
		}
	}
	function changename(){

	var memberid=0;
	memberid="";

	if(document.getElementById('commentniming').checked){
		document.getElementById('commentusername').disabled=false;
		document.getElementById('commentusername').value='';
		document.getElementById("indexhidden").style.display="none";
		document.getElementById("commentindex").value='';
		document.getElementById("commentyanzheng").style.display="";
	}else{
		document.getElementById('commentusername').disabled=true;
		document.getElementById('commentusername').value="";
		document.getElementById("indexhidden").style.display="";
		
document.getElementById("commentindex").value="http://.blog.51cto.com";
		if(memberid>8)
		{
			document.getElementById("commentyanzheng").style.display="none";
		}
	}
	}
	function openFavoulist()
	{
		window.open 
('http://blog.51cto.com/mod/favourlist.php?tid=1229259','newwindow','height=300,width=500,top=400,left=400,toolbar=no,menubar=no,scrollbars=no,
 resizable=no,location=no, status=no,z-look=yes');
	}

	var e_zti = document.getElementById('zti');//有专题锚点
	var maodian = window.location.href;//锚点
	if (e_zti) {
		//e_zti.href= (/[#]+/.test(maodian)) ? maodian : maodian + "#zhuanti";
	}
</script>
<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/jquery-1.js"></script>
<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/jquery_002.js"></script>
<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/jquery.js"></script>
<link href="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/blog_top.css" rel="stylesheet" type="text/css">
<!-- <script src="http://blog.51cto.com/js/blog_top_list.php" type="text/javascript" language="javascript"></script> -->
<script type="text/javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/edu_search.js"></script>
<!--<div id="message" class="blogpop" style="background-color:#FFFFFF;z-index:100;width:389px;height:196px;position:absolute; display:none; bottom:0; top:'document.documentElement.scrollTop + document.documentElement.clientHeight-196+'px;right:0; overflow:hidden;"><iframe style="width:800px;height:536px;top:0px;left:0px;position:absolute;visibility:inherit;z-index:-1;" frameborder=0 ></iframe>-->
<!--<div style="height:36px;background:url(http://blog.51cto.com/image/blog_top/popbgx.jpg) repeat-x; position:relative;width:387px;border-right-color:#2668B7;border-right-width:2px;border-right-style:solid 2px #2668B7;"><span style="right:10px;padding:12px 0 0;position:absolute;top:0"><span style="margin-right:80px;color:#828282;width:190px;padding:10px 0 0 10px;font-size:14px">每日博报 精彩不止一点</span><img title="关闭" id="message_close" src="http://blog.51cto.com/image/blog_top/close.jpg" alt="关闭" /></span><div style="width:387px;height:36px;left:0;overflow:hidden; text-indent:-999em;background:url(http://blog.51cto.com/image/blog_top/hdtit.jpg) no-repeat;border-right:solid 2px #2668B7;"><a style="display: block; height: 36px;width:138px;" target="_blank" href="http://blog.51cto.com"></a>-->
<!--</div>-->
<!--<div style="clear:both;"></div>-->
<!--</div>-->
	<!--<div id="message_content" style="border-top:none;font-family:Microsoft YaHei;font-size:12px;width:389px;height:160pxpx;text-align:left;overflow:hidden;">-->
	<!--<script type='text/javascript'>&lt;!&ndash;//<![CDATA[-->
	   <!--var m3_u = (location.protocol=='https:'?'https://gg.51cto.com/www/delivery/ajs.php':'http://gg3.51cto.com/www/delivery/ajs.php');-->
	   <!--var m3_r = Math.floor(Math.random()*99999999999);-->
	   <!--if (!document.MAX_used) document.MAX_used = ',';-->
	   <!--document.write ("<scr"+"ipt type='text/javascript' src='"+m3_u);-->
	   <!--document.write ("?zoneid=454");-->
	   <!--document.write ('&amp;cb=' + m3_r);-->
	   <!--if (document.MAX_used != ',') document.write ("&amp;exclude=" + document.MAX_used);-->
	   <!--document.write (document.charset ? '&amp;charset='+document.charset : (document.characterSet ? '&amp;charset='+document.characterSet : ''));-->
	   <!--document.write ("&amp;loc=" + escape(window.location));-->
	   <!--if (document.referrer) document.write ("&amp;referer=" + escape(document.referrer));-->
	   <!--if (document.context) document.write ("&context=" + escape(document.context));-->
	   <!--if (document.mmm_fo) document.write ("&amp;mmm_fo=1");-->
	   <!--document.write ("'><\/scr"+"ipt>");-->
	<!--//]]>&ndash;&gt;</script>-->
	<!--</div>-->
<!--</div>-->
<style>
.backToTop {
    display: none;
	WIDTH: 45px;
	height:45px;
	BOTTOM: 20px;
     position: fixed;
    _position: absolute;
    right: 140px;
    bottom: 10px;
    _bottom: "auto";
    cursor: pointer;
    opacity: .6;
    filter: Alpha(opacity=60);
	text-indent:-9999px;
}
.tops { background:url(/images/tops.jpg) no-repeat center center; }
</style>
<script>
(function() {
	  $('#showMessagerDim').show();
	   var _html = $("#addTop").html();
	  if(get_cookie('blog_top')==''){
//		 show_pop();
	     jQuery.messager.showblogtop('', _html);
	     $("#message").find("#adTop").show();
	     var date=new Date();
	     var test = date.getTime();
	     document.cookie="blog_top=yes;domain=.blog.51cto.com;expires="+date.toGMTString()+";path=/;";
	     }
	    $("#showMessagerDim").click(function(){
	    	jQuery.messager.showblogtop('', _html);
			$("#message").find("#adTop").show();
			//removeIframe();
		});

		function get_cookie(Name) {
		    var search = Name + "=";
		    var returnvalue = "";
		    if (document.cookie.length > 0) {
		        offset = document.cookie.indexOf(search);
		        if (offset != -1) {
		            offset += search.length;

		            end1 = document.cookie.indexOf(";", offset);

		            if (end1 == -1)
		            end1 = document.cookie.length;
		            returnvalue=unescape(document.cookie.substring(offset, end1));
		        }
		    }
		    return returnvalue;
		}
	})();

</script>
<script type="text/javascript">
(function() {
    var backToTopTxt = "返回顶部", backToTopEle = $('<div class="backToTop tops"></div>').appendTo($("body"))
        .text(backToTopTxt).attr("title", backToTopTxt).click(function() {
            $("html, body").animate({ scrollTop: 0 }, 520);
    }), backToTopFun = function() {
        var st = $(document).scrollTop(), winh = $(window).height();
        (st > 0)? backToTopEle.show(): backToTopEle.hide();
        //IE6下的定位
        if (!window.XMLHttpRequest) {
            backToTopEle.css("top", st + winh - 60);
        }
    };
    $(window).bind("scroll", backToTopFun);
    $(function() { backToTopFun(); });
})();
</script><div class="backToTop tops" title="返回顶部" style="display: block;">返回顶部</div>








<div class="clear"></div>
<!-- <script>
jQuery(function(){
	var html= "<div id=\"sogou_se_tgbar\" style=\"text-align:center;margin:0px auto 2px auto;clear:both;background:url(http://home.51cto.com/public/images/notice/sogou_se_tgbar_bg_final1.gif) repeat-x;width:950px;color:#000;font-size:13px;height:36px;z-index:21474836471\"><div style=\"float:left;cursor:pointer;width:910px;text-align:center;border-left:solid #efbf00 1px;height:32px; line-height:32px;txt-align:center;\"><span style=\"\">	<a href=\"http://51ctoblog.blog.51cto.com/26414/1093282\">【新年祝福征集】51CTO社区年底嘉年华活动正在征集博主祝福语，祝福以红包的形式随机的赠送给访问51CTO的网友 点此送祝福>></a></span></div><div onclick=\"document.getElementById('sogou_se_tgbar').style.display = 'none';\" style=\"float:right;width:20px;cursor:pointer;height:28px;padding:4px 8px 0px 8px;border-right:solid #efbf00 1px\"><img style=\"border:none;margin:4px 0px 0px 0px;\" src=\"http://home.51cto.com/public/images/notice/sogou_se_tgbar_close_final1.gif\"></div></div>"
	jQuery('body').prepend(html);
})
</script> -->

<style>
    .fixexit_small {
        bottom: 185px;
        position: fixed;
        right: 10px;
        z-index: 99;
    }
    .fixexit_small .exit_list {
        margin-top: 4px;
    }
    .fixexit_small .exit_list .ina {
        border-radius: 5px;
        display: block;
        height: 40px;
        text-align: center;
        width: 40px;
    }
    .fixexit_small .exit_list .ina b {
        color: #fff;
        cursor: pointer;
        display: inline-block;
        font-size: 12px;
        font-weight: normal;
        line-height: 15px;
        padding-top: 5px;
        text-align: center;
    }
    .fixexit_small .exit_list_fkui .ina {
        background: #40afff none repeat scroll 0 0;
    }
    .fixexit_small .exit_list_fkui .ina:hover {
        background: #2ea7ff none repeat scroll 0 0;
    }
    .fixexit_small .exit_list_zxun .ina {
        background: #c1c1c1 url("./images/anchor_qq.png") no-repeat scroll 9px 9px;
    }
    .fixexit_small .exit_list_zxun .ina:hover {
        background: #40afff url("./images/anchor_qq.png") no-repeat scroll 9px 9px;
    }
    .fixexit_small .exit_list_zxun .ina img {
        height: 18px;
        width: 18px;
    }
    .fixexit_small .exit_list_gaozhao .ina {
        background: #c1c1c1 url("./images/gaozhao.jpg")  no-repeat center center;
    }
    .fixexit_small .exit_list_gaozhao .ina:hover {
        background: #40afff url("./images/gaozhao.jpg")  no-repeat center center;
    }
    .fixexit_small .exit_list_gaozhao .ina img {
        height: 18px;
        width: 18px;
    }
    .fixexit_small .exit_list_back {
        bottom: 0;
        display: none;
        left: 0;
        position: absolute;
    }
    .fixexit_small .exit_list_back .ina {
        background: #c1c1c1 url("./images/anchor_top.png") no-repeat scroll 10px 12px;
    }
    .fixexit_small .exit_list_back .ina:hover {
        background: #40afff none repeat scroll 0 0;
    }
    .fixexit_small .exit_list_back .ina b {
        display: none;
    }
    .fixexit_small .exit_list_back .ina:hover b {
        display: block;
    }

</style>
<div class="fixexit_small">
    <div class="infixexit" style="font-family: &quot;微软雅黑&quot;">
        <div class="exit_list exit_list_zxun"><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=1173854158&amp;site=qq&amp;menu=yes" class="ina" target="_blank"></a></div>
        <div class="exit_list exit_list_fkui "><span class="ina"><a href="http://51ctoblog.blog.51cto.com/26414/1933645"><b>意见<br>反馈</b></a></span></div>
        <div class="exit_list  exit_list_gaozhao"><a href="http://51ctoblog.blog.51cto.com/" target="_black" class="ina"></a></div>

    </div>
</div>
<div id="footer">
  <div id="innerFooter">
	<center>
		<small>
			Copyright By 51CTO.COM 版权所有<br><br>
			<a href="http://blog.51cto.com/" target="_blank"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/copyright.jpg"></a>
	  </small>
	</center>
  </div>
</div>
<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/index.htm" charset="utf-8"></script><script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/vip_top.js"></script>
<div style="display:none">
<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/count.js"></script><script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/count.htm"></script>
<div style="display:none">
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?2283d46608159c3b39fc9f1178809c21";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
    <script type="text/javascript">
        var uid = "";
        var _educto = _educto || [];
        _educto.push(['_setUserId',uid]);
    </script>

    <script type="text/javascript">
        document.write(decodeURI("%3Cscript 
src='https://tongji.51cto.com/cto.js/d2cb9d6ccefce8d1e89582c2a2a24cc0' 
type='text/javascript'%3E%3C/script%3E"));
        function bdmsPoint(behavior,method){
            _educto.push(['_trackEvent', behavior, method])
        }
        $(function(){
            $(".bdms_point").click(function(){
                
bdmsPoint($(this).attr("data-behavior"),$(this).attr("data-method"));
            })
        })
    </script><script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/d2cb9d6ccefce8d1e89582c2a2a24cc0.htm" type="text/javascript"></script>


</div>
<iframe scrolling="no" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/pageview.htm" width="0" height="0" frameborder="0"></iframe>
</div>

<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/poptop.js"></script>
<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E6%9F%A5%E6%89%BE%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/iframe-member-adv.htm"></script>


</body></html>