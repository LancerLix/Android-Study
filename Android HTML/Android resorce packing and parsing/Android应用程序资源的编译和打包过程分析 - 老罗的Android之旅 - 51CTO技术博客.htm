<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>

<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/hm.js"></script><script id="allmobilize" charset="utf-8" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/allmobilize.js"></script><style type="text/css"></style><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" media="handheld" href="#">

<meta http-equiv="Content-Type" content="text/html; charset=gbk">
<title>Android应用程序资源的编译和打包过程分析 - 老罗的Android之旅 - 51CTO技术博客</title>
<meta name="description" content="&nbsp;&nbsp;&nbsp;&nbsp;我们知道，在一个APK文件中，除了有代码文件之外，还有很多资源文件。这些资源文件是通过Android资源打包工具aapt（AndroidAssetPackageTool）打包到APK文件里面的。在打包之前，大部分..">
<meta name="keywords" content="编译,打包,资源,Android,AAPT">
<meta http-equiv="Cache-Control" content="private">
<!-- base href="http://shyluo.blog.51cto.com/" -->
<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/def.js"></script>
<script language="javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/message.js" type="text/javascript"></script>
<script language="javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/user_comment.js" type="text/javascript"></script>
<script language="javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/base2.js" type="text/javascript"></script>
<script language="javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/dialog_utf8.js" type="text/javascript"></script>
<link href="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/31.css" rel="stylesheet" type="text/css">
<link rel="alternate" href="http://shyluo.blog.51cto.com/rss.php?uid=5725845" type="application/rss+xml" title="RSS 2.0">
<link rel="edituri" type="application/rsd+xml" title="rsd" href="http://shyluo.blog.51cto.com/xmlrpc.php?rsd=1">
<link href="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/header_master_top.css" rel="stylesheet" type="text/css">
<link href="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/base.css" rel="stylesheet" type="text/css">
<style type="text/css">
	.mainNav li a{display:inline-block}
</style>
<script>
var myid = "";
function add_flink(){
	if(myid==""){

        var refurlk = "http://shyluo.blog.51cto.com/5725845/1229261";

				//commentSubmit("",refurlk);
				location.href="http://home.51cto.com/index.php?reback="+encodeURIComponent(encodeURIComponent(refurlk));
				
				return false;
	}else{
		var mtk = "df733f1ae82259e98ce00a722f2b318f";
      		var url='/mod/edit_flink.php?type=addflink&uid=5725845&flink=http://shyluo.blog.51cto.com&mtk='+mtk;
		var ajax = InitAjax1();
		ajax.open("GET", url, true);
		ajax.onreadystatechange = function() {
			if (ajax.readyState == 4 && ajax.status == 200) {
				/*if(myid == 5290427){
					alert(ajax.responseText);
				}*/
				if(ajax.responseText==""){
					alert("添加成功。");
				}
				if(ajax.responseText=="1"){
				alert("链接指向自己。");
				}
				if(ajax.responseText=="2"){
				alert("友情链接已存在。")
				}
				if(ajax.responseText=="4"){
					alert("验证已过期。")
					}
			}
		}
		ajax.send(null);
	}



}
function sendmessage(){

	var refurlk = "http://shyluo.blog.51cto.com/5725845/1229261";

	if(myid){
		return true;
	}else{
		commentSubmit("",refurlk);
		return false;
	}
}
function copylink(ourl){
	if(!ourl){
		var clipBoardContent = "http://shyluo.blog.51cto.com";
	}else{
		var clipBoardContent = ourl;
	}
	window.clipboardData.setData("Text",clipBoardContent);
	alert("复制成功!");
	return false;
}
function correctPNG() {
if (document.getElementById('blog_touxian'))
{
var img = document.getElementById('blog_touxian');
      var imgName = img.src.toUpperCase()
      var imgID = (img.id) ? "id='" + img.id + "' " : ""
      var imgClass = (img.className) ? "class='" + img.className + "' " : ""
      var imgTitle = (img.title) ? "title='" + img.title + "' " : "title='" + img.alt + "' "
      var imgStyle = "display:inline-block;" + img.style.cssText
      if (img.align == "left") imgStyle = "float:left;" + imgStyle
      if (img.align == "right") imgStyle = "float:right;" + imgStyle
      if (img.parentElement.href) imgStyle = "cursor:hand;" + imgStyle
      var strNewHTML = "<span " + imgID + imgClass + imgTitle
         + " style=\"" + "width:" + img.width + "px; height:" + img.height + "px;" + imgStyle + ";"
         + "filter:progid:DXImageTransform.Microsoft.AlphaImageLoader"
         + "(src=\'" + img.src + "\', sizingMethod='scale');\"></span>" ;
      img.outerHTML = strNewHTML;
}
}
//window.attachEvent("onload", correctPNG);
window.onload=correctPNG;

function copy(){
var text=document.getElementById("txtUser").value;
if(copy2Clipboard(text)!=false){ 
alert("复制成功了！ "); 
} 
}
function copy2Clipboard(txt){ 
if(window.clipboardData){ 
window.clipboardData.clearData(); 
window.clipboardData.setData("Text",txt); 
}else if(navigator.userAgent.indexOf("Opera")!=-1){ 
window.location=txt; 
}else if(window.netscape){ 
try{ 
netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"); 
} 
catch(e){ 
alert("您使用的浏览器不支持此复制功能，请使用Ctrl+C或鼠标右键。"); 
return false; 
} 
var clip=Components.classes['@mozilla.org/widget/clipboard;1'].createInstance(Components.interfaces.nsIClipboard); 
if(!clip)return; 
var trans=Components.classes['@mozilla.org/widget/transferable;1'].createInstance(Components.interfaces.nsITransferable); 
if(!trans)return; 
trans.addDataFlavor('text/unicode'); 
var str=new Object(); 
var len=new Object(); 
var str=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString); 
var copytext=txt;str.data=copytext; 
trans.setTransferData("text/unicode",str,copytext.length*2); 
var clipid=Components.interfaces.nsIClipboard; 
if(!clip)return false; 
clip.setData(trans,null,clipid.kGlobalClipboard); 
return true;
} 
}

function mod_close(){
  document.getElementById('mod_tg').style.display="none";
}

function match_invite(uid) {
    var url='/mod/match_invite.php';
	var ajax = InitAjax();
    var re = 'uid=' + uid;
	ajax.open("POST", url, true);
    ajax.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
	ajax.send(re);
    ajax.onreadystatechange = function() {
        if (ajax.readyState == 4 && ajax.status == 200) {
            if(ajax.responseText == 1){
                alert("邀请信息已经发送成功。");
            } else if(ajax.responseText=="-1"){
                alert("邀请失败，请稍候再试。");
            } else if(ajax.responseText=="2"){
                alert("该用户已经报名了。")
            }
        }
    }
}

</script>
<style type="text/css">
/*
.artContent img {max-width:450px !important;}
.showContent img{max-width:650px!important;}
*/

.artContent img{max-width: 450px; width:expression(this.width > 450 ? "450px" : this.width)}
/*
.showContent img{max-width: 450px; width:expression(this.width > 650 ? "650px" : this.width)}
*/


</style>
<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/share.js"></script><style id="table">
.showContent table.noBorderTable td,.showContent table.noBorderTable th,.showContent table.noBorderTable caption{border:1px dashed #ddd !important}.showContent table{margin-bottom:10px;border-collapse:collapse;display:table;}.showContent td,.showContent th{ background:white; padding: 5px 10px;border: 1px solid #DDD;}.showContent caption{border:1px dashed #DDD;border-bottom:0;padding:3px;text-align:center;}.showContent th{border-top:2px solid #BBB;background:#F7F7F7;}.showContent td p{margin:0;padding:0;}
.showContent table.noBorderTable td,.showContent table.noBorderTable th,.showContent table.noBorderTable caption{border:1px dashed #ddd !important}.showContent table{margin-bottom:10px;border-collapse:collapse;display:table;}.showContent td,.showContent th{ background:white; padding: 5px 10px;border: 1px solid #DDD;}.showContent caption{border:1px dashed #DDD;border-bottom:0;padding:3px;text-align:center;}.showContent th{border-top:2px solid #BBB;background:#F7F7F7;}.showContent td p{margin:0;padding:0;}</style><link rel="stylesheet" href="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/share_style1_32.css"></head>

<body>

<div id="home_top">
<div class="top_nav" style="width:990px;">
<div class="left" style="margin-top:10px; width:600px;"><a href="http://blog.51cto.com/" target="_blank"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/head_blog_sibebar_logo.gif" style="margin-top:-4px;" align="absmiddle"></a><!--<a target="_blank" href="http://www.51cto.com">51CTO首页</a>--><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/top_bg_xian.gif" style="margin-top:-4px;" width="16" height="25" align="absmiddle"><a href="http://blog.51cto.com/" target="_blank">首页</a><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/top_bg_xian.gif" style="margin-top:-4px;" width="16" height="25" align="absmiddle"><a href="http://home.51cto.com/?reback=http%253A%252F%252Fshyluo.blog.51cto.com%252F5725845%252F1229261">我的博客</a><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/top_bg_xian.gif" style="margin-top:-4px;" width="16" height="25" align="absmiddle">


   <a href="http://blog.51cto.com/artcommend">推荐博文</a>
    <img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/top_bg_xian.gif" style="margin-top:-4px;" width="16" height="25" align="absmiddle"><a href="http://blog.51cto.com/original/">最新原创</a>
    <img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/top_bg_xian.gif" style="margin-top:-4px;" width="16" height="25" align="absmiddle"><a href="http://blog.51cto.com/expert">专家博客</a>
    <img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/top_bg_xian.gif" style="margin-top:-4px;" width="16" height="25" align="absmiddle"><a href="http://blog.51cto.com/blogcommend">推荐博客</a>
    <img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/top_bg_xian.gif" style="margin-top:-4px;" width="16" height="25" align="absmiddle"><a target="_blank" href="http://so.51cto.com/">搜索</a>
    <!--<a href="javascript:void(0);" style="color:#FF0000; text-decoration:underline; display:none" id="showMessagerDim">每日博报</a>-->
</div>

<div class="right" style="width:380px;">
<div class="more"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/top_shequ.gif" width="27" height="16" align="absmiddle"><a href="javascript:viod(0);" onmouseout="popupClose()" onmouseover="show(3,this)">网站导航<img style="padding-left: 4px;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/nav_ico1.gif" align="absmiddle"></a>            </div>            <span id="login_status"><div class="login" style="padding-top:8px; text-align:right;"><a href="http://home.51cto.com/index?reback=http://shyluo.blog.51cto.com/5725845/1229261" target="_self">登录</a><a href="http://home.51cto.com/user/register?reback=http://shyluo.blog.51cto.com/5725845/1229261" target="_self">注册</a><a href="http://home.51cto.com/members/in-fo?down" target="_blank"><span class="jsVipDrop" style="position: relative;"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/vip_grey2.png" style="float:right; margin-top:5px"><div id="vip_mes_top" style="display:none;position: absolute;right:-75px;top: 17px;width: 137px;z-index: 99;"><div style="background: #faf7e6 none repeat scroll 0 0;border: 1px solid #ecb7a5;color: #666;font-size: 12px;padding: 3px 5px;position: relative;"><span style="background: rgba(0, 0, 0, 0) url(https://static4.51cto.com/home/web/images/hidearro.png) no-repeat scroll center center;display: inline-block;height: 7px;position: absolute;right: 57px;top: -6px;width: 12px;"></span><div style="color:#f60; text-align:center;">一个会员，全站特权</div></div></div></span></a></div></span>                </div>    </div></div>



<div class="subMenu3" id="s3" onmouseover="popupNoClose()" onmouseout="popupClose()">
<ul>

<li><a href="http://edu.51cto.com/" target="_blank">学院</a></li>
<li><a href="http://blog.51cto.com/" target="_blank">博客</a></li>
<li><a href="http://bbs.51cto.com/" target="_blank">论坛</a></li>
<li><a href="http://down.51cto.com/" target="_blank">下载</a></li>
    <li><a href="http://home.51cto.com/" target="_blank">家园</a></li>
<li><a href="http://wot.51cto.com/?blog" target="_blank">WOT峰会</a></li>
    <li><a href="http://www.51cto.com/" target="_blank">51CTO主站</a></li>
</ul>
</div>
<!--简导航end-->



<div class="headerBox">
<div class="header">
<div class="header_l">
<div class="logo_blogname">


<div class="blogLogo">
<a href="http://blog.51cto.com/blogcommend" target="_blank"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/blogLogo01.png" width="161px;" height="70px;"></a>
</div>


<div class="blogName">
<a href="http://shyluo.blog.51cto.com/"><h1>老罗的Android之旅</h1></a>
</div>
</div><!--logo_blogname end-->
<div class="blogLink">

<a href="http://shyluo.blog.51cto.com/">http://shyluo.blog.51cto.com</a> <input id="txtUser" size="32" value="http://shyluo.blog.51cto.com" type="hidden">   <a href="javascript:void(0);" onclick="copy();">【复制】</a> <a href="http://shyluo.blog.51cto.com/rss.php?uid=5725845" target="_blank"></a><a href="http://shyluo.blog.51cto.com/rss.php?uid=5725845" target="_blank">【订阅】</a>

</div>



</div><!--header_l end-->
<div class="header_r">
<div class="blogInfo"><span><a href="http://shyluo.blog.51cto.com/5725845/o" title="察看Luoshengyang所有原创文章">原创</a>:213</span><span><a href="http://shyluo.blog.51cto.com/5725845/t" title="察看Luoshengyang所有翻译文章">翻译</a>:0</span><span><a href="http://shyluo.blog.51cto.com/5725845/c" title="察看Luoshengyang所有转载文章">转载</a>:0</span></div>

</div>
</div>
<!--header end-->
</div><!--headerBox end-->
<div class="mainNav">
<span class="mainNavT"></span>
<ul>
<li><a href="http://shyluo.blog.51cto.com/">主页</a></li>|<li><a href="http://shyluo.blog.51cto.com/5725845/d-1">Android</a></li>|<li><a href="http://shyluo.blog.51cto.com/5725845/d-2">随笔感悟</a></li>
</ul>
<span class="mainNavB"></span>
</div>
<!--mainNav end-->


<style>
.wrap_box{width:750px;float:left;}
.box1{width:368px;background: #fff; border: 0px solid #626262;float:left;height: 162px;}
.mr10{margin-right:10px;}
.newcrumbox{ width:193px; margin:0 auto;}
.a_lsits a{display: inline-block;  height:22px; line-height:22px; padding-left: 28px; color:#555; border:1px solid #d6d6d6; border-radius: 3px; background: #efefef; font-size:12px; margin-bottom: 8px; text-decoration: none; background:url(https://s4.51cto.com/wyfs02/M01/98/95/wKiom1k-Wz6DbAw-AAAQL3nX74k572.png) no-repeat;}
.a_lsits .newicon_d{ width:55px;}
.a_lsits .newicon_l{ width:70px;}
.a_lsits .newicon_1{ background-position: 8px 4px;}
.a_lsits .newicon_2{ background-position: 8px -22px;}
.a_lsits .newicon_3{ background-position: 8px -49px;}
.a_lsits .newicon_4{ background-position: 8px -102px;}
.a_lsits .newicon_5{ background-position: 8px -74px;}
.a_listbot{ text-align: center; margin-top: 5px;}
.a_listbot a{ display: inline-block;font-size:12px;padding-left: 35px;background:url(https://s4.51cto.com/wyfs02/M01/98/95/wKiom1k-Wz6DbAw-AAAQL3nX74k572.png) no-repeat;height:22px; line-height:22px; color:#E93504;text-decoration: none;}
.a_listbot a.style_1{background-position: 8px -74px; }
.a_listbot a.style_2{background-position: 8px -131px;}
</style>
<script type="text/javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/jquery-1.js"></script>
<!--[if IE 6]>
  <script type="text/javascript" src="http://images.watchstor.com/newhomes/png.js"></script>
  <script>
    DD_belatedPNG.fix('img,input,ul,li, .get-box, div, .add, .sub, .ui-slider-handle, .footer-chopper');
  </script>
<![endif]-->
<link type="text/css" rel="stylesheet" href="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/fck_editorarea.css">
<script type="text/javascript" charset="gbk" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/shCores.js"></script>
<link rel="stylesheet" type="text/css" href="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/shCoreDefault.css">
<script type="text/javascript" charset="gbk" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/uparse.js"></script>
<script type="text/javascript">
	uParse('.showContent');
	$(function(){
		//SyntaxHighlighter.config.clipboardSwf = 'http://bbs.51cto.com/plugins/syntaxhighlighter/scripts/clipboard.swf';
		//为了在编辑器之外能展示高亮代码
		SyntaxHighlighter.highlight();
	});
</script>


<script type="text/javascript">
/**
 * 回复评论需要用的js
 * 2012-5-14
 * by:chengtao
 */
 jQuery(function(){
	blogpost.init();//初始化博客回复功能
 })
 /**
  * 处理博文评论功能优化
  */
 blogpost={
	abstruct_list:null,
	init:function(){
		blogpost.bind();//绑定一些时间
		this.abstruct_list=new Array();//初始化保存评论信息的数组
	},
	/**
	 * 博客回复需要绑定的一些事件
	 */
	bind:function(){
		/**
		 * 点击回复的事件
		 */
		jQuery('.repost').live('click',function(){
			blogpost.repost(jQuery(this).attr('user_name'),jQuery(this).attr('parentid'));
			return false;
		});
		/**
		 * 点击楼层进行翻页且找到锚点
		 */
		jQuery('.anchor_page').live('click',function(){
			var parentid = $(this).attr('parentid');
			var tid=$(this).attr('tid');
			$.get('/comments.php?tid='+tid+'&parentid='+parentid,function(data){
				$('#artcomment').html(data);
				window.location.hash=''+parentid;
			})
			return false;
		}),
		jQuery('.anchor_page').live('mouseover',function(){
			var parentid = $(this).attr('parentid');
			if(!blogpost.abstruct_list[parentid]){
				var this_t = $(this);
				$.get('/comments.php?cid='+parentid,function(data,textStatus){
					blogpost.abstruct_list[parentid]=data;
					this_t.attr('title',this_t.text()+':'+ blogpost.abstruct_list[parentid]);
				});
			}else{
				$(this).attr('title',$(this).text()+':'+blogpost.abstruct_list[parentid]);
			}
		})
	},
	/**
	 * @param user_name 用户名
	 * @param parentid  父评论id
	 */
	repost:function(user_name,parentid){
		window.location.hash='comment';
		jQuery('#parentid').val(parentid);
		jQuery('#commentcontent').val('回复 '+user_name+":\n").focus();
		if(!$.browser.mozilla){
			var elem = jQuery('#commentcontent')[0];
			var caretPos = elem.value.length;
			if (elem.createTextRange) {
				var range = elem.createTextRange();
				range.move('character', caretPos);
				range.select();
			}else{
				elem.setSelectionRange(caretPos, caretPos);
			}
		}
	},
	/**
	 * 发送完毕之后清理表单数据 不是ajax可能用不到
	 */
	clean:function(){

	}
 }
</script>
<script type="text/javascript">
jQuery(function(){
	var anchor = document.location.hash;
	var comment_id=anchor.split('#')[1];
	if(!isNaN(parseInt(comment_id))){//是整形
		jQuery.get('/comments.php?tid=1229261&parentid='+comment_id,function(data){
			jQuery('#artcomment').html(data);
			window.location.hash=''+comment_id;
		})
	}
});
</script>

<link type="text/css" rel="stylesheet" href="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/expert_show_layout.css">
<script type="text/javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/expert_show.js"></script>

<script type="text/javascript">
var is_login = false;
var task_rb = 'http://home.51cto.com/index.php?reback=http%253A%252F%252Fshyluo.blog.51cto.com%252F5725845%252F1229261';
</script>




<script type="text/javascript">
jQuery(function() {
	jQuery('#favourdiv').mouseover(function(){
		if(jQuery(this).attr('className') == 'support01')
		{
			jQuery(this).attr('className', "support02");
			jQuery(this).html('+1人');
			jQuery(this).attr('title', "赞一个，我支持TA");
		}
		else if(jQuery(this).attr('className') == 'support03')
		{
			jQuery(this).attr('title', "你已经赞了这篇博文！");
		}

	});
	jQuery('#favourdiv').mouseout(function(){
		if(jQuery(this).attr('className') == 'support02')
		{
			jQuery(this).attr('className', "support01");
			jQuery(this).html("1人");
		}
	});
	jQuery('.blog_match_yq').click(function(){
		var wind_uid = '';
		if(!wind_uid){
			alert("请先登录！");
			return false;
		}
		jQuery.ajax({
			   type: "POST",
			   url:"/contest2012/index.php?mod=sendmsg",
			   dataType: "html",
			   data: "vuid=" + 5725845,
			   success: function(data) {
					if(data == 0)
					{
						alert("查无此人！");
						return false;
					}else if(data == 1){
						alert("请先登录！");
						return false;
					}else if(data == 2){
						alert("不能邀请自己！");
						return false;
					}else if(data == 22){
						alert("邀请信息已发出！");
						return false;
					}
			   }
		  });
	});
	jQuery('#favourdiv').click(function(){
			jQuery.ajax({
			   type: "POST",
			   url:"/mod/favour.php",
			   dataType: "html",
			   data: "tid=" + 1229261,
			   success: function(data) {
					if(data == 0)
					{
						alert("您还未登录或者已过期，请重新登录");
						location.href = "http://home.51cto.com/index.php?reback=http%253A%252F%252Fshyluo.blog.51cto.com%252F5725845%252F1229261";
						return false;
					}
					else if(data == '-1')
					{
						alert("参数传递错误！");
						return false;
					}
					else if(data == '-2')
					{
						alert("该博文已被删除或者不存在！");
						return false;
					}
					else if(data == '-3')
					{
						alert("您已经赞过了！");
						return false;
					}
					else if(data == '-4')
					{
						alert("赞操作失败！");
						return false;
					}
					else
					{
						//alert("操作成功，你已经赞了这篇博文！");
						jQuery('#favourdiv').attr('className', "support03");

						var num = 1 + 1 + "人";
						jQuery('#favourdiv').html(num);
						jQuery('#favourer').html(data);
						return false;
					}
			   }
		  });
	});
	//Jaydar http://blog.51cto.com/js/header.php?uid=blogdb[uid]&tid=tid
	jQuery.post('/js/header.php',{uid:5725845,tid:1229261},function(data){
		jQuery('#readNum').html(data[0]);
		jQuery('#cmtNum').html(data[1]);
	},'json');


})

jQuery(function(){
	jQuery('#darid').bind('click',function(){
		if(confirm("你确定删除此篇文章？")){
			jQuery.ajax({
				'type':'post',
				'url':'user_index.php?action=delarticle',
				'data':{'job':'del', 'selid':'1229261', 'mhash':''},
				'dataType':'html',
				'success':function(res){
					if('ok' == res){
						location.href="http://.blog.51cto.com";
					}

				}
			});
		}
	});
});
</script>




<style type="text/css">
.m_sharelinks{
	line-height:30px;
	text-align:left;
	padding-left:20px;
	//background:url(http://img1.51cto.com/images/share/ico_lb.gif) no-repeat left center;
	float:left;
	width:600px;
	height:30px;
}
.m_sharelinks a{ margin-left:10px;}
.m_sharebtn{ height:50px; width:726px; margin:0 auto;}
.m_sharebtn01{width:520px; float:left;}
.weibo_51cto{ background:url(http://img1.51cto.com/images/share/ico_mweibo.gif) no-repeat center center; display:block; width:33px; height:33px; float:left; margin:3px 3px 0 0;cursor:pointer;}
.shareMored {
    line-height: 30px;
	float:right;
	text-align:right;
	width:100px;
	height:30px;
}

.showContent {
	margin:20px 15px 8px;
}
.userImage img {
    text-align: center;
	border:0;
	padding:0;
}
.photo_links{ line-height:30px; padding-top:5px; font-size:13px;width:170px; margin:0 auto;}
.photo_links_blue{ text-align:center;}
.photo_links_blue a:link,.photo_links_blue a:visited,.photo_links_blue a:hover,.photo_links_blue a:active{ color:#015F91; text-decoration: underline;}
.photo_links_red{ text-align:left;}
.photo_links_red a:link,.photo_links_red a:visited,.photo_links_red a:hover,.photo_links_red a:active{ color:#fc4343; text-decoration:underline;}
.photo_links_red02{ text-align:center;}

.vlist{ margin:10px 10px; height:65px;}
.vlist img{ float:left; margin-right:10px;}
.vlist dl{ text-align:left;}
.vlist dl dt{ height:40px;line-height: 20px; overflow:hidden; padding-top:5px;}
.vlist dl dt,.vlist dl dt a{ color:#262626;}
.vlist dl dd,.vlist dl dd a{ color:#777;}

.video-icon{
    position: relative;
}
.video-icon a.i_video {
    background: url("http://www.51cto.com/images/homepage/Images/eduplay.png") repeat scroll 0 0 rgba(0, 0, 0, 0);
    display: block;
    height: 25px;
    left:31px;
    position: absolute;
    top:22px;
    width: 25px;
    z-index: 10;
}

.ipadFload{ position:fixed; width:136px; height:194px; background:url("http://bbs.51cto.com/images/IPad-bg.png") left top no-repeat #fff; font-family:"微软雅黑"; padding-left:18px;}
.ipadClose{ text-align:right; font-size:14px; line-height:20px;}
.ipadImg{ padding-top:38px;}
.ipadImg img{ width:105px; height:105px;}
.iPadair2{ font-size:12px;}
.iPadair2 a{ color:#659b01; text-decoration:none; background:url("http://bbs.51cto.com/images/51CTO-IPAD-BOTTOM.png") right center no-repeat; display:block; line-height:30px;}

</style>
<div id="add_sys_type_div" style="width:600px;border:1px #58B0DD solid; background-color:#FFF; position:absolute;left:30%;top:300px;display:none;z-index:255"></div>
<div id="add_sys_type_dvs" style="width:550px;border:1px #58B0DD solid; background-color:#FFF; position:absolute;left:30%;top:300px;display:none;z-index:255"></div>




<div class="blogMain">
<div class="blogLeft" style="overflow: visible;">


<div class="box moduleUser">
<div class="title">
<h2><a href="http://shyluo.blog.51cto.com/"><strong>Luoshengyang</strong> 的BLOG  </a></h2>
<div class="floatimg" style="display:none"></div></div>
<div class="modCon">

<div class="blogLevel" uid="5725845"><a href="http://blog.51cto.com/expert" target="_blank" style="display:block;width:46px;height:62px;text-indent:-999px;"><!--<img src="http://blog.51cto.com/image/skin/31.css/zj.png">--></a></div>

<div class="userImage" style="margin: 10px auto 5px;text-align: center;width: 130px;border: 1px solid #D4D4D4;">
	<table width="100%" cellspacing="0" cellpadding="0">
		<tbody><tr>
			<td class="position_r" valign="middle" height="130" align="center"><a href="http://shyluo.blog.51cto.com/"><script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/userface.htm"></script><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar.jpg" id="userface"></a></td>
		</tr>
	</tbody></table>
</div>
<div class="photo_links">
</div>









<div style="width:179px; height:54px; margin:0 auto; clear:both;">
		<a href="http://blog.51cto.com/contest2012/5725845" target="_blank"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/jcbk10.gif"></a>
	</div>

    <div class="newcrumbox">
        <div class="a_lsits">
            <a href="http://home.51cto.com/index.php?s=/Notify/write/uid/5725845" class="newicon_3 newicon_d">发私信</a>
            <a href="http://shyluo.blog.51cto.com/" onclick="add_flink(5725845);return false" class="newicon_5 newicon_l">加友情链接</a>
        </div>
    </div>

<div style="width:239px;height:64px;display:none;">


<div style="float:left;"><p style="padding:15px 0 0 28px; line-height:20px;">2012年度IT博客大赛<br><a target="_blank" href="http://blog.51cto.com/contest2012/#top10000" style="color:#F00; text-decoration:underline;">十大杰出IT博客诞生</a></p></div>
<div style="float:right;"><a target="_blank" href="http://blog.51cto.com/contest2012/5725845"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/blog_match_endlook.jpg" style="margin:23px 20px 0 0;" width="57" height="27"></a></div>



<div class="clear"></div>
</div>


</div><!--modCon end-->
<span class="modBot"></span>
</div>


<div class="infoList box">
<div class="title">
<h2>博客统计信息</h2>
</div>
<div class="modCon">
<p>
<span class="infoListHead"><a href="http://blog.51cto.com/expert" target="_blank" class="operlink"><b>51CTO专家博客</b></a> <a href="http://blog.51cto.com/blogcommend" target="_blank" class="operlink"><b>51CTO推荐博客</b></a> <br></span>
用户名：Luoshengyang<br>
文章数：213<br>
评论数：40<br>
访问量：251931<br>
<a href="http://home.51cto.com/index.php?s=/Account/credit" target="_blank">无忧币</a>：60<br>
<a href="http://51ctoblog.blog.51cto.com/26414/5591" target="_blank">博客积分</a>：2140<br>
<a href="http://51ctoblog.blog.51cto.com/26414/5591" target="_blank">博客等级</a>：6<br>
注册日期：2012-08-13<br>
</p>
</div>
<span class="modBot"></span>
</div>


<div class="infoList box">
	<div class="title">
		<h2 class="fl">热门专题</h2>
		<a target="_blank" class="fr" href="http://blog.51cto.com/zt">更多&gt;&gt;</a>
	</div>
	<div class="modCon" style="height: 348px;">


		<div class="vlist">
		  <a href="http://blog.51cto.com/zt/705" target="_blank"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/wKioL1kxBvqDXivDAAA4F7mg1So675.jpg" width="63" height="63"></a>
		<dl>
		<dt>
		  <a href="http://blog.51cto.com/zt/705" target="_blank" title="Oracle零基础成长之路">Oracle零基础成长之路</a></dt>
		<dd>阅读量：1297</dd>
		</dl>
		</div>

		<div class="vlist">
		  <a href="http://blog.51cto.com/zt/706" target="_blank"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/wKioL1k_SpejGPpUAAA3gnotfPU742.png" width="63" height="63"></a>
		<dl>
		<dt>
		  <a href="http://blog.51cto.com/zt/706" target="_blank" title="原来你也在这里（征文）">原来你也在这里（征文）</a></dt>
		<dd>阅读量：3317</dd>
		</dl>
		</div>

		<div class="vlist">
		  <a href="http://blog.51cto.com/zt/14" target="_blank"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1304672337_index.jpg" width="63" height="63"></a>
		<dl>
		<dt>
		  <a href="http://blog.51cto.com/zt/14" target="_blank" title="从菜鸟到老鸟-教你玩转Mac操作系统">从菜鸟到老鸟-教你玩转Mac操作系统</a></dt>
		<dd>阅读量：448373</dd>
		</dl>
		</div>

		<div class="vlist">
		  <a href="http://blog.51cto.com/zt/20" target="_blank"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1306310178_index.jpg" width="63" height="63"></a>
		<dl>
		<dt>
		  <a href="http://blog.51cto.com/zt/20" target="_blank" title="QT学习之路：从入门到精通">QT学习之路：从入门到精通</a></dt>
		<dd>阅读量：1133306</dd>
		</dl>
		</div>


	</div>
	<span class="modBot"></span>
</div>


<div class="hotArt box">
<div class="title">
<h2>热门文章</h2>
</div>
<div class="modCon">
<ul>
<li><a href="http://shyluo.blog.51cto.com/5725845/1091894">“2012年度IT博客大赛”..</a></li>
<li><a href="http://shyluo.blog.51cto.com/5725845/1338267">从NDK在非Root手机上的调..</a></li>
<li><a href="http://shyluo.blog.51cto.com/5725845/967027">Android系统的开机画面显..</a></li>
<li><a href="http://shyluo.blog.51cto.com/5725845/965994">Android应用程序启动过程..</a></li>
<li><a href="http://shyluo.blog.51cto.com/5725845/967043">Android系统的开机画面显..</a></li>
<li><a href="http://shyluo.blog.51cto.com/5725845/1229285">Android窗口管理服务Wind..</a></li>
<li><a href="http://shyluo.blog.51cto.com/5725845/966525">Android系统默认Home应用..</a></li>
<li><a href="http://shyluo.blog.51cto.com/5725845/966609">Android应用程序键盘（Ke..</a></li>

</ul>
</div>
<span class="modBot"></span>
</div>
<div class="search box">
<div class="title"><h2>搜索BLOG文章</h2></div>
<div class="modCon">
<form method="post" action="search.php?" tabindex="99">
<input name="step" value="2" type="hidden">
<input name="authorid" value="5725845" type="hidden">
<input name="sch_area" value="S" type="hidden">
<input name="keyword" class="searchInput" type="text">
<input value="搜 索" class="searchBtn" type="submit">
</form>
</div><!--modCon end-->
<span class="modBot"></span>
</div>


<div class="box recentGuests">
<div class="title">
<h2>最近访客</h2>
</div>
<div class="modCon">
<ul>

<li><a href="http://10779018.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_006.gif"></a>


<p><a href="http://10779018.blog.51cto.com/">yahos..</a></p>

</li><li><a href="http://5233354.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_010.gif"></a>


<p><a href="http://5233354.blog.51cto.com/">jt705</a></p>

</li><li><a href="http://12923574.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_002.gif"></a>


<p><a href="http://12923574.blog.51cto.com/">Anrui..</a></p>

</li><li><a href="http://2154555.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_009.gif"></a>


<p><a href="http://2154555.blog.51cto.com/">zhupe..</a></p>

</li><li><a href="http://9814162.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_007.gif"></a>


<p><a href="http://9814162.blog.51cto.com/">我是幻神</a></p>

</li><li><a href="http://13058061.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_003.gif"></a>


<p><a href="http://13058061.blog.51cto.com/">wx595..</a></p>

</li><li><a href="http://13153902.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_011.gif"></a>


<p><a href="http://13153902.blog.51cto.com/">oolllpp</a></p>

</li><li><a href="http://10868928.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_005.gif"></a>


<p><a href="http://10868928.blog.51cto.com/">zqnxyz</a></p>

</li><li><a href="http://3075256.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_002.jpg"></a>


<p><a href="http://3075256.blog.51cto.com/">残狼吞月</a></p>

</li><li><a href="http://10265097.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar.gif"></a>


<p><a href="http://10265097.blog.51cto.com/">哈哈..</a></p>

</li><li><a href="http://1820902.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_004.gif"></a>


<p><a href="http://1820902.blog.51cto.com/">cyminge</a></p>

</li><li><a href="http://6820351.blog.51cto.com/" class="position_r"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/avatar_008.gif"></a>


<p><a href="http://6820351.blog.51cto.com/">gj1203</a></p>

</li></ul>
<span class="clear"></span>
</div>
<span class="modBot"></span>
</div>


<div class="newComments box">
<div class="title">
<h2>最新评论

</h2>



</div>
<div class="modCon">
<ul>

<li><a href="http://5542675.blog.51cto.com/" class="operlink" target="_blank"><b>会飞的神</b></a>：<a href="http://shyluo.blog.51cto.com/5725845/1890906" target="_blank">技术大神的世界就是不一样啊</a></li>

<li><a href="http://9695178.blog.51cto.com/" class="operlink" target="_blank"><b>我愿乘峰</b></a>：<a href="http://shyluo.blog.51cto.com/5725845/965994" target="_blank">uml流程图看不清楚</a></li>

<li><a href="http://8233697.blog.51cto.com/" class="operlink" target="_blank"><b>JM_TD</b></a>：<a href="http://shyluo.blog.51cto.com/5725845/1338267" target="_blank">为什么点击这篇文章里的链接都显示404</a></li>

<li><a href="http://7831224.blog.51cto.com/" class="operlink" target="_blank"><b>smth_flydream</b></a>：<a href="http://shyluo.blog.51cto.com/5725845/967084" target="_blank">那其中的vsync_len和hsync_len有什..</a></li>

<li><a href="http://cthhqu.blog.51cto.com/" class="operlink" target="_blank"><b>cthhqu</b></a>：<a href="http://shyluo.blog.51cto.com/5725845/965994" target="_blank">老罗，这篇文章第一张图，也就是那..</a></li>


</ul>
</div>
<span class="modBot"></span>
</div>


<div class="hotBlogArt box">
<div class="title">
  <h2 class="fl">51CTO推荐博文</h2>
  <a href="http://blog.51cto.com/artcommend" class="fr">更多&gt;&gt;</a></div>
<div class="modCon">
<ul>
<li><a href="http://xiaofw.blog.51cto.com/50361/1934224" title="51CTO博客移动化意味着什么？IT博主可以搞事情了！" target="_blank">51CTO博客移动化意味着什么？IT博..</a></li>
<li><a href="http://1754966750.blog.51cto.com/7455444/1919608" title="ActiveMQ（13）：ActiveMQ的集群" target="_blank">ActiveMQ（13）：ActiveMQ的集群</a></li>
<li><a href="http://namesam.blog.51cto.com/12364721/1913232" title="MySQL高可用解决方案MMM" target="_blank">MySQL高可用解决方案MMM</a></li>
<li><a href="http://hubuxcg.blog.51cto.com/2559426/1911803" title="迁移Exchange队列至其它服务器继续传送队列邮件" target="_blank">迁移Exchange队列至其它服务器继..</a></li>
<li><a href="http://renzhiyuan.blog.51cto.com/10433137/1902287" title="HAProxy Nginx LVS Apache总结篇" target="_blank">HAProxy Nginx LVS Apache总结篇</a></li>
<li><a href="http://renzhiyuan.blog.51cto.com/10433137/1898689" title="一次和公司总监的聊天..." target="_blank">一次和公司总监的聊天...</a></li>
<li><a href="http://weiweidefeng.blog.51cto.com/1957995/1895261" title="Linux轻量级自动运维工具-Ansible浅析" target="_blank">Linux轻量级自动运维工具-Ansible..</a></li>
<li><a href="http://yolynn.blog.51cto.com/11575833/1886151" title="运维工作中的bootstraping之PXE自动安装操作系统" target="_blank">运维工作中的bootstraping之PXE自..</a></li>
<li><a href="http://xmdevops.blog.51cto.com/11144840/1877695" title="消息队列_RabbitMQ-0002.深入MQ生产者/信道/交换机/队列/消费者?" target="_blank">消息队列_RabbitMQ-0002.深入MQ生..</a></li>
<li><a href="http://zhang789.blog.51cto.com/11045979/1873435" title="高可用高性能负载均衡软件HAproxy详解指南-第二章（配置文件、关键字、ACL）" target="_blank">高可用高性能负载均衡软件HAproxy..</a></li>
<li><a href="http://jackcui.blog.51cto.com/11877206/1858989" title="由浅入深学习Apache httpd原理与配置" target="_blank">由浅入深学习Apache httpd原理与配置</a></li>

</ul>
</div><!--modCon end-->
<span class="modBot"></span>
</div>


<div class="friendLink box">
<div class="title">
  <h2>友情链接</h2>
</div>
<div class="modCon">
<ul>

<li><a href="http://chenguang.blog.51cto.com/" title="李晨光原创技术博客" target="_blank">李晨光原创技术博客</a></li>

</ul>
</div><!--modCon end-->
<span class="modBot"></span>
</div>



</div>
<!--left end-->

<script type="text/javascript">
    var favor_url = "http://shyluo.blog.51cto.com/5725845/1229261";
    var favor_title = "Android应用程序资源的编译和打包过程分析";
    var favor_fuid = "5725845";
</script>
<script type="text/javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/favorbox.js"></script>


<div class="blogRight" rel="5725845######编译 打包 资源 Android AAPT" id="article_edu_void">
<input value="8" id="edu_jia" type="hidden">

	<!--<p style="clear:both;"  class="edu_insert"></p>-->
	<style type="text/css">
.vlist {
    float: left;
    padding: 2px 0 0 10px;
    width: 218px;

}
.vlist img {
    float: left;
    margin-right: 10px;
}
.vlist dl {
    float: left;
    text-align: left;
    width: 122px;
}
.vlist dl dt {
    height: 44px;
    overflow: hidden;
    padding-top: 5px;
}
.vlist dl dt, .vlist dl dt a {
    color: #262626;
}
.vlist dl dd, .vlist dl dd a {
    color: #777777;
}
.vbox_tit {
    border-bottom: 1px solid #B3D0E6;
    color: #666666;
    font-size: 14px;
    margin-top: 10px;
    text-align: left;
}
.video-icon {
    position: relative;
}
.video-icon a.i_video {
    background: url("http://www.51cto.com/images/homepage/Images/eduplay.png") repeat scroll 0 0 rgba(0, 0, 0, 0);
    display: block;
    height: 25px;
    left: 41px;
    position: absolute;
    top: 22px;
    width: 25px;
    z-index: 10;
}
.vbox2 .vlist1{margin:0;}
.edu-col-a{ float:left;margin-right:6px;}
.edu-col-b{ float:left;}
	</style><!--modCon end-->
	<div class="artShow box" style="margin-top:5px;">
   	  <div class="share" id="share">

    <div class="shareItem">
		<div class="m_sharelinks"><a target="_blank" href="" style="color:red;"></a><a target="_blank" href="" style="color:blue;"></a><a target="_blank" href="" style="color:blue;"></a></div>
		<p class="shareMored"><a href="http://shyluo.blog.51cto.com/all/5725845">博主的更多文章&gt;&gt;</a></p>
	</div>
      </div>
       <div class="modCon">
   	  <div class="showBox" style="margin:0 0 10px;">
      <div class="line_hd_r"></div>
      <div class="art_tj">

      </div>


    		<div class="showHead">
    		  <div class="showTitleBOx" style="text-align:center">
              <div class="showTitle">

             <img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/artType01.jpg">


    		    Android应用程序资源的编译和打包过程分析
                </div>
  		    </div>
   		    <span class="artTime">2013-04-15 00:57:00</span></div><!--showHead end-->
    <div class="showTags">标签：<a href="http://blog.51cto.com/tag-%E7%BC%96%E8%AF%91.html" target="_blank" class="operlink">编译</a> <a href="http://blog.51cto.com/tag-%E6%89%93%E5%8C%85.html" target="_blank" class="operlink">打包</a> <a href="http://blog.51cto.com/tag-%E8%B5%84%E6%BA%90.html" target="_blank" class="operlink">资源</a> <a href="http://blog.51cto.com/tag-Android.html" target="_blank" class="operlink">Android</a> <a href="http://blog.51cto.com/tag-AAPT.html" target="_blank" class="operlink">AAPT</a>

	</div>

			<div class="CopyrightStatement lh22">
            原创作品，允许转载，转载时请务必以超链接形式标明文章 <a href="http://shyluo.blog.51cto.com/5725845/1229261" target="_blank" style="text-decoration:underline">原始出处</a> 、作者信息和本声明。否则将追究法律责任。<a href="http://shyluo.blog.51cto.com/5725845/1229261">http://shyluo.blog.51cto.com/5725845/1229261</a>
            </div>


            <!--正文 begin-->


		  <div class="showContent">
    		  <p> &nbsp; &nbsp; &nbsp; 
&nbsp;我们知道，在一个APK文件中，除了有代码文件之外，还有很多资源文件。这些资源文件是通过Android资源打包工具
aapt（Android Asset Package 
Tool）打包到APK文件里面的。在打包之前，大部分文本格式的XML资源文件还会被编译成二进制格式的XML资源文件。在本文中，我们就详细分析
XML资源文件的编译和打包过程，为后面深入了解Android系统的资源管理框架打下坚实的基础。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;在前面<a href="http://shyluo.blog.51cto.com/5725845/1229262" target="_blank" textvalue="Android资源管理框架（Asset Manager）简要介绍和学习计划">Android资源管理框架（Asset Manager）简要介绍和学习计划</a>一
文中提到，只有那些类型为res/animator、res/anim、res/color、res/drawable（非Bitmap文件，即
非.png、.9.png、.jpg、.gif文件）、res/layout、res/menu、res/values和res/xml的资源文件均会从
文本格式的XML文件编译成二进制格式的XML文件，如图1所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1364831227_6705.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload="" width="614"><br></p><p style="text-align:center;">图1 Android应用程序资源的编译和打包过程</p><p> &nbsp; &nbsp; &nbsp; &nbsp;这些XML资源文件之所要从文本格式编译成二进制格式，是因为：</p><p>
 &nbsp; &nbsp; &nbsp; &nbsp;1. 
二进制格式的XML文件占用空间更小。这是由于所有XML元素的标签、属性名称、属性值和内容所涉及到的字符串都会被统一收集到一个字符串资源池中去，并
且会去重。有了这个字符串资源池，原来使用字符串的地方就会被替换成一个索引到字符串资源池的整数值，从而可以减少文件的大小。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;2. 二进制格式的XML文件解析速度更快。这是由于二进制格式的XML元素里面不再包含有字符串值，因此就避免了进行字符串解析，从而提高速度。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;将XML资源文件从文本格式编译成二进制格式解决了空间占用以及解析效率的问题，但是对于Android资源管理框架来说，这只是完成了其中
的一部分工作。Android资源管理框架的另外一个重要任务就是要根据资源ID来快速找到对应的资源。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;在前面<a href="http://shyluo.blog.51cto.com/5725845/1229262" target="_blank">Android资源管理框架（Asset Manager）简要介绍和学习计划</a>一
文中提到，为了使得一个应用程序能够在运行时同时支持不同的大小和密度的屏幕，以及支持国际化，即支持不同的国家地区和语言，Android应用程序资源
的组织方式有18个维度，每一个维度都代表一个配置信息，从而可以使得应用程序能够根据设备的当前配置信息来找到最匹配的资源来展现在UI上，从而提高用
户体验。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;由于Android应用程序资源的组织方式可以达到18个维度，因此就要求Android资源管理框架能够快速定位最匹配设备当前配置信息的
资源来展现在UI上，否则的话，就会影响用户体验。为了支持Android资源管理框架快速定位最匹配资源，Android资源打包工具aapt在编译和
打包资源的过程中，会执行以下两个额外的操作：</p><p> &nbsp; &nbsp; &nbsp; &nbsp;1. 赋予每一个非assets资源一个ID值，这些ID值以常量的形式定义在一个R.java文件中。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;2. 生成一个resources.arsc文件，用来描述那些具有ID值的资源的配置信息，它的内容就相当于是一个资源索引表。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;有了资源ID以及资源索引表之后，Android资源管理框架就可以迅速将根据设备当前配置信息来定位最匹配的资源了。接下来我们在分析
Android应用程序资源的编译和打包过程中，就主要关注XML资源的编译过程、资源ID文件R.java的生成过程以及资源索引表文件
resources.arsc的生成过程。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;Android资源打包工具在编译应用程序资源之前，会创建一个资源表。这个资源表使用一个ResourceTable对象来描述，当应用程
序资源编译完成之后，它就会包含所有资源的信息。有了这个资源表之后， 
Android资源打包工具就可以根据它的内容来生成资源索引表文件resources.arsc了。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;接下来，我们就通过ResourceTable类的实现来先大概了解资源表里面都有些什么东西，如图2所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365361779_6191.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload="" width="614"><br></p><p style="text-align:center;">图2 ResourceTable的实现</p><p> &nbsp; &nbsp; &nbsp; &nbsp;ResourceTable类用来总体描述一个资源表，它的重要成员变量的含义如下所示：</p><p><strong>--mAssetsPackage</strong>：表示当前正在编译的资源的包名称。</p><p><strong>--mPackages</strong>：表示当前正在编译的资源包，每一个包都用一个Package对象来描述。例如，一般我们在编译应用程序资源时，都会引用系统预先编译好的资源包，这样当前正在编译的资源包除了目标应用程序资源包之外，就还有预先编译好的系统资源包。</p><p><strong>--mOrderedPackages</strong>：和mPackages一样，也是表示当前正在编译的资源包，不过它们是以Package ID从小到大的顺序保存在一个Vector里面的，而mPackages是一个以Package Name为Key的DefaultKeyedVector。</p><p><strong>--mAssets</strong>：表示当前编译的资源目录，它指向的是一个AaptAssets对象。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Package类用来描述一个包，这个包可以是一个被引用的包，即一个预先编译好的包，也可以是一个正在编译的包，它的重要成员变量的含义如下所示：</p><p><strong>--mName</strong>：表示包的名称。</p><p><strong> --mTypes</strong>：表示包含的资源的类型，每一个类型都用一个Type对象来描述。资源的类型就是指animimator、anim、color、drawable、layout、menu和values等。</p><p><strong>--mOrderedTypes</strong>：和mTypes一样，也是表示包含的资源的类型，不过它们是Type ID从小到大的顺序保存在一个Vector里面的，而mTypes是一个以Type Name为Key的DefaultKeyedVector。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Type类用来描述一个资源类型，它的重要成员变量的含义如下所示：</p><p><strong>--mName</strong>：表示资源类型名称。</p><p><strong>--mConfigs</strong>：表示包含的资源配置项列表，每一个配置项列表都包含了一系列同名的资源，使用一个ConfigList来描述。例如，假设有main.xml和sub.xml两个layout类型的资源，那么main.xml和sub.xml都分别对应有一个ConfigList。</p><p><strong>--mOrderedConfigs</strong>：和mConfigs一样，也是表示包含的资源配置项，不过它们是以Entry ID从小到大的顺序保存在一个Vector里面的，而mConfigs是以Entry Name来Key的DefaultKeyedVector。</p><p><strong>--mUniqueConfigs</strong>：表示包含的不同资源配置信息的个数。我们可以将mConfigs和mOrderedConfigs看作是按照名称的不同来划分资源项，而将mUniqueConfigs看作是按照配置信息的不同来划分资源项。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;ConfigList用来描述一个资源配置项列表，它的重要成员变量的含义如下所示：</p><p><strong>--mName</strong>：表示资源项名称，也称为Entry Name。</p><p><strong>--mEntries</strong>：
表示包含的资源项，每一个资源项都用一个Entry对象来描述，并且以一个对应的ConfigDescription为Key保存在一个
DefaultKeyedVector中。例如，假设有一个名称为icon.png的drawable资源，有三种不同的配置，分别是ldpi、mdpi
和hdpi，那么以icon.png为名称的资源就对应有三个项。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Entry类用来描述一个资源项，它的重要成员变量的含义如下所示：</p><p><strong>--mName</strong>：表示资源名称。</p><p><strong>--mItem</strong>：表示资源数据，用一个Item对象来描述。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Item类用来描述一个资源项数据，它的重要成员变量的含义如下所示：</p><p><strong>--value</strong>：表示资源项的原始值，它是一个字符串。</p><p><strong>--parsedValue</strong>：表示资源项原始值经过解析后得到的结构化的资源值，使用一个Res_Value对象来描述。例如，一个整数类型的资源项的原始值为“12345”，经过解析后，就得到一个大小为12345的整数类型的资源项。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;ConfigDescription类是从ResTable_config类继承下来的，用来描述一个资源配置信息。
ResTable_config类的成员变量imsi、locale、screenType、input、screenSize、version和
screenConfig对应的实际上就是在前面<a href="http://shyluo.blog.51cto.com/5725845/1229262" target="_blank" textvalue="Android资源管理框架（Asset Manager）简要介绍和学习计划">Android资源管理框架（Asset Manager）简要介绍和学习计划</a>一文提到的18个资源维度。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;前面提到，当前正在编译的资源目录是使用一个AaptAssets对象来描述的，它的实现如图3所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1364933259_8915.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload="" width="614"><br></p><p style="text-align:center;">图3 AaptAssets类的实现</p><p> &nbsp; &nbsp; &nbsp; &nbsp;AaptAssets类的重要成员变量的含义如下所示：</p><p><strong>--mPackage</strong>：表示当前正在编译的资源的包名称。</p><p><strong>--mRes</strong>：表示所包含的资源类型集，每一个资源类型都使用一个ResourceTypeSet来描述，并且以Type Name为Key保存在一个KeyedVector中。</p><p><strong>--mHaveIncludedAssets</strong>：表示是否有引用包。</p><p><strong>--mIncludedAssets</strong>：指向的是一个AssetManager，用来解析引用包。引用包都是一些预编译好的资源包，它们需要通过AssetManager来解析。事实上，Android应用程序在运行的过程中，也是通过AssetManager来解析资源的。</p><p><strong>--mOverlay</strong>：
表示当前正在编译的资源的重叠包。重叠包是什么概念呢？假设我们正在编译的是Package-1，这时候我们可以设置另外一个Package-2，用来告
诉aapt，如果Package-2定义有和Package-1一样的资源，那么就用定义在Package-2的资源来替换掉定义在Package-1的
资源。通过这种Overlay机制，我们就可以对资源进行定制，而又不失一般性。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;ResourceTypeSet类实际上描述的是一个类型为AaptGroup的KeyedVector，并且这个KeyedVector是
以AaptGroup 
Name为Key的。AaptGroup类描述的是一组同名的资源，类似于前面所描述的ConfigList，它有一个重要的成员变量mFiles，里面
保存的就是一系列同名的资源文件。每一个资源文件都是用一个AaptFile对象来描述的，并且以一个AaptGroupEntry为Key保存在一个
DefaultKeyedVector中。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;AaptFile类的重要成员变量的含义如下所示：</p><p><strong>--mPath</strong>：表示资源文件路径。</p><p><strong>--mGroupEntry</strong>：表示资源文件对应的配置信息，使用一个AaptGroupEntry对象来描述。</p><p><strong>--mResourceType</strong>：表示资源类型名称。</p><p><strong>--mData</strong>：表示资源文件编译后得到的二进制数据。</p><p><strong>--mDataSize</strong>：表示资源文件编译后得到的二进制数据的大小。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;AaptGroupEntry类的作用类似前面所描述的ResTable_config，它的成员变量mcc、mnc、locale、
vendor、screenLayoutSize、screenLayoutLong、orientation、uiModeType、
uiModeNight、density、tounscreen、keysHidden、keyboard、navHidden、navigation、
screenSize和version对应的实际上就是在前面<a href="http://shyluo.blog.51cto.com/5725845/1229262" target="_blank" textvalue="Android资源管理框架（Asset Manager）简要介绍和学习计划">Android资源管理框架（Asset Manager）简要介绍和学习计划</a>一文提到的18个资源维度。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;了解了ResourceTable类和AaptAssets类的实现之后，我们就可以开始分析Android资源打包工具的执行过程了，如图4所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1364935769_4855.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图4 Android资源打包工具的执行过程</p><p><br></p><p><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;假设我们当前要编译的应用程序资源目录结构如下所示：</span></p><p><br></p><div><div id="highlighter_383078" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">project</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">--AndroidManifest.xml</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">--res</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">--drawable-ldpi</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">--icon.png</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">--drawable-mdpi</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">--icon.png</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">--drawable-hdpi</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">--icon.png</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">--layout</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">--main.xml</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">--sub.xml</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">--values</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">--strings.xml</code></div></div></td></tr></tbody></table></div></div><p><br></p><p> &nbsp; &nbsp; &nbsp; &nbsp; 接下来，我们就按照图4所示的步骤来分析上述<span style="text-align:center;">应用程序资源的编译和打包过程。</span></p><p><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp; 一. 解析AndroidManifest.xml</span></p><p><span style="text-align:center;"><span style="text-align:center;">解析AndroidManifest.xml是为了获得要编译资源的应用程序的包名称。我们知道，在<span style="text-align:center;">AndroidManifest.xml文件中，manifest标签的package属性的值描述的就是应用程序的包名称。</span>有了这个包名称之后，就可以创建资源表了，即创建一个ResourceTable对象。</span></span></p><p><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp; 二. 添加被引用资源包</span></span></p><p><span style="text-align:center;"><span style="text-align:center;">
 &nbsp; &nbsp; &nbsp; &nbsp; 
Android系统定义了一套通用资源，这些资源可以被应用程序引用。例如，我们在XML布局文件中指定一个LinearLayout的
android:orientation属性的值为“vertical”时，这个<span style="text-align:center;">“vertical”实际上就是在系统资源包里面定义的一个值。</span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;在Android源代码工程环境中，<span style="text-align:center;">Android系统提供的资源经过编译后，就位于out/target/common/obj/APPS/framework-res_intermediates/package-export.apk文件中，因此，在<span style="text-align:center;">Android源代码工程环境中编译的应用程序资源，都会引用到这个<span style="text-align:center;">package-export.apk。</span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;">
 &nbsp; &nbsp; &nbsp; 
&nbsp;从上面的分析就可以看出，我们在编译一个Android应用程序的资源的时候，至少会涉及到两个包，其中一个被引用的系统资源包，另外一个就
是当前正在编译的应用程序资源包。每一个包都可以定义自己的资源，同时它也可以引用其它包的资源。那么，一个包是通过什么方式来引用其它包的资源的呢？这
就是我们熟悉的资源ID了。</span></span></span></span></span></span><span style="text-align:center;">资源ID是一个4字节的无符号整数，其中，最高字节表示Package ID，次高字节表示Type ID，最低两字节表示Entry ID。</span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;">
 &nbsp; &nbsp; &nbsp; &nbsp;Package 
ID相当于是一个命名空间，限定资源的来源。Android系统当前定义了两个资源命令空间，其中一个系统资源命令空间，它的Package 
ID等于0x01，另外一个是应用程序资源命令空间，它的Package ID等于0x7f。所有位于[0x01, 0x7f]之间的Package 
ID都是合法的，而在这个范围之外的都是非法的<span style="text-align:center;">Package ID。前面提到的系统资源包<span style="text-align:center;">package-export.apk的Package ID就等于0x01，而我们在应用程序中定义的资源的Package ID的值都等于0x7f，这一点可以通过生成的R.java文件来验证。</span></span></span></span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;Type ID是指资源的类型ID。资源的类型有animator、anim、color、drawable、layout、menu、raw、string和xml等等若干种，每一种都会被赋予一个ID。</span></span></span></span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;Entry ID是指每一个资源在其所属的资源类型中所出现的次序。注意，不同类型的资源的Entry ID有可能是相同的，但是由于它们的类型不同，我们仍然可以通过其资源ID来区别开来。</span></span></span></span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;关于资源ID的更多描述，以及资源的引用关系，可以参考frameworks/base/libs/utils目录下的README文件。</span></span></span></span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;三. 收集资源文件</span></span></span></span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;在编译应用程序资源之前，Android资源打包工具aapt会创建一个AaptAssets对象，用来收集当前需要编译的资源文件。这些需要编译的资源文件就保存在<span style="text-align:center;">AaptAssets类的成员变量mRes中，如下所示：</span></span></span></span></span></span></span></span></span></span></p><p><br></p><div><div id="highlighter_65308" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">class</code> <code class="java plain">AaptAssets : </code><code class="java keyword">public</code> <code class="java plain">AaptDir</code></div><div class="line number2 index1 alt1"><code class="java plain">{</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number4 index3 alt1"><code class="java keyword">private</code><code class="java plain">:</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">KeyedVector&lt;String8, sp&lt;ResourceTypeSet&gt; &gt;* mRes;</code></div><div class="line number7 index6 alt2"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p><span style="text-align:center;">AaptAssets类定义在文件frameworks/base/tools/aapt/AaptAssets.h中。</span></p><p><span style="text-align:center;"><span style="text-align:center;">AaptAssets类的成员变量mRes是一个类型为ResourceTypeSet的KeyedVector，这个<span style="text-align:center;">KeyedVector
的Key就是资源的类型名称。由此就可知，收集到资源文件是按照类型来保存的。例如，对于我们在这篇文章中要用到的例子，一共有三种类型的资源，分别是
drawable、layout和values，于是，就对应有三个ResourceTypeSet。</span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;从前面的图3可以看出，<span style="text-align:center;">ResourceTypeSet类本身描述的也是一个KeyedVector，不过它里面保存的是一系列有着相同文件名的AaptGroup。<span style="text-align:center;">例如，对于我们在这篇文章中要用到的例子：</span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;1. 类型为drawable的<span style="text-align:center;">ResourceTypeSet只有一个AaptGroup，它的名称为icon.png。这个<span style="text-align:center;">AaptGroup包含了三个文件，分别是res/drawable-ldpi/icon.png、<span style="text-align:center;">res/drawable-mdpi/icon.png和<span style="text-align:center;">res/drawable-hdpi/icon.png。每一个文件都用一个AaptFile来描述，并且都对应有一个AaptGroupEntry。每一个<span style="text-align:center;">AaptGroupEntry描述的都是不同的资源配置信息，即它们所描述的屏幕密度分别是ldpi、mdpi和hdpi。</span></span></span></span></span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;2. 类型为layout的<span style="text-align:center;">ResourceTypeSet有两个AaptGroup，它们的名称分别为main.xml和sub.xml。这两个<span style="text-align:center;">AaptGroup都是只包含了一个AaptFile，分别是res/layout/main.xml和res/layout/sub.xml。这两个<span style="text-align:center;">AaptFile</span>同样是分别对应有一个<span style="text-align:center;">AaptGroupEntry，不过这两个<span style="text-align:center;">AaptGroupEntry描述的资源配置信息都是属于default的。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;3. 类型为values的<span style="text-align:center;">ResourceTypeSet只有一个AaptGroup，它的名称为strings.xml。这个<span style="text-align:center;">AaptGroup只包含了一个AaptFile，即res/values/strings.xml。这个<span style="text-align:center;">AaptFile也对应有一个<span style="text-align:center;">AaptGroupEntry，这个<span style="text-align:center;">AaptGroupEntry描述的资源配置信息也是属于default的。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;四. 将收集到的资源增加到资源表</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;前面收集到的资源只是保存在一个AaptAssets对象中，这一步需要将这些资源同时增加到一个资源表中去，即增加到前面所创建的一个ResourceTable对象中去，因为最后我们需要根据这个<span style="text-align:center;">ResourceTable来生成资源索引表，即生成resources.arsc文件。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;注意，这一步收集到资源表的资源是不包括values类型的资源的。类型为<span style="text-align:center;">values的资源比较特殊，它们要经过编译之后，才会添加到资源表中去。这个过程我们后面再描述。</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;从前面的图2可以看出，在ResourceTable类中，每一个资源都是分别用一个Entry对象来描述的，这些Entry分别按照Pacakge、Type和ConfigList来分类保存。例如，<span style="text-align:center;">对于我们在这篇文章中要用到的例子，假设它的包名为“shy.luo.activity”，那么在<span style="text-align:center;">ResourceTable类的成员变量mPackages和mOrderedPackages中，就会分别保存有一个名称为<span style="text-align:center;">“</span><span style="text-align:center;">shy.luo.activity</span><span style="text-align:center;">”的Package，如下所示：</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></p><p><br></p><div><div id="highlighter_422667" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">class</code> <code class="java plain">ResourceTable : </code><code class="java keyword">public</code> <code class="java plain">ResTable::Accessor</code></div><div class="line number2 index1 alt1"><code class="java plain">{</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number4 index3 alt1"><code class="java keyword">private</code><code class="java plain">:</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">DefaultKeyedVector&lt;String16, sp&lt;Package&gt; &gt; mPackages;</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Vector&lt;sp&lt;Package&gt; &gt; mOrderedPackages;</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number10 index9 alt1"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p><span style="text-align:center;">ResourceTable类定义在文件frameworks/base/tools/aapt/ResourceTable.h中。</span></p><p><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; 在这个名称为<span style="text-align:center;">“shy.luo.activity”的Package中，分别包含有drawable和layout两种类型的资源，每一种类型使用一个Type对象来描述，其中：</span></span></p><p><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; 1. 类型为<span style="text-align:center;">drawable的Type包含有一个ConfigList。这个ConfigList的名称为icon.png，包含有三个Entry，分别为res/drawable-ldip/icon.png、<span style="text-align:center;">res/drawable-mdip/icon.png和<span style="text-align:center;">res/drawable-hdip/icon.png。每一个Entry都对应有一个ConfigDescription，用来描述不同的资源配置信息，即分别用来描述ldpi、mdpi和hdpi三种不同的屏幕密度。</span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; 2. 类型为layout的Type包含有两个ConfigList。这两个ConfigList的名称分别为main.xml和sub.xml。名称为<span style="text-align:center;">main.xml的<span style="text-align:center;">ConfigList包含有一个Entry，即res/layout/main.xml。名称为sub.xml的ConfigList包含有一个Entry，即res/layout/sub/xml。</span></span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; 上述得到的五个Entry分别对应有五个Item，它们的对应关系以及内容如下图5所示：</span></span></span></span></span></span></span></p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365060282_4675.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图5 收集到的drawable和layout资源项列表</p><p style="text-align:left;"> &nbsp; &nbsp; &nbsp; &nbsp;五. 编译values类资源</p><p style="text-align:left;"> &nbsp; &nbsp; &nbsp; &nbsp;类型为values的资源描述的都是一些简单的值，如数组、颜色、尺寸、字符串和样式值等，这些资源是在编译的过程中进行收集的。接下来，我们就以字符串的编译过程来进行说明。</p><p style="text-align:left;"><span style="text-align:center;">在这篇文章中要用到的例子中，包含有一个strings.xml的文件，它的内容如下所示：</span></p><p><br></p><div><div id="highlighter_434766" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">&lt;?xml version=</code><code class="java string">"1.0"</code> <code class="java plain">encoding=</code><code class="java string">"utf-8"</code><code class="java plain">?&gt;</code></div><div class="line number2 index1 alt1"><code class="java plain">&lt;resources&gt;</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">&lt;string name=</code><code class="java string">"app_name"</code><code class="java plain">&gt;Activity&lt;/string&gt;</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">&lt;string name=</code><code class="java string">"sub_activity"</code><code class="java plain">&gt;Sub Activity&lt;/string&gt;</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">&lt;string name=</code><code class="java string">"start_in_process"</code><code class="java plain">&gt;Start sub-activity in process&lt;/string&gt;</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">&lt;string name=</code><code class="java string">"start_in_new_process"</code><code class="java plain">&gt;Start sub-activity in </code><code class="java keyword">new</code> <code class="java plain">process&lt;/string&gt;</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">&lt;string name=</code><code class="java string">"finish"</code><code class="java plain">&gt;Finish activity&lt;/string&gt;</code></div><div class="line number8 index7 alt1"><code class="java plain">&lt;/resources&gt;</code></div></div></td></tr></tbody></table></div></div><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;这个文件经过编译之后，资源表就多了一个名称为string的Type，这个Type有五个ConfigList。这五个
ConfigList的名称分别为“app_name”、“sub_activity”、“start_in_process”、
“start_in_new_process”和“finish”，每一个ConfigList又分别含有一个Entry。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;上述得到的五个Entry分别对应有五个Item，它们的对应关系以及内容如图6所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365063005_9437.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图6 收集到的string资源项列表</p><p> &nbsp; &nbsp; &nbsp; &nbsp;六. 给Bag资源分配ID</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;类型为values的资源除了是string之外，还有其它很多类型的资源，其中有一些比较特殊，如bag、style、plurals和
array类的资源。这些资源会给自己定义一些专用的值，这些带有专用值的资源就统称为Bag资源。例如，Android系统提供的
android:orientation属性的取值范围为｛“vertical”、“horizontal”｝，就相当于是定义了vertical和
horizontal两个Bag。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;在继续编译其它非values的资源之前，我们需要给之前收集到的Bag资源分配资源ID，因为它们可能会被其它非values类资源引用
到。假设在res/values目录下，有一个attrs.xml文件，它的内容如下所示：</p><p><br></p><div><div id="highlighter_706196" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">&lt;?xml version=</code><code class="java string">"1.0"</code> <code class="java plain">encoding=</code><code class="java string">"utf-8"</code><code class="java plain">?&gt;</code></div><div class="line number2 index1 alt1"><code class="java plain">&lt;resources&gt;</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">&lt;attr name=</code><code class="java string">"custom_orientation"</code><code class="java plain">&gt;</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">&lt;</code><code class="java keyword">enum</code> <code class="java plain">name=</code><code class="java string">"custom_vertical"</code> <code class="java plain">value=</code><code class="java string">"0"</code> <code class="java plain">/&gt;</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">&lt;</code><code class="java keyword">enum</code> <code class="java plain">name=</code><code class="java string">"custom_horizontal"</code> <code class="java plain">value=</code><code class="java string">"1"</code> <code class="java plain">/&gt;</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">&lt;/attr&gt;</code></div><div class="line number7 index6 alt2"><code class="java plain">&lt;/resources&gt;</code></div></div></td></tr></tbody></table></div></div><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;这个文件定义了一个名称为“custom_orientation”的属性，它是一个枚举类型的属性，可以取值为
“custom_vertical”或者“custom_horizontal”。Android资源打包工具aapt在编译这个文件的时候，就会生成以
下三个Entry，如图7所示：</p><p><br></p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365091720_9787.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""></p><p style="text-align:center;">图7 收集到的Bag资源项列表</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;上述三个Entry均为Bag资源项，其中，custom_vertical（id类型资源）和custom_horizontal（ 
id类型资源）是custom_orientation（attr类型资源）的两个bag，我们可以将custom_vertical和
custom_horizontal看成是custom_orientation的两个元数据，用来描述custom_orientation的取值范
围。实际上，custom_orientation还有一个内部元数据，用来描述它的类型。这个内部元数据也是通过一个bag来表示的，这个bag的名称
和值分别为“^type”和TYPE_ENUM，用来表示它描述的是一个枚举类型的属性。注意，所有名称以“^”开头的bag都是表示一个内部元数据。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;对于Bag资源来说，这一步需要给它们的元数据项分配资源ID，也就是给它们的bag分配资源ID。例如，对于上述的
custom_orientation来说，我们需要给它的^type、custom_vertical和custom_horizontal分配资源
ID，其中，^type分配到的是attr类型的资源ID，而custom_vertical和custom_horizontal分配到的是id类型的
资源ID。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;七. 编译Xml资源文件</p><p> &nbsp; 
&nbsp; &nbsp; 
&nbsp;前面的六步操作为编译Xml资源文件准备好了所有的素材，因此，现在就开始要编译Xml资源文件了。除了values类型的资源文件，其它所
有的Xml资源文件都需要编译。这里我们只挑layout类型的资源文件来说明Xml资源文件的编译过程，也就是<span style="text-align:center;">这篇文章中要用到的例子中的main.xml文件，它的内容如下所示：</span></p><p><br></p><div><div id="highlighter_807712" class="syntaxhighlighter  html"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;?</code><code class="html keyword">xml</code> <code class="html color1">version</code><code class="html plain">=</code><code class="html string">"1.0"</code> <code class="html color1">encoding</code><code class="html plain">=</code><code class="html string">"utf-8"</code><code class="html plain">?&gt;</code></div><div class="line number2 index1 alt1"><code class="html plain">&lt;</code><code class="html keyword">LinearLayout</code> <code class="html color1">xmlns:android</code><code class="html plain">=</code><code class="html string">"http://schemas.android.com/apk/res/android"</code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html color1">android:orientation</code><code class="html plain">=</code><code class="html string">"vertical"</code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html color1">android:layout_width</code><code class="html plain">=</code><code class="html string">"fill_parent"</code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html color1">android:layout_height</code><code class="html plain">=</code><code class="html string">"fill_parent"</code></div><div class="line number6 index5 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html color1">android:gravity</code><code class="html plain">=</code><code class="html string">"center"</code><code class="html plain">&gt;</code></div><div class="line number7 index6 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">Button</code></div><div class="line number8 index7 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html color1">android:id</code><code class="html plain">=</code><code class="html string">"@+id/button_start_in_process"</code></div><div class="line number9 index8 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html color1">android:layout_width</code><code class="html plain">=</code><code class="html string">"wrap_content"</code></div><div class="line number10 index9 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html color1">android:layout_height</code><code class="html plain">=</code><code class="html string">"wrap_content"</code></div><div class="line number11 index10 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html color1">android:gravity</code><code class="html plain">=</code><code class="html string">"center"</code></div><div class="line number12 index11 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html color1">android:text</code><code class="html plain">=</code><code class="html string">"@string/start_in_process"</code> <code class="html plain">&gt;</code></div><div class="line number13 index12 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">Button</code><code class="html plain">&gt;</code></div><div class="line number14 index13 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">Button</code></div><div class="line number15 index14 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html color1">android:id</code><code class="html plain">=</code><code class="html string">"@+id/button_start_in_new_process"</code></div><div class="line number16 index15 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html color1">android:layout_width</code><code class="html plain">=</code><code class="html string">"wrap_content"</code></div><div class="line number17 index16 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html color1">android:layout_height</code><code class="html plain">=</code><code class="html string">"wrap_content"</code></div><div class="line number18 index17 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html color1">android:gravity</code><code class="html plain">=</code><code class="html string">"center"</code></div><div class="line number19 index18 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html color1">android:text</code><code class="html plain">=</code><code class="html string">"@string/start_in_new_process"</code> <code class="html plain">&gt;</code></div><div class="line number20 index19 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;/</code><code class="html keyword">Button</code><code class="html plain">&gt;</code></div><div class="line number21 index20 alt2"><code class="html plain">&lt;/</code><code class="html keyword">LinearLayout</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;Xml资源文件<span style="text-align:center;">main.xml的编译过程如图8所示：</span></p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365094307_9323.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""></p><p style="text-align:center">图8 Xml资源文件的编译过程</p><p><br></p><p> &nbsp; &nbsp; &nbsp; &nbsp;1. 解析Xml文件</p><p> &nbsp; &nbsp; &nbsp; &nbsp; 解析Xml文件是为了可以在内存中用一系列树形结构的XMLNode来表示它。XMLNode类的定义在文件frameworks/base/tools/aapt/XMLNode.h中，如下所示：</p><p><br></p><div><div id="highlighter_657034" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">class</code> <code class="java plain">XMLNode : </code><code class="java keyword">public</code> <code class="java plain">RefBase</code></div><div class="line number2 index1 alt1"><code class="java plain">{</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number4 index3 alt1"><code class="java keyword">private</code><code class="java plain">:</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String16 mElementName;</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Vector&lt;sp&lt;XMLNode&gt; &gt; mChildren;</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Vector&lt;attribute_entry&gt; mAttributes;</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">String16 mChars;</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number12 index11 alt1"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;每一个XMLNode都表示一个Xml元素，其中：</p><p><br></p><p><strong>--mElementName</strong>，表示Xml元素标签。</p><p><strong>--mChars</strong>，表示Xml元素的文本内容。</p><p><strong>--mAttributes</strong>，表示Xml元素的属性列表。</p><p><strong>--mChildren</strong>，表示Xml元素的子元素。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Xml文件解析完成之后，就可以得到一个用来描述根节点的XMLNode，接下来就可以通过这个根节点来完成其它的编译操作。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;2. 赋予属性名称资源ID</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;这一步实际上就是给每一个Xml元素的属性名称都赋予资源ID。例如，对于main.xml文件的根节点LinearLayout来说，就是
要分别给它的属性名称“android:orientation”、“android:layout_width”、
“android:layout_height”和“android:gravity”赋予一个资源ID。注意，上述这些属性都是在系统资源包里面定义
的，因此，Android资源打包工具首先是要在系统资源包里面找到这些名称所对应的资源ID，然后才能赋给main.xml文件的根节点
LinearLayout。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;对于系统资源包来说，“android:orientation”、“android:layout_width”、
“android:layout_height”和“android:gravity”等这些属性名称是它定义的一系列Bag资源，在它被编译的时候，就
已经分配好资源ID了，就如上面的第六步操作所示。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;每一个Xml文件都是从根节点开始给属性名称赋予资源ID，然后再给递归给每一个子节点的属性名称赋予资源ID，直到每一个节点的属性名称都获得了资源ID为止。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;3. 解析属性值</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;上一步是对Xml元素的属性的名称进行解析，这一步是对Xml元素的属性的值进行解析。例如，对于对于main.xml文件的根节点
LinearLayout来说，前面我们已经给它的属性android:orientation的名称赋予了一个资源ID，这里就要给它的值
“vertical”进行解析。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;前面提到，android:orientation是在系统资源包定义的一个Bag资源，这个Bag资源分配有资源ID，而且会指定有元数
据，也就是它可以取哪些值。对于android:orientation来说，它的合法取值就为“horizontal”或者“vertical”。在系
统资源包中，“horizontal”或者“vertical”也同样是一个Bag资源，它们的值分别被定义为0和1。</p><p> &nbsp; 
&nbsp; &nbsp; 
&nbsp;Android资源打包工具是如何找到main.xml文件的根节点LinearLayout的属性android:orientation
的字符串值“vertical”所对应的整数值1的呢？假设在上一步中，从系统资源包找到“android:orientation”的资源ID为
0x010100c4，那么Android资源打包工具就会通过这个资源ID找到它的元数据，也就是两个名称分别为“horizontal”和
“vertical”的bag，接着就根据字符串匹配到名称“vertical”的bag，最后就可以将这个bag的值1作为解析结果了。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;注意，对于引用类型的属性值，要进行一些额外的处理。例如，对于main.xml文件的第一个Button节点的android:id属性值
“@+id/button_start_in_process”，其中，“@”表示后面描述的属性是引用类型的，“+”表示如果该引用不存在，那么就新建
一个，“id”表示引用的资源类型是id，“button_start_in_process”表示引用的名称。实际上，在"id"前面，还可以指定一个
包名，例如，将main.xml文件的第一个Button节点的android:id属性值指定为“@+
[package:]id/button_start_in_process” 
。如果没有指定包名的话，那么就会默认在当前编译的包里面查找button_start_in_process这个引用。由于前面指有“+”符号，因此，
如果在指定的包里面找不到button_start_in_process这个引用的话，那么就会在该包里面创建一个新的。无论
button_start_in_process在指定的包里面原来就存在的，还是新建的，最终Android资源打包工具都是将它的资源ID作为解析结
果。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;在我们这个情景中，在解析main.xml文件的两个Button节点的android:id属性值
“@+id/button_start_in_process”和“@+id/button_start_in_new_process”时，当前正在编
译的资源包没有包含有相应的引用的，因此，Android资源打包工具就会在当前正在编译的资源包里面增加两个类型为id的Entry，如图9所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365149820_2622.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图9 增加两个类型为id的资源项</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;此外，对于main.xml文件的两个Button节点的android:text属性值
“@string/start_in_process”和“@string/start_in_new_process”，它们分别表示引用的是当前正在
编译的资源包的名称分别为“start_in_process”和“start_in_new_process”的string资源。这两个string
资源在前面的第五步操作中已经编译过了，因此，这里就可以直接获得它们的资源ID。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;注意，一个资源项一旦创建之后，要获得它的资源ID是很容易的，因为它的Package ID、Type ID和Entry ID都是已知的。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;4. 压平Xml文件</p><p> &nbsp; &nbsp; &nbsp; &nbsp;经过前面的三步操作之后，所需要的基本材料都已经准备好了，接下来就可以对Xml文件的内容进行扁平化处理了，实际上就是将Xml文件从文本格式转换为二进制格式，这个过程如图10所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365233578_1721.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图10 压平Xml文件</p><p> &nbsp; &nbsp; &nbsp; &nbsp;将Xml文件从文本格式转换为二进制格式可以划分为六个步骤，接下来我们就详细分析每一个步骤。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 1. 收集有资源ID的属性的名称字符串</p><p> &nbsp; &nbsp; &nbsp; &nbsp;这一步除了收集那些具有资源ID的Xml元素属性的名称字符串之外，还会将对应的资源ID收集起来放在一个数组中。这里收集到的属性名称字符串保存在一个字符串资源池中，它们与收集到的资源ID数组是一一对应的。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;对于main.xml文件来说，具有资源ID的Xml元素属性的名称字符串有“orientation”、“layout_width”、
“layout_height”、“gravity”、“id”和“text”，假设它们对应的资源ID分别为0x010100c4、
0x010100f4、0x010100f5、0x010100af、0x010100d0和0x0101014f，那么最终得到的字符串资源池的前6个
位置和资源ID数组的对应关系如图11所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365234701_8088.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload="" width="650"><br></p><p style="text-align:center;">图11 属性名称字符串与属性资源ID的对应关系</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 2. 收集其它字符串</p><p>
 &nbsp; &nbsp; &nbsp; &nbsp;这一步收集的是Xml文件中的其它所有字符串。由于在前面的Step 
1中，那些具有资源ID的Xml元素属性的名称字符串已经被收集过了，因此，它们在一步中不会被重复收集。对于main.xml文件来说，这一步收集到的
字符串如图12所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365235285_2065.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload="" width="650"><br></p><p style="text-align:center;">图12 其它字符串</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;其中，“android”是android命名空间前缀，“http://schemas.android.com/apk/res
/android”是android命名空间uri，“LinearLayout”是LinearLayout元素的标签，“Button”是
Button元素的标签。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 3. 写入Xml文件头</p><p> 
&nbsp; &nbsp; &nbsp; 
&nbsp;最终编译出来的Xml二进制文件是一系列的chunk组成的，每一个chunk都有一个头部，用来描述chunk的元信息。同时，整个Xml
二进制文件又可以看成一块总的chunk，它有一个类型为ResXMLTree_header的头部。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;ResXMLTree_header定义在文件frameworks/base/include/utils/ResourceTypes.h中，如下所示：</p><p><br></p><div><div id="highlighter_304997" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java preprocessor">/**</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Header that appears at the front of every data chunk in a resource.</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number4 index3 alt1"><code class="java plain">struct ResChunk_header</code></div><div class="line number5 index4 alt2"><code class="java plain">{</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Type identifier for this chunk.&nbsp; The meaning of this value depends</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// on the containing chunk.</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint16_t type;</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Size of the chunk header (in bytes).&nbsp; Adding this value to</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// the address of the chunk allows you to find its associated data</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// (if any).</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint16_t headerSize;</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Total size of this chunk (in bytes).&nbsp; This is the chunkSize plus</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// the size of any data associated with the chunk.&nbsp; Adding this value</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// to the chunk allows you to completely skip its contents (including</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// any child chunks).&nbsp; If this value is the same as chunkSize, there is</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// no data associated with the chunk.</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t size;</code></div><div class="line number19 index18 alt2"><code class="java plain">};</code></div><div class="line number20 index19 alt1"><code class="java preprocessor">/**</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* XML tree header.&nbsp; This appears at the front of an XML tree,</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* describing its content.&nbsp; It is followed by a flat array of</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* ResXMLTree_node structures; the hierarchy of the XML document</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* is described by the occurrance of RES_XML_START_ELEMENT_TYPE</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* and corresponding RES_XML_END_ELEMENT_TYPE nodes in the array.</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number27 index26 alt2"><code class="java plain">struct ResXMLTree_header</code></div><div class="line number28 index27 alt1"><code class="java plain">{</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResChunk_header header;</code></div><div class="line number30 index29 alt1"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;ResXMLTree_header内嵌有一个类型为ResChunk_header的头部。事实上，每一种头部类型都会内嵌有一个类型为
ResChunk_header的基础头部，并且这个ResChunk_header都是作为第一个成员变量出现的。这样在解析二进制Xml文件的时候，
只需要读出前面大小为sizeof(ResChunk_header)的数据块，并且通过识别其中的type值，就可以知道实际正在处理的chunk的具
体类型。</p><p><br></p><p> &nbsp; &nbsp; &nbsp; &nbsp;对于ResXMLTree_header头部来说，内嵌在它里面的ResChunk_header的成员变量的值如下所示：</p><p><strong>--type</strong>：等于RES_XML_TYPE，描述这是一个Xml文件头部。</p><p><strong>--headerSize</strong>：等于sizeof(ResXMLTree_header)，表示头部的大小。</p><p><strong>--size</strong>：等于整个二进制Xml文件的大小，包括头部headerSize的大小。<br></p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 4. 写入字符串资源池</p><p>
 &nbsp; &nbsp; &nbsp; &nbsp;原来定义在Xml文件中的字符串已经在Step 1和Step 
2中收集完毕，因此，这里就可以将它们写入到最终收集到二进制格式的Xml文件中去。注意，写入的字符串是严格按照它们在字符串资源池中的顺序写入的。例
如，对于main.xml来说，依次写入的字符串为“orientation”、“layout_width”、“layout_height”、
“gravity”、“id”、"text"、"android"、“http://schemas.android.com/apk/res
/android”、“LinearLayout”和“Button”。之所以要严格按照这个顺序来写入，是因为接下来要将前面Step 
1收集到的资源ID数组也写入到二进制格式的Xml文件中去，并且要保持这个资源ID数组与字符串资源池前六个字符串的对应关系。</p><p> 
&nbsp; &nbsp; &nbsp; 
写入的字符串池chunk同样也是具有一个头部的，这个头部的类型为ResStringPool_header，它定义在文件
frameworks/base/include/utils/ResourceTypes.h中，如下所示：</p><p><br></p><div><div id="highlighter_489812" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java preprocessor">/**</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Definition for a pool of strings.&nbsp; The data of this chunk is an</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* array of uint32_t providing indices into the pool, relative to</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* stringsStart.&nbsp; At stringsStart are all of the UTF-16 strings</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* concatenated together; each starts with a uint16_t of the string's</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* length and each ends with a 0x0000 terminator.&nbsp; If a string is &gt;</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* 32767 characters, the high bit of the length is set meaning to take</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* those 15 bits as a high word and it will be followed by another</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* uint16_t containing the low word.</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* If styleCount is not zero, then immediately following the array of</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* uint32_t indices into the string table is another array of indices</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* into a style table starting at stylesStart.&nbsp; Each entry in the</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* style table is an array of ResStringPool_span structures.</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number16 index15 alt1"><code class="java plain">struct ResStringPool_header</code></div><div class="line number17 index16 alt2"><code class="java plain">{</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResChunk_header header;</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Number of strings in this pool (number of uint32_t indices that follow</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// in the data).</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t stringCount;</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Number of style span arrays in the pool (number of uint32_t indices</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// follow the string indices).</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t styleCount;</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Flags.</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">enum</code> <code class="java plain">{</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// If set, the string index is sorted by the string values (based</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// on strcmp16()).</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SORTED_FLAG = </code><code class="java value">1</code><code class="java plain">&lt;&lt;</code><code class="java value">0</code><code class="java plain">,</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// String pool is encoded in UTF-8</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">UTF8_FLAG = </code><code class="java value">1</code><code class="java plain">&lt;&lt;</code><code class="java value">8</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">};</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t flags;</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Index from header of the string data.</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t stringsStart;</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Index from header of the style data.</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t stylesStart;</code></div><div class="line number38 index37 alt1"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;内嵌在ResStringPool_header里面的ResChunk_header的成员变量的值如下所示：</p><p><br></p><p><strong>--type</strong>：等于RES_STRING_POOL_TYPE，描述这是一个字符串资源池。</p><p><strong>--headerSize</strong>：等于sizeof(ResStringPool_header)，表示头部的大小。</p><p><strong>--size</strong>：整个字符串chunk的大小，包括头部headerSize的大小。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;ResStringPool_header的其余成员变量的值如下所示：</p><p><strong> --stringCount</strong>：等于字符串的数量。</p><p><strong>--styleCount</strong>：等于字符串的样式的数量。</p><p><strong>--flags</strong>：等于0、SORTED_FLAG、UTF8_FLAG或者它们的组合值，用来描述字符串资源串的属性，例如，SORTED_FLAG位等于1表示字符串是经过排序的，而UTF8_FLAG位等于1表示字符串是使用UTF8编码的，否则就是UTF16编码的。</p><p><strong>--stringsStart</strong>：等于字符串内容块相对于其头部的距离。</p><p><strong>--stylesStart</strong>：等于字符串样式块相对于其头部的距离。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;无论是UTF8，还是UTF16的字符串编码，每一个字符串的前面都有2个字节表示其长度，而且后面以一个NULL字符结束。对于UTF8编
码的字符串来说，NULL字符使用一个字节的0x00来表示，而对于UTF16编码的字符串来说，NULL字符使用两个字节的0x0000来表示。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;如果一个字符串的长度超过32767，那么就会使用更多的字节来表示。假设字符串的长度超过32767，那么前两个字节的最高位就会等于0，
表示接下来的两个字节仍然是用来表示字符串长度的，并且前两个字表示高16位，而后两个字节表示低16位。</p><p> &nbsp; &nbsp; 
&nbsp; 
&nbsp;除了ResStringPool_header头部、字符串内容块和字符串样式内容块之外，还有两个偏移数组，分别是字符串偏移数组和字符串
样式偏移数组，这两个偏移数组的大小就分别等于字符串的数量stringCount和styleCount的值，而每一个元素都是一个无符号整数。整个字
符中资源池的组成就如图13所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365240437_1671.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图13 字符串资源池结构</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;注意，字符串偏移数组和字符串样式偏移数组的值分别是相对于stringStart和styleStart而言的。在解析二进制Xml文件的
时候，通过这两个偏移数组以及stringsStart和stylesStart的值就可以迅速地定位到第i个字符串。</p><p> &nbsp; 
&nbsp; &nbsp; 
&nbsp;接下来，我们就重点说说什么是字符串样式。假设有一个字符串资源池，它有五个字符串，分别是"apple"、“banana”、
“orange”、“&lt;b&gt;man&lt;/b&gt;&lt;i&gt;go&lt;/i&gt;”和“pear”。注意到第四个字符串
“&lt;b&gt;man&lt;/b&gt;&lt;i&gt;go&lt;/i&gt;”，它实际表示的是一个字符串“mango”，不过它的前三
个字符“man”通过b标签来描述为粗体的，而后两个字符通过i标签来描述为斜体的。这样实际上在整个字符串资源池中，包含了七个字符串，分别
是"apple"、“banana”、“orange”、“mango”、“pear”、“b”和“i”，其中，第四个字符串“mango”来有两个
sytle，第一个style表示第1到第3个字符是粗体的，第二个style表示第4到第5个字符是斜体的。</p><p> &nbsp; 
&nbsp; &nbsp; 
&nbsp;字符串与其样式描述是一一对应的，也变是说，如果第i个字符串是带有样式描述的，那么它的样式描述就位于样式内容块第i个位置上。以上面的字
符串资源池为例，由于第4个字符中带有样式描述，为了保持字符串与样式描述的一一对应关系，那么也需要假设前面3个字符串也带有样式描述的，不过需要将这
3个字符串的样式描述的个数设置为0。也就是说，在这种情况下，字符串的个数等于7，而样式描述的个数等于4，其中，第1到第3个字符串的样式描述的个数
等于0，而第4个字符串的样式描述的个数等于2。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;假设一个字符串有N个样式描述，那么它在样式内容块中，就对应有N个ResStringPool_span，以及一个
ResStringPool_ref，其中，N个ResStringPool_span位于前面，用来描述每一个样式，而
ResStringPool_ref表示一个结束占位符。例如，对于上述的“mango”字符串来说，它就对应有2个
ResStringPool_span，以及1个ResStringPool_ref，而对于"apple"、“banana”和“orange”这三个
字符串来说，它们对应有0个ResStringPool_span，但是对应有1个ResStringPool_ref，最后三个字符串“pear”、
“b”和"i"对应有0个ResStringPool_span和0个ResStringPool_ref。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;ResStringPool_span和ResStringPool_ref定义在文件frameworks/base/include/utils/ResourceTypes.h中，如下所示：</p><p><br></p><div><div id="highlighter_22110" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java preprocessor">/**</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Reference to a string in a string pool.</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number4 index3 alt1"><code class="java plain">struct ResStringPool_ref</code></div><div class="line number5 index4 alt2"><code class="java plain">{</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Index into the string pool table (uint32_t-offset from the indices</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// immediately after ResStringPool_header) at which to find the location</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// of the string data in the pool.</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t index;</code></div><div class="line number10 index9 alt1"><code class="java plain">};</code></div><div class="line number11 index10 alt2"><code class="java preprocessor">/**</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* This structure defines a span of style information associated with</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* a string in the pool.</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number15 index14 alt2"><code class="java plain">struct ResStringPool_span</code></div><div class="line number16 index15 alt1"><code class="java plain">{</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">enum</code> <code class="java plain">{</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">END = </code><code class="java value">0xFFFFFFFF</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">};</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// This is the name of the span -- that is, the name of the XML</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// tag that defined it.&nbsp; The special value END (0xFFFFFFFF) indicates</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// the end of an array of spans.</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ResStringPool_ref name;</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The range of characters in the string that this span applies to.</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t firstChar, lastChar;</code></div><div class="line number26 index25 alt1"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;由于ResStringPool_ref在这里出现的作用就是充当样式描述结束占位符，因此，它唯一的成员变量index的取值就固定为ResStringPool_span::END。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;再来看ResStringPool_span是如何表示一个样式描述的。以字符串“mango”的第一个样式描述为例，对应的ResStringPool_span的各个成员变量的取值为：</p><p><strong>--name</strong>：等于字符串“b”在字符串资源池中的位置。</p><p><strong> --firstChar</strong>：等于0，即指向字符“m”。</p><p><strong>--lastChar</strong>：等于2，即指向字符"n"。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;综合起来就是表示字符串“man”是粗体的。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;再以字符串“mango”的第二个样式描述为例，对应的ResStringPool_span的各个成员变量的取值为：</p><p><strong>--name</strong>：等于字符串“i”在字符串资源池中的位置。</p><p><strong>--firstChar</strong>：等于3，即指向字符“g”。</p><p><strong> --lastChar</strong>：等于4，即指向字符“o”。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;综合起来就是表示字符串“go”是斜体的。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;另外有一个地方需要注意的是，字符串样式内容的最后会有8个字节，每4个字节都被填充为ResStringPool_span::END，用来表达字符串样式内容结束符。这个结束符可以在解析过程中用作错误验证。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 5. 写入资源ID</p><p>
 &nbsp; &nbsp; &nbsp; &nbsp;在前面的Step 
1中，我们把属性的资源ID都收集起来了。这些收集起来的资源ID会作为一个单独的chunk写入到最终的二进制Xml文件中去。这个chunk位于字符
串资源池的后面，它的头部使用ResChunk_header来描述。这个ResChunk_header的各个成员变量的取值如下所示：</p><p><strong>--type</strong>：等于RES_XML_RESOURCE_MAP_TYPE，表示这是一个从字符串资源池到资源ID的映射头部。</p><p><strong>--headerSize</strong>：等于sizeof(ResChunk_header)，表示头部大小。</p><p><strong>--size</strong>：等于headerSize的大小再加上sizeof(uint32_t) * count，其中，count为收集到的资源ID的个数。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;以main.xml为例，字符串资源池的第一个字符串为“orientation”，而在资源ID这个chunk中记录的第一个数据为
0x010100c4，那么就表示属性名称字符串“orientation”对应的资源ID为0x010100c4。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 6. 压平Xml文件</p><p> &nbsp; &nbsp; &nbsp; &nbsp;压平Xml文件其实就是指将里面的各个Xml元素中的字符串都替换掉。这些字符串要么是被替换成到字符串资源池的一个索引，要么是替换成一个具有类型的其它值。我们以main.xml为例来说这个压平的过程。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;首先被压平的是一个表示命名空间的Xml Node。这个Xml Node用两个ResXMLTree_node和两个ResXMLTree_namespaceExt来表示，如图14所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365259125_2398.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图14 命名空间chunk块</p><p> &nbsp; &nbsp; &nbsp; ResXMLTree_node和ResXMLTree_namespaceExt定义在文件frameworks/base/include/utils/ResourceTypes.h中，如下所示：</p><p><br></p><div><div id="highlighter_264147" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java preprocessor">/**</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Basic XML tree node.&nbsp; A single item in the XML document.&nbsp; Extended info</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* about the node can be found after header.headerSize.</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number5 index4 alt2"><code class="java plain">struct ResXMLTree_node</code></div><div class="line number6 index5 alt1"><code class="java plain">{</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResChunk_header header;</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Line number in original source file at which this element appeared.</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t lineNumber;</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Optional XML comment that was associated with this element; -1 if none.</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResStringPool_ref comment;</code></div><div class="line number12 index11 alt1"><code class="java plain">};</code></div><div class="line number13 index12 alt2"><code class="java preprocessor">/**</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Extended XML tree node for namespace start/end nodes.</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Appears header.headerSize bytes after a ResXMLTree_node.</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number17 index16 alt2"><code class="java plain">struct ResXMLTree_namespaceExt</code></div><div class="line number18 index17 alt1"><code class="java plain">{</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The prefix of the namespace.</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResStringPool_ref prefix;</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The URI of the namespace.</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResStringPool_ref uri;</code></div><div class="line number23 index22 alt2"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;对于main.xml文件来说，在它的命名空间chunk中，内嵌在第一个ResXMLTree_node里面的ResChunk_header的各个成员变量的取值如下所示：</p><p><br></p><p><strong>--type</strong>：等于RES_XML_START_NAMESPACE_TYPE，表示命名空间开始标签的头部。</p><p><strong>--headerSize</strong>：等于sizeof(ResXMLTree_node)，表示头部的大小。</p><p><strong>--size</strong>：等于sizeof(ResXMLTree_node) + sizeof(ResXMLTree_namespaceExt)。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;第一个ResXMLTree_node的其余成员变量的取值如下所示：</p><p><strong>--lineNumber</strong>：等于命名空间开始标签在原来文本格式的Xml文件出现的行号。</p><p><strong>--comment</strong>：等于命名空间的注释在字符池资源池的索引。</p><p> &nbsp; &nbsp; &nbsp; 内嵌在第二个ResXMLTree_node里面的ResChunk_header的各个成员变量的取值如下所示：</p><p><strong>--type</strong>：等于RES_XML_END_NAMESPACE_TYPE，表示命名空间结束标签的头部。</p><p><strong>--headerSize</strong>：等于sizeof(ResXMLTree_node)，表示头部的大小。</p><p><strong>--size</strong>：等于sizeof(ResXMLTree_node) + sizeof(ResXMLTree_namespaceExt)。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;第二个ResXMLTree_node的其余成员变量的取值如下所示：</p><p><strong>--lineNumber</strong>：等于命名空间结束标签在原来文本格式的Xml文件出现的行号。</p><p><strong>--comment</strong>：等于0xffffffff，即-1。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;两个ResXMLTree_namespaceExt的内容都是一样的，它们的成员变量的取值如下所示：</p><p><strong>--prefix</strong>：等于字符串“android”在字符串资源池中的索引。</p><p><strong>--uri</strong>：等于字符串“http://schemas.android.com/apk/res/android”在字符串资源池中的索引。</p><p>
 &nbsp; &nbsp; &nbsp; &nbsp;接下来被压平的是标签为LinearLayout的Xml Node。这个Xml 
Node由两个ResXMLTree_node、一个ResXMLTree_attrExt、一个ResXMLTree_endElementExt和四
个ResXMLTree_attribute来表示，如图15所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365263862_1893.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图15 标签为LinearLayout的Xml元素chunk</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;ResXMLTree_attrExt、ResXMLTree_attribute和ResXMLTree_endElementExt定义
在文件frameworks/base/include/utils/ResourceTypes.h中，如下所示：</p><p><br></p><div><div id="highlighter_684812" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java preprocessor">/**</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Extended XML tree node for start tags -- includes attribute</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* information.</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Appears header.headerSize bytes after a ResXMLTree_node.</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number6 index5 alt1"><code class="java plain">struct ResXMLTree_attrExt</code></div><div class="line number7 index6 alt2"><code class="java plain">{</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// String of the full namespace of this element.</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResStringPool_ref ns;</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// String name of this node if it is an ELEMENT; the raw</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// character data if this is a CDATA node.</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResStringPool_ref name;</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Byte offset from the start of this structure where the attributes start.</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint16_t attributeStart;</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Size of the ResXMLTree_attribute structures that follow.</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint16_t attributeSize;</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Number of attributes associated with an ELEMENT.&nbsp; These are</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// available as an array of ResXMLTree_attribute structures</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// immediately following this node.</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint16_t attributeCount;</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Index (1-based) of the "id" attribute. 0 if none.</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint16_t idIndex;</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Index (1-based) of the "class" attribute. 0 if none.</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint16_t classIndex;</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Index (1-based) of the "style" attribute. 0 if none.</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint16_t styleIndex;</code></div><div class="line number27 index26 alt2"><code class="java plain">};</code></div><div class="line number28 index27 alt1"><code class="java plain">struct ResXMLTree_attribute</code></div><div class="line number29 index28 alt2"><code class="java plain">{</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Namespace of this attribute.</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResStringPool_ref ns;</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Name of this attribute.</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResStringPool_ref name;</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The original raw string value of this attribute.</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResStringPool_ref rawValue;</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Processesd typed value of this attribute.</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct Res_value typedValue;</code></div><div class="line number38 index37 alt1"><code class="java plain">};</code></div><div class="line number39 index38 alt2"><code class="java preprocessor">/**</code></div><div class="line number40 index39 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Extended XML tree node for element start/end nodes.</code></div><div class="line number41 index40 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Appears header.headerSize bytes after a ResXMLTree_node.</code></div><div class="line number42 index41 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number43 index42 alt2"><code class="java plain">struct ResXMLTree_endElementExt</code></div><div class="line number44 index43 alt1"><code class="java plain">{</code></div><div class="line number45 index44 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// String of the full namespace of this element.</code></div><div class="line number46 index45 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResStringPool_ref ns;</code></div><div class="line number47 index46 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// String name of this node if it is an ELEMENT; the raw</code></div><div class="line number48 index47 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// character data if this is a CDATA node.</code></div><div class="line number49 index48 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResStringPool_ref name;</code></div><div class="line number50 index49 alt1"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;内嵌在第一个ResXMLTree_node里面的ResChunk_header的各个成员变量的取值如下所示：</p><p><strong>--type</strong>：等于RES_XML_START_ELEMENT_TYPE，表示LinearLayout开始标签的头部。</p><p><strong>--headerSize</strong>：等于sizeof(ResXMLTree_node)，表示头部的大小。</p><p><strong>--size</strong>：等于sizeof(ResXMLTree_node) + sizeof(ResXMLTree_attrExt) + sizeof(ResXMLTree_attribute) * 4。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;第一个ResXMLTree_node的其余成员变量的取值如下所示：</p><p><strong>--lineNumber</strong>：等于LinearLayout开始标签在原来文本格式的Xml文件出现的行号。</p><p><strong>--comment</strong>：等于LinearLayout标签的注释在字符池资源池的索引。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;ResXMLTree_attrExt的各个成员变量的取值如下所示：</p><p><strong>--ns</strong>：等于LinearLayout元素的命令空间在字符池资源池的索引，没有指定则等于-1。</p><p><strong>--name</strong>：等于字符串“LinearLayout”在字符池资源池的索引。</p><p><strong>--attributeStart</strong>：等于sizeof(ResXMLTree_attrExt)，表示LinearLayout的属性chunk相对type值为RES_XML_START_ELEMENT_TYPE的ResXMLTree_node头部的位置。</p><p><strong>--attributeSize</strong>：等于sizeof(ResXMLTree_attribute)，表示每一个属性占据的chunk大小。</p><p><strong>--attributeCount</strong>：等于4，表示有4个属性chunk。</p><p><strong>--idIndex</strong>：如果LinearLayout元素有一个名称为“id”的属性，那么就将它出现在属性列表中的位置再加上1的值记录在idIndex中，否则的话，idIndex的值就等于0。</p><p><strong> --classIndex</strong>：如果LinearLayout元素有一个名称为“class”的属性，那么就将它出现在属性列表中的位置再加上1的值记录在classIndex中，否则的话，classIndex的值就等于0。</p><p><strong>--styleIndex</strong>：如果LinearLayout元素有一个名称为“style”的属性，那么就将它出现在属性列表中的位置再加上1的值记录在styleIndex中，否则的话，styleIndex的值就等于0。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;LinearLayout元素有四个属性，每一个属性都对应一个ResXMLTree_attribute，接下来我们就以名称为“orientation”的属性为例，来说明它的各个成员变量的取值，如下所示：</p><p><strong>--ns</strong>：等于属性orientation的命令空间在字符池资源池的索引，没有指定则等于-1。</p><p><strong>--name</strong>：等于属性名称字符串“orientation”在字符池资源池的索引。</p><p><strong>--rawValue</strong>：等于属性orientation的原始值“vertical”在字符池资源池的索引，这是可选的，如果不用保留，它的值就等于-1。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;名称为“orientation”的ResXMLTree_attribute的成员变量typedValue是一个Res_value，它
定义在文件frameworks/base/include/utils/ResourceTypes.h中，如下所示：</p><p><br></p><div><div id="highlighter_571705" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div><div class="line number74 index73 alt1">74</div><div class="line number75 index74 alt2">75</div><div class="line number76 index75 alt1">76</div><div class="line number77 index76 alt2">77</div><div class="line number78 index77 alt1">78</div><div class="line number79 index78 alt2">79</div><div class="line number80 index79 alt1">80</div><div class="line number81 index80 alt2">81</div><div class="line number82 index81 alt1">82</div><div class="line number83 index82 alt2">83</div><div class="line number84 index83 alt1">84</div><div class="line number85 index84 alt2">85</div><div class="line number86 index85 alt1">86</div><div class="line number87 index86 alt2">87</div><div class="line number88 index87 alt1">88</div><div class="line number89 index88 alt2">89</div><div class="line number90 index89 alt1">90</div><div class="line number91 index90 alt2">91</div><div class="line number92 index91 alt1">92</div><div class="line number93 index92 alt2">93</div><div class="line number94 index93 alt1">94</div><div class="line number95 index94 alt2">95</div><div class="line number96 index95 alt1">96</div><div class="line number97 index96 alt2">97</div><div class="line number98 index97 alt1">98</div><div class="line number99 index98 alt2">99</div><div class="line number100 index99 alt1">100</div><div class="line number101 index100 alt2">101</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java preprocessor">/**</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Representation of a value in a resource, supplying type</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* information.</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number5 index4 alt2"><code class="java plain">struct Res_value</code></div><div class="line number6 index5 alt1"><code class="java plain">{</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Number of bytes in this structure.</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint16_t size;</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Always set to 0.</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint8_t res0;</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Type of the data value.</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">enum</code> <code class="java plain">{</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Contains no data.</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_NULL = </code><code class="java value">0x00</code><code class="java plain">,</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The 'data' holds a ResTable_ref, a reference to another resource</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// table entry.</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_REFERENCE = </code><code class="java value">0x01</code><code class="java plain">,</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The 'data' holds an attribute resource identifier.</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_ATTRIBUTE = </code><code class="java value">0x02</code><code class="java plain">,</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The 'data' holds an index into the containing resource table's</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// global value string pool.</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_STRING = </code><code class="java value">0x03</code><code class="java plain">,</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The 'data' holds a single-precision floating point number.</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_FLOAT = </code><code class="java value">0x04</code><code class="java plain">,</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The 'data' holds a complex number encoding a dimension value,</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// such as "100in".</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_DIMENSION = </code><code class="java value">0x05</code><code class="java plain">,</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The 'data' holds a complex number encoding a fraction of a</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// container.</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_FRACTION = </code><code class="java value">0x06</code><code class="java plain">,</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Beginning of integer flavors...</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_FIRST_INT = </code><code class="java value">0x10</code><code class="java plain">,</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The 'data' is a raw integer value of the form n..n.</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_INT_DEC = </code><code class="java value">0x10</code><code class="java plain">,</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The 'data' is a raw integer value of the form 0xn..n.</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_INT_HEX = </code><code class="java value">0x11</code><code class="java plain">,</code></div><div class="line number37 index36 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The 'data' is either 0 or 1, for input "false" or "true" respectively.</code></div><div class="line number38 index37 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_INT_BOOLEAN = </code><code class="java value">0x12</code><code class="java plain">,</code></div><div class="line number39 index38 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Beginning of color integer flavors...</code></div><div class="line number40 index39 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_FIRST_COLOR_INT = </code><code class="java value">0x1c</code><code class="java plain">,</code></div><div class="line number41 index40 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The 'data' is a raw integer value of the form #aarrggbb.</code></div><div class="line number42 index41 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_INT_COLOR_ARGB8 = </code><code class="java value">0x1c</code><code class="java plain">,</code></div><div class="line number43 index42 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The 'data' is a raw integer value of the form #rrggbb.</code></div><div class="line number44 index43 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The 'data' is a raw integer value of the form #aarrggbb.</code></div><div class="line number45 index44 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_INT_COLOR_ARGB8 = </code><code class="java value">0x1c</code><code class="java plain">,</code></div><div class="line number46 index45 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The 'data' is a raw integer value of the form #rrggbb.</code></div><div class="line number47 index46 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_INT_COLOR_RGB8 = </code><code class="java value">0x1d</code><code class="java plain">,</code></div><div class="line number48 index47 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The 'data' is a raw integer value of the form #argb.</code></div><div class="line number49 index48 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_INT_COLOR_ARGB4 = </code><code class="java value">0x1e</code><code class="java plain">,</code></div><div class="line number50 index49 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The 'data' is a raw integer value of the form #rgb.</code></div><div class="line number51 index50 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_INT_COLOR_RGB4 = </code><code class="java value">0x1f</code><code class="java plain">,</code></div><div class="line number52 index51 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// ...end of integer flavors.</code></div><div class="line number53 index52 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_LAST_COLOR_INT = </code><code class="java value">0x1f</code><code class="java plain">,</code></div><div class="line number54 index53 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// ...end of integer flavors.</code></div><div class="line number55 index54 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TYPE_LAST_INT = </code><code class="java value">0x1f</code></div><div class="line number56 index55 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">};</code></div><div class="line number57 index56 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint8_t dataType;</code></div><div class="line number58 index57 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Structure of complex data values (TYPE_UNIT and TYPE_FRACTION)</code></div><div class="line number59 index58 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">enum</code> <code class="java plain">{</code></div><div class="line number60 index59 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Where the unit type information is.&nbsp; This gives us 16 possible</code></div><div class="line number61 index60 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// types, as defined below.</code></div><div class="line number62 index61 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_UNIT_SHIFT = </code><code class="java value">0</code><code class="java plain">,</code></div><div class="line number63 index62 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_UNIT_MASK = </code><code class="java value">0xf</code><code class="java plain">,</code></div><div class="line number64 index63 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// TYPE_DIMENSION: Value is raw pixels.</code></div><div class="line number65 index64 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_UNIT_PX = </code><code class="java value">0</code><code class="java plain">,</code></div><div class="line number66 index65 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// TYPE_DIMENSION: Value is Device Independent Pixels.</code></div><div class="line number67 index66 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_UNIT_DIP = </code><code class="java value">1</code><code class="java plain">,</code></div><div class="line number68 index67 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// TYPE_DIMENSION: Value is a Scaled device independent Pixels.</code></div><div class="line number69 index68 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_UNIT_SP = </code><code class="java value">2</code><code class="java plain">,</code></div><div class="line number70 index69 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// TYPE_DIMENSION: Value is in points.</code></div><div class="line number71 index70 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_UNIT_PT = </code><code class="java value">3</code><code class="java plain">,</code></div><div class="line number72 index71 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// TYPE_DIMENSION: Value is in inches.</code></div><div class="line number73 index72 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_UNIT_IN = </code><code class="java value">4</code><code class="java plain">,</code></div><div class="line number74 index73 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// TYPE_DIMENSION: Value is in millimeters.</code></div><div class="line number75 index74 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_UNIT_MM = </code><code class="java value">5</code><code class="java plain">,</code></div><div class="line number76 index75 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// TYPE_FRACTION: A basic fraction of the overall size.</code></div><div class="line number77 index76 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_UNIT_FRACTION = </code><code class="java value">0</code><code class="java plain">,</code></div><div class="line number78 index77 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// TYPE_FRACTION: A fraction of the parent size.</code></div><div class="line number79 index78 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_UNIT_FRACTION_PARENT = </code><code class="java value">1</code><code class="java plain">,</code></div><div class="line number80 index79 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Where the radix information is, telling where the decimal place</code></div><div class="line number81 index80 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// appears in the mantissa.&nbsp; This give us 4 possible fixed point</code></div><div class="line number82 index81 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// representations as defined below.</code></div><div class="line number83 index82 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_RADIX_SHIFT = </code><code class="java value">4</code><code class="java plain">,</code></div><div class="line number84 index83 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_RADIX_MASK = </code><code class="java value">0x3</code><code class="java plain">,</code></div><div class="line number85 index84 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The mantissa is an integral number -- i.e., 0xnnnnnn.0</code></div><div class="line number86 index85 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_RADIX_23p0 = </code><code class="java value">0</code><code class="java plain">,</code></div><div class="line number87 index86 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The mantissa magnitude is 16 bits -- i.e, 0xnnnn.nn</code></div><div class="line number88 index87 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_RADIX_16p7 = </code><code class="java value">1</code><code class="java plain">,</code></div><div class="line number89 index88 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The mantissa magnitude is 8 bits -- i.e, 0xnn.nnnn</code></div><div class="line number90 index89 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_RADIX_8p15 = </code><code class="java value">2</code><code class="java plain">,</code></div><div class="line number91 index90 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The mantissa magnitude is 0 bits -- i.e, 0x0.nnnnnn</code></div><div class="line number92 index91 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_RADIX_0p23 = </code><code class="java value">3</code><code class="java plain">,</code></div><div class="line number93 index92 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Where the actual value is.&nbsp; This gives us 23 bits of</code></div><div class="line number94 index93 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// precision.&nbsp; The top bit is the sign.</code></div><div class="line number95 index94 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_MANTISSA_SHIFT = </code><code class="java value">8</code><code class="java plain">,</code></div><div class="line number96 index95 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">COMPLEX_MANTISSA_MASK = </code><code class="java value">0xffffff</code></div><div class="line number97 index96 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">};</code></div><div class="line number98 index97 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The data for this item, as interpreted according to dataType.</code></div><div class="line number99 index98 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t data;</code></div><div class="line number100 index99 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">void</code> <code class="java plain">copyFrom_dtoh(</code><code class="java keyword">const</code> <code class="java plain">Res_value&amp; src);</code></div><div class="line number101 index100 alt2"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p>
 &nbsp; &nbsp; &nbsp; &nbsp; 
一个属性的值经过解析之后，也就是经过前面编译Xml资源的第3个操作之后，就用一个Res_value来表示。 
例如，对于名称为“orientation”的属性的值“vertical”来说，经过解析之后，它就会用一个Res_value来表示，这个
Res_value的各个成员变量的值如下所示：</p><p><br></p><p><strong>--size</strong>：等于sizeof(Res_value)。</p><p><strong>--res0</strong>：等于0，保留给以后用。</p><p><strong>--dataType</strong>：等于TYPE_INT_DEC，表示数据类型，即这是一个十进制形式的整数值。</p><p><strong> &nbsp;--data</strong>：等于1，参考前面编译Xml资源的第3个操作。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;更多的数据类型，请参考Res_value定义里面的注释。从这里我们就可以看出，在解析二进制格式的Xml文件的过程中，当我们知道一个属
性的名称在字符串资源池的索引之后，就可以通过这个索引在字符串资源池中找到对应的属性名称字符中，同时，通过这个索引还可以在资源ID的那块chunk
中找到对应的属性资源ID，而有了这个属性资源ID之后，我们就可以进一步地验证该属性的取值是否正确等操作。</p><p><br></p><p> &nbsp; &nbsp; &nbsp; &nbsp;内嵌在第二个ResXMLTree_node里面的ResChunk_header的各个成员变量的取值如下所示：</p><p><strong>--type</strong>：等于RES_XML_END_ELEMENT_TYPE，表示LinearLayout结束标签的头部。</p><p><strong>--headerSize</strong>：等于sizeof(ResXMLTree_node)，表示头部的大小。</p><p><strong>--size</strong>：等于sizeof(ResXMLTree_node) + sizeof(ResXMLTree_endElementExt) 。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;第二个ResXMLTree_node的其余成员变量的取值如下所示：</p><p><strong>--lineNumber</strong>：等于LinearLayout结束标签在原来文本格式的Xml文件出现的行号。</p><p><strong>--comment</strong>：等于-1。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;ResXMLTree_endElementExt的各个成员变量的取值如下所示：</p><p><strong> --ns</strong>：等于LinearLayout元素的命令空间在字符池资源池的索引，没有指定则等于-1。</p><p><strong>--name</strong>：等于字符串“LinearLayout”在字符池资源池的索引。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;注意，位于名称为“gravity”的ResXMLTree_attribute和第二个ResXMLTree_node之间的chunk是
用来写入LinearLayout元素的两个子元素Button的内容的。这两个Button与LinearLayout一样，都是以相同的结构递归写入
到最终的二进制Xml文件中去的，区别只在于结构内容的不同，以及属性个数的不同。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;例如，对于第一个Button的属性id来说，它所对应的ResXMLTree_attribute的成员变量typedValue所指向的一个Res_value的各个成员变量的值如下所示：</p><p><strong>--size</strong>：等于sizeof(Res_value)。</p><p><strong>--res0</strong>：等于0，保留给以后用。</p><p><strong>--dataType</strong>：等于TYPE_REFERENCE，表示数据类型，即这是一个引用值。</p><p><strong>--data</strong>：等于分配给名称为“button_start_in_process”的ID的资源ID值，它的Package ID等于0x7f，而Type ID等于0x04，Entry ID取决于它的出现次序。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;又如，对于第一个Button的属性text来说，它所对应的ResXMLTree_attribute的成员变量typedValue所指向的一个Res_value的各个成员变量的值如下所示：</p><p><strong>--size</strong>：等于sizeof(Res_value)。</p><p><strong>--res0</strong>：等于0，保留给以后用。</p><p><strong>--dataType</strong>：等于TYPE_REFERENCE，表示数据类型，即这是一个引用值。</p><p><strong>--data</strong>：等于分配给名称“start_in_process”的字符串的资源ID值，它的Package ID等于0x7f，而Type ID等于0x05，Entry ID取决于它的出现次序。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;对于一个Xml文件来说，它除了有命名空间和普通标签类型的Node之外，还有一些称为CDATA类型的Node，例如，假设一个Xml文件，它的一个Item标签的内容如下所示：</p><p><br></p><div><div id="highlighter_998843" class="syntaxhighlighter  html"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">......</code></div><div class="line number2 index1 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">Item</code><code class="html plain">&gt;This is a normal text&lt;/</code><code class="html keyword">Item</code><code class="html plain">&gt;</code></div><div class="line number3 index2 alt2"><code class="html plain">......</code></div></div></td></tr></tbody></table></div></div><p>
 &nbsp; &nbsp; &nbsp; &nbsp;那么字符串“This is a normal 
text”就称为一个CDATA，它在二进制Xml文件中用一个ResXMLTree_node和一个ResXMLTree_cdataExt来描述，如
图16所示：<br></p><p><br></p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365265180_1852.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""></p><p style="text-align:center;">图16 CDATA类型的Xml Node的二进制表示</p><p> &nbsp; &nbsp; &nbsp; &nbsp; ResXMLTree_cdataExt定义在文件frameworks/base/include/utils/ResourceTypes.h中，如下所示：</p><p><br></p><div><div id="highlighter_397561" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java preprocessor">/**</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Extended XML tree node for CDATA tags -- includes the CDATA string.</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Appears header.headerSize bytes after a ResXMLTree_node.</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number5 index4 alt2"><code class="java plain">struct ResXMLTree_cdataExt</code></div><div class="line number6 index5 alt1"><code class="java plain">{</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The raw CDATA character data.</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResStringPool_ref data;</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The typed value of the character data if this is a CDATA node.</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct Res_value typedData;</code></div><div class="line number11 index10 alt2"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp; 内嵌在上面的ResXMLTree_node的ResChunk_header的各个成员变量的取值如下所示：</p><p><br></p><p><strong>--type</strong>：等于RES_XML_CDATA_TYPE，表示CDATA头部。</p><p><strong>--headerSize</strong>：等于sizeof(ResXMLTree_node)，表示头部的大小。</p><p><strong>--size</strong>：等于sizeof(ResXMLTree_node) + sizeof(ResXMLTree_cdataExt) 。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;上面的ResXMLTree_node的其余成员变量的取值如下所示：</p><p><strong>--lineNumber</strong>：等于字符串“This is a normal text”在原来文本格式的Xml文件出现的行号。</p><p><strong>--comment</strong>：等于字符串“This is a normal text”的注释，如果没有则等于-1。</p><p>
 &nbsp; &nbsp; &nbsp; &nbsp;下面的ResXMLTree_cdataExt的成员变量data等于字符串“This is
 a normal text”在字符串资源池的索引，另外一个成员变量typedData所指向的一个Res_value的各个成员变量的值如下所示：</p><p><strong>--size</strong>：等于sizeof(Res_value)。</p><p><strong>--res0</strong>：等于0，保留给以后用。</p><p><strong>--dataType</strong>：等于TYPE_NULL，表示没有包含数据，数据已经包含在ResXMLTree_cdataExt的成员变量data中。</p><p><strong>--data</strong>：等于0，由于dataType等于TYPE_NULL，这个值是没有意义的。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;至此，一个Xml文件就从按照图8以及图10的步骤从文本格式编译成二进制格式了。当所有的Xml文件都编译完成之后，接下来就开始生成资源符号了。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;八. 生成资源符号</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;这里生成资源符号为后面生成R.java文件做好准备的。从前面的操作可以知道，所有收集到的资源项都按照类型来保存在一个资源表中，即保存
在一个ResourceTable对象。因此，Android资源打包工具aapt只要遍历每一个Package里面的每一个Type，然后取出每一个
Entry的名称，并且根据这个Entry在自己的Type里面出现的次序来计算得到它的资源ID，那么就可以生成一个资源符号了，这个资源符号由名称以
及资源ID所组成。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;例如，对于strings.xml文件中名称为“start_in_process”的Entry来说，它是一个类型为string的资源
项，假设它出现的次序为第3，那么它的资源符号就等于R.string.start_in_process，对应的资源ID就为0x7f050002，其
中，高字节0x7f表示Package ID，次高字节0x05表示string的Type 
ID，而低两字节0x02就表示“start_in_process”是第三个出现的字符串。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;九. 生成资源索引表</p><p> &nbsp; &nbsp; &nbsp; &nbsp;我们首先总结一下，经过上述八个操作之后，所获得的资源列表如图17所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365433214_4652.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图17 收集到的所有资源项</p><p> &nbsp; &nbsp; &nbsp; &nbsp;有了这些资源项之后，Android资源打包工具aapt就可以按照下面的流程来生成资源索引表resources.arsc了，如图18所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365434493_5311.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图18 资源索引表的生成过程</p><p> &nbsp; &nbsp; &nbsp; &nbsp;接下来，我们就以图17所示的资源项来说图18所示的资源索引表生成过程。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;1. 收集类型字符串</p><p> &nbsp; &nbsp; &nbsp; &nbsp;在图17所示的资源项中，一共有4种类型的资源，分别是drawable、layout、string和id，于是对应的类型字符串就为“drawable”、“layout”、“string”和“id”。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;注意，这些字符串是按Package来收集的，也就是说，当前被编译的应用程序资源有几个Package，就有几组对应的类型字符串，每一个组类型字符串都保存在其所属的Package中。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;2. 收集资源项名称字符串</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;在图17所示的资源项中，一共有12个资源项，每一个资源项的名称分别为“icon”、“icon”、“icon”、“main”、
“sub”、“app_name”、“sub_activity”、“start_in_process”、
“start_in_new_process”、“finish”、“button_start_in_process”和
“button_start_in_new_process”，于是收集到的资源项名称字符串就为“icon”、“main”、“sub”、
“app_name”、“sub_activity”、“start_in_process”、“start_in_new_process”、
“finish”、“button_start_in_process”和“button_start_in_new_process”。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;注意，这些字符串同样是按Package来收集的，也就是说，当前被编译的应用程序资源有几个Package，就有几组对应的资源项名称字符串，每一个组资源项名称字符串都保存在其所属的Package中。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;3. 收集资源项值字符串</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;在图17所示的资源项中，一共有12个资源项，但是只有10项是具有值字符串的，它们分别是“res/drawable-ldpi
/icon.png”、“res/drawable-mdpi/icon.png”、“res/drawable-hdpi/icon.png”、
“res/layout/main.xml”、“res/layout/sub.xml”、“Activity”、“Sub 
Activity”、“Start sub-activity in process”、“Start sub-activity in new 
process”和“Finish activity”。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;注意，这些字符串不是按Package来收集的，也就是说，当前所有参与编译的Package的资源项值字符串都会被统一收集在一起。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;4. 生成Package数据块</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;参与编译的每一个Package的资源项元信息都写在一块独立的数据上，这个数据块使用一个类型为ResTable_package的头部来
描述。每一个Package的资源项元信息数据块的生成过程如图19所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365436901_3335.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图19 Package资源项元信息数据块的生成过程</p><p> &nbsp; &nbsp; &nbsp; &nbsp;这个生成过程可以分为5个步骤，接下来我们就以图17所示的资源项来说详细分析每一个步骤。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 1. 写入Package资源项元信息数据块头部</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;Package资源项元信息数据块头部是用一个ResTable_package来定义的。ResTable_package定义在文件
frameworks/base/include/utils/ResourceTypes.h中，如下所示：</p><p><br></p><div><div id="highlighter_265814" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java preprocessor">/**</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* A collection of resource data types within a package.&nbsp; Followed by</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* one or more ResTable_type and ResTable_typeSpec structures containing the</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* entry values for each resource type.</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number6 index5 alt1"><code class="java plain">struct ResTable_package</code></div><div class="line number7 index6 alt2"><code class="java plain">{</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResChunk_header header;</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// If this is a base package, its ID.&nbsp; Package IDs start</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// at 1 (corresponding to the value of the package bits in a</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// resource identifier).&nbsp; 0 means this is not a base package.</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t id;</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Actual name of this package, \0-terminated.</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">char16_t name[</code><code class="java value">128</code><code class="java plain">];</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Offset to a ResStringPool_header defining the resource</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// type symbol table.&nbsp; If zero, this package is inheriting from</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// another base package (overriding specific values in it).</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t typeStrings;</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Last index into typeStrings that is for public use by others.</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t lastPublicType;</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Offset to a ResStringPool_header defining the resource</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// key symbol table.&nbsp; If zero, this package is inheriting from</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// another base package (overriding specific values in it).</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t keyStrings;</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Last index into keyStrings that is for public use by others.</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t lastPublicKey;</code></div><div class="line number27 index26 alt2"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;嵌入在ResTable_package内部的ResChunk_header的各个成员变量的取值如下所示：</p><p><br></p><p><strong> --type</strong>：等于RES_TABLE_PACKAGE_TYPE，表示这是一个Package资源项元信息数据块头部。</p><p><strong>--headerSize</strong>：等于sizeof(ResTable_package)，表示头部大小。</p><p><strong>--size</strong>：等于sizeof(ResTable_package) + 类型字符串资源池大小 + 资源项名称字符串资源池大小 + 类型规范数据块大小 + 数据项信息数据块大小。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;ResTable_package的其它成员变量的取值如下所示：</p><p><strong> --id</strong>：等于Package ID。</p><p><strong>--name</strong>：等于Package Name。</p><p><strong>--typeStrings</strong>：等于类型字符串资源池相对头部的偏移位置。</p><p><strong>--lastPublicType</strong>：等于最后一个导出的Public类型字符串在类型字符串资源池中的索引，目前这个值设置为类型字符串资源池的大小。</p><p><strong>--keyStrings</strong>：等于资源项名称字符串相对头部的偏移位置。</p><p><strong>--lastPublicKey</strong>：等于最后一个导出的Public资源项名称字符串在资源项名称字符串资源池中的索引，目前这个值设置为资源项名称字符串资源池的大小。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;我们可以通过图20来清楚地看到一个Package资源项元信息数据块的结构：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365441810_5603.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图20 Package资源项元信息数据块结构</p><p> &nbsp; &nbsp; &nbsp; &nbsp;在Android资源中，有一种资源类型称为Public，它们一般是定义在res/values/public.xml文件中，形式如下所示：</p><p><br></p><div><div id="highlighter_307215" class="syntaxhighlighter  html"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;?</code><code class="html keyword">xml</code> <code class="html color1">version</code><code class="html plain">=</code><code class="html string">"1.0"</code> <code class="html color1">encoding</code><code class="html plain">=</code><code class="html string">"utf-8"</code><code class="html plain">?&gt;</code></div><div class="line number2 index1 alt1"><code class="html plain">&lt;</code><code class="html keyword">resources</code><code class="html plain">&gt;</code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">public</code> <code class="html color1">type</code><code class="html plain">=</code><code class="html string">"string"</code> <code class="html color1">name</code><code class="html plain">=</code><code class="html string">"string3"</code> <code class="html color1">id</code><code class="html plain">=</code><code class="html string">"0x7f040001"</code> <code class="html plain">/&gt;</code></div><div class="line number4 index3 alt1"><code class="html plain">&lt;/</code><code class="html keyword">resources</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;这个public.xml用来告诉Android资源打包工具aapt，将类型为string的资源string3的ID固定为
0x7f040001。为什么需要将某一个资源项的ID固定下来呢？一般来说，当我们将自己定义的资源导出来给第三方应用程序使用时，为了保证以后修改这
些导出资源时，仍然保证第三方应用程序的兼容性，就需要给那些导出资源一个固定的资源ID。</p><p><br></p><p> &nbsp; 
&nbsp; &nbsp; 
&nbsp;每当Android资源打包工具aapt重新编译被修改过的资源时，都会重新给这些资源赋予ID，这就可能会造成同一个资源项在两次不同的编
译中被赋予不同的ID。这种情况就会给第三方应用程序程序带来麻烦，因为后者一般是假设一个ID对应的永远是同一个资源的。因此，当我们将自己定义的资源
导出来给第三方应用程序使用时，就需要通过public.xml文件将导出来的资源的ID固定下来。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;我们用一个例子来说public.xml文件的作用，考虑下面这个strings.xml文件：</p><p><br></p><div><div id="highlighter_499799" class="syntaxhighlighter  html"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;?</code><code class="html keyword">xml</code> <code class="html color1">version</code><code class="html plain">=</code><code class="html string">"1.0"</code> <code class="html color1">encoding</code><code class="html plain">=</code><code class="html string">"utf-8"</code><code class="html plain">?&gt;</code></div><div class="line number2 index1 alt1"><code class="html plain">&lt;</code><code class="html keyword">resources</code><code class="html plain">&gt;</code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">string</code> <code class="html color1">name</code><code class="html plain">=</code><code class="html string">"string1"</code><code class="html plain">&gt;String 1&lt;/</code><code class="html keyword">string</code><code class="html plain">&gt;</code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">string</code> <code class="html color1">name</code><code class="html plain">=</code><code class="html string">"string3"</code><code class="html plain">&gt;String 3&lt;/</code><code class="html keyword">string</code><code class="html plain">&gt;</code></div><div class="line number5 index4 alt2"><code class="html plain">&lt;/</code><code class="html keyword">resources</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;假设Android资源打包工具aapt为字符串资源项string1和string3分配到的资源ID如下所示：</p><p><br></p><div><div id="highlighter_731315" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">final</code> <code class="java keyword">class</code> <code class="java plain">R {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// ...</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">class</code> <code class="java plain">string {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">string1=</code><code class="java value">0x7f040000</code><code class="java plain">;</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">string3=</code><code class="java value">0x7f040001</code><code class="java plain">;</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number7 index6 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这时候第三方应用程序就会认为0x7f040001引用的永远是字符串“String 3”。</p><p><br></p><p> &nbsp; &nbsp; &nbsp; &nbsp;假设将来的某一天，我们需要在strings.xml文件中增加一个新的字符串，如下所示：</p><p><br></p><div><div id="highlighter_183730" class="syntaxhighlighter  html"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="html plain">&lt;?</code><code class="html keyword">xml</code> <code class="html color1">version</code><code class="html plain">=</code><code class="html string">"1.0"</code> <code class="html color1">encoding</code><code class="html plain">=</code><code class="html string">"utf-8"</code><code class="html plain">?&gt;</code></div><div class="line number2 index1 alt1"><code class="html plain">&lt;</code><code class="html keyword">resources</code><code class="html plain">&gt;</code></div><div class="line number3 index2 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">string</code> <code class="html color1">name</code><code class="html plain">=</code><code class="html string">"string1"</code><code class="html plain">&gt;String 1&lt;/</code><code class="html keyword">string</code><code class="html plain">&gt;</code></div><div class="line number4 index3 alt1"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">string</code> <code class="html color1">name</code><code class="html plain">=</code><code class="html string">"string2"</code><code class="html plain">&gt;String 2&lt;/</code><code class="html keyword">string</code><code class="html plain">&gt;</code></div><div class="line number5 index4 alt2"><code class="html spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="html plain">&lt;</code><code class="html keyword">string</code> <code class="html color1">name</code><code class="html plain">=</code><code class="html string">"string3"</code><code class="html plain">&gt;String 3&lt;/</code><code class="html keyword">string</code><code class="html plain">&gt;</code></div><div class="line number6 index5 alt1"><code class="html plain">&lt;/</code><code class="html keyword">resources</code><code class="html plain">&gt;</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;如果没有上述的public.xml文件，那么Android资源打包工具aapt为字符串资源项string1、 string2和string3分配的资源ID就会如下所示：</p><div><div id="highlighter_719238" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">final</code> <code class="java keyword">class</code> <code class="java plain">R {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// ...</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">class</code> <code class="java plain">string {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">string1=</code><code class="java value">0x7f040000</code><code class="java plain">;</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">string2=</code><code class="java value">0x7f040001</code><code class="java plain">;</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">string3=</code><code class="java value">0x7f040002</code><code class="java plain">; </code><code class="java comments">// New ID! Was 0x7f040001</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number8 index7 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这就完蛋了，这时候第三方应用程序通过0x7f040001引用到的字符串变成了“String 2”。</p><p><br></p><p>
 &nbsp; &nbsp; &nbsp; &nbsp;如果我们使用上述的public.xml文件将字符串“String 
3”固定为0x7f040001，那么Android资源打包工具aapt为字符串资源项string1、 
string2和string3分配的资源ID就会如下所示：</p><p><br></p><div><div id="highlighter_783961" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">final</code> <code class="java keyword">class</code> <code class="java plain">R {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// ...</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">class</code> <code class="java plain">string {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">string1=</code><code class="java value">0x7f040000</code><code class="java plain">;</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">string2=</code><code class="java value">0x7f040002</code><code class="java plain">;</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">string3=</code><code class="java value">0x7f040001</code><code class="java plain">; </code><code class="java comments">// Resource ID from public.xml</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number8 index7 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;这样第三方应用程序通过0x7f040001引用到的字符串仍然是“String 3”。</p><p><br></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;注意，我们在开发应用程序时，一般是不需要用到public.xml文件的，因为我们的资源基本上都是在内部使用的，不会导出来给第三方应用
程序使用。只在内部使用的资源，不管它的ID如何变化，我们都可以通过R.java文件定义的常量来正确地引用它们。只有系统定义的资源包才会使用到
public.xml文件，因为它定义的资源是需要提供给第三方应用程序使用的。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 2. 写入类型字符串资源池</p><p> &nbsp; &nbsp; &nbsp; &nbsp;在前面的第1个操作中，我们已经将每一个Package用到的类型字符串收集起来了，因此，这里就可以直接将它们写入到Package资源项元信息数据块头部后面的那个数据块去。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 3. 写入资源项名称字符串资源池</p><p> &nbsp; &nbsp; &nbsp; &nbsp;在前面的第2个操作中，我们已经将每一个Package用到的资源项名称字符串收集起来了，这里就可以直接将它们写入到类型字符串资源池后面的那个数据块去。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;Step 4. 写入类型规范数据块</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;类型规范数据块用来描述资源项的配置差异性。通过这个差异性描述，我们就可以知道每一个资源项的配置状况。知道了一个资源项的配置状况之
后，Android资源管理框架在检测到设备的配置信息发生变化之后，就可以知道是否需要重新加载该资源项。类型规范数据块是按照类型来组织的，也就是
说，每一种类型都对应有一个类型规范数据块。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;类型规范数据块的头部是用一个ResTable_typeSpec来定义的。ResTable_typeSpec定义在文件
frameworks/base/include/utils/ResourceTypes.h中，如下所示：</p><p><br></p><div><div id="highlighter_918505" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java preprocessor">/**</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* A specification of the resources defined by a particular type.</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* There should be one of these chunks for each resource type.</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* This structure is followed by an array of integers providing the set of</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* configuation change flags (ResTable_config::CONFIG_*) that have multiple</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* resources for that configuration.&nbsp; In addition, the high bit is set if that</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* resource has been made public.</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number11 index10 alt2"><code class="java plain">struct ResTable_typeSpec</code></div><div class="line number12 index11 alt1"><code class="java plain">{</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResChunk_header header;</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The type identifier this chunk is holding.&nbsp; Type IDs start</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// at 1 (corresponding to the value of the type bits in a</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// resource identifier).&nbsp; 0 is invalid.</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint8_t id;</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Must be 0.</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint8_t res0;</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Must be 0.</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint16_t res1;</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Number of uint32_t entry configuration masks that follow.</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t entryCount;</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">enum</code> <code class="java plain">{</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Additional flag indicating an entry is public.</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SPEC_PUBLIC = </code><code class="java value">0x40000000</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">};</code></div><div class="line number28 index27 alt1"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;嵌入在ResTable_typeSpec里面的ResChunk_header的各个成员变量的取值如下所示：</p><p><br></p><p><strong>--type</strong>：等于RES_TABLE_TYPE_SPEC_TYPE，用来描述一个类型规范头部。</p><p><strong>--headerSize</strong>：等于sizeof(ResTable_typeSpec)，表示头部的大小。</p><p><strong>--size</strong>：等于sizeof(ResTable_typeSpec) + sizeof(uint32_t) * entryCount，其中，entryCount表示本类型的资源项个数。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;ResTable_typeSpec的其它成员变量的取值如下所示：</p><p><strong>--id</strong>：表示资源的Type ID。</p><p><strong> --res0</strong>：等于0，保留以后使用。</p><p><strong>--res1</strong>：等于0，保留以后使用。</p><p><strong>--entryCount</strong>：等于本类型的资源项个数，注意，这里是指名称相同的资源项的个数。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;ResTable_typeSpec后面紧跟着的是一个大小为entryCount的uint32_t数组，每一个数组元数，即每一个
uint32_t，都是用来描述一个资源项的配置差异性的。例如，在图17中，名称为icon的drawable资源项有三种不同的屏幕配置ldpi、
mdpi和hdpi，于是用来描述它的配置差异性的uint32_t的第CONFIG_DENSITY位就等于1，而其余位都等于0。又如，在图17中，
名称为main的layout资源项只有一种配置default，于是用来描述它的配置差异性的uint32_t的值就等于0。此外，如果一个资源项是导
出的，即它的资源ID是通过public.xml来固定的，那么用来描述它的配置差异性的uint32_t的第
ResTable_typeSpec::SPEC_PUBLIC位也会被设置为1。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;在图17中，一共有4种不同类型的资源项，它们所对应的4个类型规范数据块如图21至图24所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365523784_7600.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""></p><p style="text-align:center;">图21 类型为drawable的规范数据块</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365523841_5749.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""></p><p style="text-align:center;">图22 类型为layout的规范数据块</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365523878_1748.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload="" width="650"></p><p style="text-align:center;">图23 类型为string的规范数据块</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365523909_8353.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload="" width="650"></p><p style="text-align:center;">图24 类型为id的规范数据块</p><p style="text-align:left;">
 &nbsp; &nbsp; &nbsp; 
&nbsp;从图21到图24就可以看出，类型为drawable的资源项icon在设备的屏幕密度发生变化之后，Android资源管理框架需要重新对
它进行加载，以便获得更合适的资源项，而其它资源项无论设备配置信息发生何种变化，它们都不需要重新加载，因为它们只有一种配置。</p><p style="text-align:left;"> &nbsp; &nbsp; &nbsp; &nbsp;Step 5. 写入类型资源项数据块</p><p style="text-align:left;">
 &nbsp; &nbsp; &nbsp; &nbsp;类型资源项数据块用来描述资源项的具体信息， 
这样我们就可以知道每一个资源项名称、值和配置等信息。类型资源项数据同样是按照类型和配置来组织的，也就是说，一个具有N个配置的类型一共对应有N个类
型资源项数据块。</p><p> &nbsp; &nbsp; &nbsp; 
&nbsp;类型资源项数据块的头部是用一个ResTable_type来定义的。ResTable_type定义在文件frameworks/base
/include/utils/ResourceTypes.h中，如下所示：</p><p><br></p><div><div id="highlighter_519874" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java preprocessor">/**</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* A collection of resource entries for a particular resource data</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* type. Followed by an array of uint32_t defining the resource</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* values, corresponding to the array of type strings in the</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* ResTable_package::typeStrings string block. Each of these hold an</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* index from entriesStart; a value of NO_ENTRY means that entry is</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* not defined.</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* There may be multiple of these chunks for a particular resource type,</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* supply different configuration variations for the resource values of</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* that type.</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* It would be nice to have an additional ordered index of entries, so</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* we can do a binary search if trying to find a resource by string name.</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number16 index15 alt1"><code class="java plain">struct ResTable_type</code></div><div class="line number17 index16 alt2"><code class="java plain">{</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResChunk_header header;</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">enum</code> <code class="java plain">{</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">NO_ENTRY = </code><code class="java value">0xFFFFFFFF</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">};</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The type identifier this chunk is holding.&nbsp; Type IDs start</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// at 1 (corresponding to the value of the type bits in a</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// resource identifier).&nbsp; 0 is invalid.</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint8_t id;</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Must be 0.</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint8_t res0;</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Must be 0.</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint16_t res1;</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Number of uint32_t entry indices that follow.</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t entryCount;</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Offset from header where ResTable_entry data starts.</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t entriesStart;</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Configuration this collection of entries is designed for.</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ResTable_config config;</code></div><div class="line number36 index35 alt1"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p><br></p><p> &nbsp; &nbsp; &nbsp; &nbsp;嵌入在ResTable_type里面的ResChunk_header的各个成员变量的取值如下所示：</p><p><strong>--type</strong>：等于RES_TABLE_TYPE_TYPE，用来描述一个类型资源项头部。</p><p><strong>--headerSize</strong>：等于sizeof(ResTable_type)，表示头部的大小。</p><p><strong>--size</strong>：等于sizeof(ResTable_type) + sizeof(uint32_t) * entryCount，其中，entryCount表示本类型的资源项个数。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;ResTable_type的其它成员变量的取值如下所示：</p><p><strong>--id</strong>：表示资源的Type ID。</p><p><strong> --res0</strong>：等于0，保留以后使用。</p><p><strong>--res1</strong>：等于0，保留以后使用。</p><p><strong>--entryCount</strong>：等于本类型的资源项个数，注意，这里是指名称相同的资源项的个数。</p><p><strong>--entriesStart</strong>：等于资源项数据块相对头部的偏移值。</p><p><strong>--config</strong>：指向一个ResTable_config，用来描述配置信息，它的定义可以参考图2的类图。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;ResTable_type紧跟着的是一个大小为entryCount的uint32_t数组，每一个数组元数，即每一个uint32_t，
都是用来描述一个资源项数据块的偏移位置。紧跟在这个uint32_t数组后面的是一个大小为entryCount的ResTable_entry数组，
每一个数组元素，即每一个ResTable_entry，都是用来描述一个资源项的具体信息。</p><p> &nbsp; &nbsp; &nbsp;
 
&nbsp;在图17中，一共有4种不同类型的资源项，其中，类型为drawable的资源有1个资源项以及3种不同的配置，类型为layout的资源有
2个资源项以及1种配置，类型为string的资源有5个资源项以及1种配置，类型为id的资源有2个资源项以及1种配置，这样一共就对应有3 + 1 +
 1 + 1个类型资源项数据块，如图25至图图30所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365529026_6627.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图25 类型为drawable和配置为ldpi的资源项数据块</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365529080_3648.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图26 类型为drawable和配置为mdpi的资源项数据块</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365529120_3182.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图27 类型为drawable和配置为hdpi的资源项数据块</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365529155_6199.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图28 类型为layout和配置为default的资源项数据块</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365529193_3781.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图29 类型为string和配置为default的资源项数据块</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365529232_1850.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图30 类型为id和配置为default的资源项数据块</p><p> &nbsp; &nbsp; &nbsp; 注意，ResTable_type后面的uint32_t数组和ResTable_entry数组的大小不一定是相等的，考虑下面的资源目录：</p><p><br></p><div><div id="highlighter_318806" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">--res</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">--drawable-ldpi</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">--icon.png</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">--drawable-mdpi</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">--icon.png</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">--logo.png</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">--drawable-hdpi</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">--logo.png</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;那么最终得到类型为drawable和配置为ldpi的资源项数据块如图31所示：</p><p><br></p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365529470_9348.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""></p><p style="text-align:center;">图31 大小不等的uint32_t数组和ResTable_entry数组的资源项数据块</p><p> &nbsp; &nbsp; &nbsp; &nbsp;由于不存在类型为drawable、配置为ldpi，并且名称为logo的资源项，因此，在图31中，ResTable_type后面的<span style="text-align:center;">uint32_t数组和ResTable_entry数组的大小是不相等的，并且没有相应的<span style="text-align:center;">ResTable_entry的<span style="text-align:center;">uint32_t数组元素的值会被设置为ResTable_type::NO_ENTRY。</span></span></span></p><p><br></p><div style="text-align:left;"> &nbsp; &nbsp; &nbsp; &nbsp;每一个资源项数据都是通过一个<span style="text-align:center;">ResTable_entry来定义的。<span style="text-align:center;">ResTable_entry定义在文件frameworks/base/include/utils/ResourceTypes.h中，如下所示：</span></span></div><p><br></p><div><div id="highlighter_78269" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java preprocessor">/**</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* This is the beginning of information about an entry in the resource</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* table.&nbsp; It holds the reference to the name of this entry, and is</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* immediately followed by one of:</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*&nbsp;&nbsp; * A Res_value structure, if FLAG_COMPLEX is -not- set.</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*&nbsp;&nbsp; * An array of ResTable_map structures, if FLAG_COMPLEX is set.</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*&nbsp;&nbsp;&nbsp;&nbsp; These supply a set of name/value mappings of data.</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number9 index8 alt2"><code class="java plain">struct ResTable_entry</code></div><div class="line number10 index9 alt1"><code class="java plain">{</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Number of bytes in this structure.</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint16_t size;</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">enum</code> <code class="java plain">{</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// If set, this is a complex entry, holding a set of name/value</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// mappings.&nbsp; It is followed by an array of ResTable_map structures.</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">FLAG_COMPLEX = </code><code class="java value">0x0001</code><code class="java plain">,</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// If set, this resource has been declared public, so libraries</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// are allowed to reference it.</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">FLAG_PUBLIC = </code><code class="java value">0x0002</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">};</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint16_t flags;</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Reference into ResTable_package::keyStrings identifying this entry.</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResStringPool_ref key;</code></div><div class="line number24 index23 alt1"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p><span style="text-align:center;">ResTable_entry的各个成员变量的取值如下所示：</span></p><p><span style="text-align:center;"><strong>--size</strong>：等于sizeof(ResTable_entry)，表示资源项头部大小。</span></p><p><span style="text-align:center;"><strong>--flags</strong>：资源项标志位。如果是一个Bag资源项，那么FLAG_COMPLEX位就等于1，并且在<span style="text-align:center;">ResTable_entry后面跟有一个ResTable_map数组，否则的话，<span style="text-align:center;">在</span><span style="text-align:center;">ResTable_entry后面跟的是一个Res_value</span>。如果是一个可以被引用的资源项，那么FLAG_PUBLIC位就等于1。</span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><strong>--key</strong>：资源项名称在资源项名称字符串资源池的索引。</span></span></p><p> &nbsp; &nbsp; &nbsp; &nbsp;接下来我们就分两种情况来讨论资源项信息写入到资源索引表的过程。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;首先看一个普通的资源项，即一个非Bag资源项的写入过程。从图2可以知道，每一个资源项的数据都是用一个Item来描述的。在这个Item中，有一个类型为<span style="text-align:center;">Res_value的</span>成员变量parsedValue，它表示一个资源项经过解析后得到值。</p><p style="text-align:left;"> &nbsp; &nbsp; &nbsp; &nbsp;前面在分析Xml资源文件的编译过程时，我们已经介绍过<span style="text-align:center;">Res_value的定义了。假设当前要写入的资源项是类型为layout的main，从图17可以知道，它的值是一个字符串“res/layout/main.xml”。字符串<span style="text-align:center;">“res/layout/main.xml”</span>在前面的第3步中已经被写入到一个资源项值字符串池中去了，我们假设它被写入在第3个位置上，那么用来描述资源项<span style="text-align:center;">main的<span style="text-align:center;">Res_value的各个成员变量的取值如下所示：</span></span></span></p><p style="text-align:left;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><strong>--size</strong>：等于sizeof(<span style="text-align:center;">Res_value</span>)。</span></span></span></p><p style="text-align:left;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><strong>--res0</strong>：等于0，保留以后使用。</span></span></span></p><p style="text-align:left;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><strong>--dataType</strong>：等于TYPE_STRING。</span></span></span></p><p style="text-align:left;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><strong>--data</strong>：等于0x3。</span></span></span></p><p style="text-align:left;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;我们通过图32来总结一个普通资源项写入到资源表索引表的数据块结构：</span></span></span></p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365608138_8001.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""></p><p style="text-align:center;">图32 普通资源项写入到<span style="text-align:center;">资源索引表的数据块结构</span></p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;接着看一个Bag资源项的写入过程。以图7所示的Bag资源项custom_orientation为例，它有本个bag，分别是
^type、custom_vertical和custom_horizontal，其中，custom_vertical和
custom_horizontal是两个自定义的bag，它们的值分别等于0x0和0x1，而^type是一个系统内部定义的bag，它的值固定为
0x10000。 
注意，^type、custom_vertical和custom_horizontal均是类型为id的资源，假设它们分配的资源ID分别为
0x1000000、0x7f040000和7f040001。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;一个Bag资源项写入到资源索引表的数据块结构如图33所示：</p><p style="text-align:center;"><img onload="if(this.width>650) this.width=650;" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/1365609887_6372.jpg" onabort="" onblur="" onchange="" onclick="" ondblclick="" onerror="" onfocus="" onkeydown="" onkeypress="" onkeyup="" onmousedown="" onmousemove="" onmouseout="" onmouseover="" onmouseup="" onreset="" onresize="" onselect="" onsubmit="" onunload=""><br></p><p style="text-align:center;">图33 Bag<span style="text-align:center;">资源项写入到</span><span style="text-align:center;">资源索引表的数据块结构</span></p><p><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;在图33中，紧跟在ResTable_entry后面的是一个ResTable_map_entry，用来描述后面要写入到的ResTable_map的信息。假设一个Bag资源项有N个bag，那么在<span style="text-align:center;">ResTable_map_entry就有N个<span style="text-align:center;">ResTable_map。</span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;">ResTable_map_entry定义在文件frameworks/base/include/utils/ResourceTypes.h中，如下所示：</span></span></span></span></p><p><br></p><div><div id="highlighter_961187" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java preprocessor">/**</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*&nbsp; This is a reference to a unique entry (a ResTable_entry structure)</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*&nbsp; in a resource table.&nbsp; The value is structured as: 0xpptteeee,</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*&nbsp; where pp is the package index, tt is the type index in that</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*&nbsp; package, and eeee is the entry index in that type.&nbsp; The package</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*&nbsp; and type values start at 1 for the first item, to help catch cases</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*&nbsp; where they have not been supplied.</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number9 index8 alt2"><code class="java plain">struct ResTable_ref</code></div><div class="line number10 index9 alt1"><code class="java plain">{</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t ident;</code></div><div class="line number12 index11 alt1"><code class="java plain">};</code></div><div class="line number13 index12 alt2"><code class="java preprocessor">/**</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Extended form of a ResTable_entry for map entries, defining a parent map</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* resource from which to inherit values.</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number17 index16 alt2"><code class="java plain">struct ResTable_map_entry : </code><code class="java keyword">public</code> <code class="java plain">ResTable_entry</code></div><div class="line number18 index17 alt1"><code class="java plain">{</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Resource identifier of the parent mapping, or 0 if there is none.</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ResTable_ref parent;</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Number of name/value pairs that follow for FLAG_COMPLEX.</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t count;</code></div><div class="line number23 index22 alt2"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; ResTable_map_entry是从ResTable_entry继承下来的，我们首先看ResTable_entry的各个成员变量的取值：</p><p><strong>--size</strong>：等于sizeof(ResTable_map_entry)。</p><p><strong>--flags</strong>：由于在紧跟在ResTable_map_entry前面的ResTable_entry的成员变量flags已经描述过资源项的标志位了，因此，这里的flags就不用再设置了，它的值等于0。</p><p><strong>--key</strong>：由于在紧跟在ResTable_map_entry前面的ResTable_entry的成员变量key已经描述过资源项的名称了，因此，这里的key就不用再设置了，它的值等于0。</p><p> &nbsp; &nbsp; &nbsp; ResTable_map_entry的各个成员变量的取值如下所示：</p><p><strong> --parent</strong>：指向父ResTable_map_entry的资源ID，如果没有父ResTable_map_entry，则等于0。</p><p><strong>--count</strong>：等于bag项的个数。</p><p><span style="text-align:center;">Bag资源项的每一个bag都用一个ResTable_map来表示。<span style="text-align:center;">ResTable_map定义在文件<span style="text-align:center;">frameworks/base/include/utils/ResourceTypes.h中，如下所示：</span></span></span></p><p><br></p><div><div id="highlighter_1912" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">struct ResTable_map</code></div><div class="line number2 index1 alt1"><code class="java plain">{</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The resource identifier defining this mapping's name.&nbsp; For attribute</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// resources, 'name' can be one of the following special resource types</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// to supply meta-data about the attribute; for all other resource types</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// it must be an attribute resource.</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ResTable_ref name;</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">.....</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// This mapping's value.</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Res_value value;</code></div><div class="line number11 index10 alt2"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p><span style="text-align:center;">ResTable_map只有两个成员变量，其中：</span></p><p><span style="text-align:center;"><strong>--name</strong>：等于bag的资源项ID。</span></p><p><span style="text-align:center;"><strong>--value</strong>：等于bag的资源项值。</span></p><p><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;例如，对于custom_vertical来说，用来描述它的<span style="text-align:center;">ResTable_map的成员变量name的值就等于0x7f040000，而成员变量value所指向的一个Res_value的各个成员变量的值如下所示：</span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><strong>--size</strong>：等于sizeof(<span style="text-align:center;">Res_value</span>)。</span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><strong>--res0</strong>：等于0，保留以后使用。</span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><strong>--dataType</strong>：等于TYPE_INT_DEC，表示data是一个十进制的整数。</span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><strong>--data</strong>：等于0。</span></span></p><p><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;我们可以依此类推，分别得到用来描述^type和custom_horizontal这两个bag的<span style="text-align:center;">ResTable_map的值。</span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;5. 写入资源索引表头部</span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;">资源索引表头部使用一个ResTable_header来表示。<span style="text-align:center;">ResTable_header定义在文件<span style="text-align:center;">frameworks/base/include/utils/ResourceTypes.h中，如下所示：</span></span></span></span></span></span></p><p><br></p><div><div id="highlighter_50351" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java preprocessor">/**</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Header for a resource table.&nbsp; Its data contains a series of</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* additional chunks:</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*&nbsp;&nbsp; * A ResStringPool_header containing all table values.</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*&nbsp;&nbsp; * One or more ResTable_package chunks.</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* Specific entries within a resource table can be uniquely identified</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;</code><code class="java preprocessor">* with a single integer as defined by the ResTable_ref structure.</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;</code><code class="java preprocessor">*/</code></div><div class="line number10 index9 alt1"><code class="java plain">struct ResTable_header</code></div><div class="line number11 index10 alt2"><code class="java plain">{</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">struct ResChunk_header header;</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// The number of ResTable_package structures.</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">uint32_t packageCount;</code></div><div class="line number15 index14 alt2"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div><p> &nbsp; &nbsp; &nbsp; &nbsp;嵌入在<span style="text-align:center;">ResTable_header内部的ResChunk_header的各个成员变量的取值如下所示：</span><br></p><p><span style="text-align:center;"><strong>--type</strong>：等于RES_TABLE_TYPE，表示这是一个资源索引表头部。</span></p><p><span style="text-align:center;"><strong>--headerSize</strong>：等于sizeof(<span style="text-align:center;">ResTable_header</span>)，表示头部的大小。</span></p><p><span style="text-align:center;"><strong>--size</strong>：等于整个resources.arsc文件的大小。</span></p><p><span style="text-align:center;"><span style="text-align:center;">ResTable_header的其它成员变量的取值如下所示：</span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><strong>--packageCount</strong>：等于被编译的资源包的个数。</span></span></p><p><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;6. 写入资源项的值字符串资源池</span></span></p><p> &nbsp; &nbsp; &nbsp; &nbsp;在前面的第3步中，我们已经将所有的<span style="text-align:center;">资源项的值字符串都收集起来了，因此，这里直接它们写入到资源索引表去就可以了。注意，这个<span style="text-align:center;">字符串资源池包含了在所有的<span style="text-align:center;">资源包里面所定义的资源项的值字符串，并且是紧跟在资源索引表头部的后面。</span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;7. 写入Package数据块</span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;在前面的第4步中，我们已经所有的<span style="text-align:center;">Package数据块都收集起来了，因此，这里直接将它们写入到资源索引表去就可以了。这些<span style="text-align:center;">Package数据块是依次写入到<span style="text-align:center;">资源索引表去的，并且是紧跟在资源项的<span style="text-align:center;">值字符串资源池的后面。</span></span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;至此，资源项索引表的生成好了。</span></span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;十. 编译AndroidManifest.xml文件</span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; &nbsp;经过前面的九个步骤之后，应用程序的所有资源项就编译完成了，这时候就开始将应用程序的配置文件<span style="text-align:center;">AndroidManifest.xml也编译成二进制格式的Xml文件。之所以要在<span style="text-align:center;">应用程序的所有资源项都编译完成之后，再编译<span style="text-align:center;">应用程序的配置文件，是因为后者可能会引用到前者。</span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;">应用程序配置文件</span><span style="text-align:center;">AndroidManifest.xml的编译过程与其它的Xml资源文件的编译过程是一样的，可以参考前面的第七步。注意，<span style="text-align:center;">应用程序配置文件</span><span style="text-align:center;">AndroidManifest.xml编译完成之后，Android资源打包工具appt还会验证它的完整性和正确性，例如，验证<span style="text-align:center;">AndroidManifest.xml的根节点mainfest必须定义有android:package属性。</span></span></span></span></span></span></span></span></span></p><p><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"><span style="text-align:center;"> &nbsp; &nbsp; &nbsp; 十一. 生成R.java文件</span></span></span></span></span></span></span></span></span></p><p>
 &nbsp; &nbsp; &nbsp; 
在前面的第八步中，我们已经将所有的资源项及其所对应的资源ID都收集起来了，因此，这里只要将直接将它们写入到指定的R.java文件去就可以了。例
如，假设分配给类型为layout的资源项main和sub的ID为0x7f030000和0x7f030001，那么在R.java文件，就会分别有两
个以main和sub为名称的常量，如下所示：</p><p><br></p><div><div id="highlighter_540431" class="syntaxhighlighter  java"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">final</code> <code class="java keyword">class</code> <code class="java plain">R {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">class</code> <code class="java plain">layout {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">main=</code><code class="java value">0x7f030000</code><code class="java plain">;</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">sub=</code><code class="java value">0x7f030001</code><code class="java plain">;</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">......</code></div><div class="line number8 index7 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;注意，每一个资源类型在R.java文件中，都有一个对应的内部类，例如，类型为layout的资源项在R.java文件中对应的内部类为
layout，而类型为string的资源项在R.java文件中对应的内部类就为string。</p><p><br></p><p> &nbsp; &nbsp; &nbsp; &nbsp;十二. 打包APK文件</p><p> &nbsp; &nbsp; &nbsp; &nbsp;所有资源文件都编译以及生成完成之后，就可以将它们打包到APK文件去了，包括：</p><p> &nbsp; &nbsp; &nbsp; &nbsp;1. assets目录。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;2. res目录，但是不包括res/values目录， 这是因为res/values目录下的资源文件的内容经过编译之后，都直接写入到资源项索引表去了。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;3. 资源项索引文件resources.arsc。</p><p>
 &nbsp; &nbsp; &nbsp; 
&nbsp;当然，除了这些资源文件外，应用程序的配置文件AndroidManifest.xml以及应用程序代码文件classes.dex，还有用
来描述应用程序的签名信息的文件，也会一并被打包到APK文件中去，这个APK文件可以直接拿到模拟器或者设备上去安装。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;至此，我们就分析完成Android应用程序资源的编译和打包过程了，其中最重要的是要掌握以下四个要点：</p><p> &nbsp; &nbsp; &nbsp; &nbsp;1. &nbsp;Xml资源文件从文本格式编译为二进制格式的过程。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;2. Xml资源文件的二进制格式。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;3. 资源项索引表resources.arsc的生成过程。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;4. 资源项索引表resources.arsc的二进制格式。</p><p> &nbsp; &nbsp; &nbsp; &nbsp;理解了Android应用程序资源的编译和打包过程之后，接下来我们就可以分析Android应用程序在运行时查找索引的过程了，敬请关注！</p><p style="text-align:center;"><span style="font-size:14px;color:#cc0000;"><strong>老罗的新浪微博：<a href="http://weibo.com/shengyangluo" target="_blank">http://weibo.com/shengyangluo</a>，欢迎关注！</strong></span><br></p><p>本文出自 “<a href="http://shyluo.blog.51cto.com/">老罗的Android之旅</a>” 博客，请务必保留此出处<a href="http://shyluo.blog.51cto.com/5725845/1229261">http://shyluo.blog.51cto.com/5725845/1229261</a></p>
		  </div>

			<!--正文 end-->
<script type="text/javascript" language="javascript">
	function iFrameHeight() {
		var ifm= document.getElementById("iframepage");
		var subWeb = document.frames ? document.frames["iframepage"].document : ifm.contentDocument;
		if(ifm != null && subWeb != null) {
			ifm.height = subWeb.body.scrollHeight;
		}
	}
</script>
<script type="text/javascript">
	var kevent = 
'onabort|onblur|onchange|onclick|ondblclick|onerror|onfocus|onkeydown|onkeypress|onkeyup|onload|onmousedown|onmousemove|onmouseout|onmouseover|onmouseup|onreset|onresize|onselect|onsubmit|onunload';

	var aevent = kevent.split('|');

	jQuery('.showContent img').each(function(){
		var nimg = this;
		jQuery.each(aevent, function(i, n){
			if (n!='onload') {
				jQuery(nimg).attr(n, '');
			} else {
				if (jQuery(nimg).attr(n) != 'if(this.width>650) this.width=650;') {
					jQuery(nimg).attr(n, '');
				}
			}
		});
	});
</script>
<script type="text/javascript" charset="utf-8">
var encodetitle = encodeURI('一篇很棒的博文分享给大家：《Android应用程序资源的编译和打包过程分析》');

function show51share(){

	
window.open('http://t.51cto.com/index.php?m=share&url=http://shyluo.blog.51cto.com/5725845/1229261&type=l&count=&relateUid=&appkey=3843950324&title='
 + encodetitle);
}
</script>
<div class="m_sharebtn clear">
	<table width="100%" cellspacing="0" cellpadding="0" border="0">
	  <tbody><tr>
		<td width="11%" valign="middle" height="43" align="center"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/ssk.png" alt="分享至"></td>
		<td width="77%" valign="top" align="left">
<!--
<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_mshare" data-cmd="mshare" title="分享到一键分享"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_bdhome" data-cmd="bdhome" title="分享到百度新首页"></a><a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a><a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a><a href="#" class="bds_bdysc" data-cmd="bdysc" title="分享到百度云收藏"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a></div>
<script>
var bds_config = {'wbUid':1706976420};
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false, 'bdPic':'http://blog.51cto.com/attachment/201305/173413310.jpg',"bdStyle":"1","bdSize":"32"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
 -->

<div class="bdsharebuttonbox bdshare-button-style1-32" data-bd-bind="1503365856673"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_mshare" data-cmd="mshare" title="分享到一键分享"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_bdhome" data-cmd="bdhome" title="分享到百度新首页"></a><a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a><a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_bdysc" data-cmd="bdysc" title="分享到百度云收藏"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{"tsina":"2065779340"},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"http://blog.51cto.com/img/blog_down0731.jpg","bdStyle":"1","bdSize":"32"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new
 Date()/36e5)];</script>

	<!-- Baidu Button END --></td>
		<td width="12%" valign="middle" align="right"><a class="bdms_point" data-behavior="favorite" data-method="add" href="javascript:favorBox('open');" title="一键收藏，随时查看，分享好友！"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/favorite_add_small.gif" alt="一键收藏，随时查看，分享好友！" border="0"></a></td>
	  </tr>
	</tbody></table>

</div>
    		<div class="showBottom">
            <!--<div class="reviews"><span class="fl" style="cursor:pointer;"><a onclick="openFavoulist();" id="favourer">js331455217</a>

            </span><div id="favourdiv" class="support01">1人</div>
              <span class="fl">了这篇文章</span></div>-->
              <table width="720" cellspacing="0" cellpadding="0" border="0">
  <tbody><tr>
    <td align="right"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/icon01.png" width="15" height="16"> <span style="cursor:pointer;"><a onclick="openFavoulist();" id="favourer">js331455217</a></span></td>
    <td width="70" align="left"><div style="line-height:28px;" id="favourdiv" class="support01">1人</div></td>
    <td width="60" align="left">了这篇文章</td>
  </tr>
</tbody></table>




            <div class="showType">类别：<a href="http://shyluo.blog.51cto.com/5725845/d-1" class="operlink">Android</a>┆阅读(<span id="readNum">879</span>)┆评论(<span id="cmtNum">0</span>)

┆
<a href="http://shyluo.blog.51cto.com/">返回博主首页</a>┆<a href="http://blog.51cto.com/">返回博客首页</a></div>
            <div class="prevNext">

			上一篇 <a href="http://shyluo.blog.51cto.com/5725845/1229260" class="operlink" title="Android应用程序资源管理器（Asset Manager）的创建过程分析">Android应用程序资源管理器（Asset Manager）..</a>


			下一篇 <a href="http://shyluo.blog.51cto.com/5725845/1229262" class="operlink" title="Android资源管理框架（Asset Manager）简要介绍和学习计划">Android资源管理框架（Asset Manager）简要介..</a>


            </div>

            </div>

	  </div><!--showBottom end-->
      </div><!--modCon-->
    <span class="modBot"></span>
    </div><!--artShow end-->
    <span class="blank"></span>




	<div class="relatedArt box">
		<a href="javascript:;"><img src=""></a>
	</div>


<div class="artComm box">
    <div class="title"><a name="replay"></a><h2>文章评论</h2></div>
    <div class="modCon" id="artcomment">
		<div>  &nbsp;</div><div>  &nbsp;</div>
    </div><!--modCon-->
        <span class="modBot"></span>
</div><!--commBox end-->
<a href="" id="com_top_top"></a>
<!--<div class="artComm box" style="750px;height:90px;">
<script type="text/javascript">
    var cpro_id = "u2386995";
</script>
<script src="http://cpro.baidustatic.com/cpro/ui/c.js" type="text/javascript"></script>
</div>--><form action="/comment.php?" method="post" name="form1" id="form1" onsubmit='return commentSubmit(this,"");'>
<span class="blank1"></span>
<div class="box writeComm" style="min-height:30px;">
<a name="comment"></a>
<input name="action" value="comment" type="hidden">
<input id="commenttid" name="tid" value="1229261" type="hidden">
<input name="com_count_ajax" id="com_count_ajax" value="1" type="hidden">

 <div class="title">
	<h2 class="fl">发表评论&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h2>
	<span class="fl" id="messageTj">
<script type="text/javascript"><!--//<![CDATA[
   var m3_u = 
(location.protocol=='https:'?'https://gg.51cto.com/www/delivery/ajs.php':'http://gg2.51cto.com/www/delivery/ajs.php');

   var m3_r = Math.floor(Math.random()*99999999999);
   if (!document.MAX_used) document.MAX_used = ',';
   document.write ("<scr"+"ipt type='text/javascript' src='"+m3_u);
   document.write ("?zoneid=460");
   document.write ('&amp;cb=' + m3_r);
   if (document.MAX_used != ',') document.write ("&amp;exclude=" + 
document.MAX_used);
   document.write (document.charset ? '&amp;charset='+document.charset :
 (document.characterSet ? '&amp;charset='+document.characterSet : ''));
   document.write ("&amp;loc=" + escape(window.location));
   if (document.referrer) document.write ("&amp;referer=" + 
escape(document.referrer));
   if (document.context) document.write ("&context=" + 
escape(document.context));
   if (document.mmm_fo) document.write ("&amp;mmm_fo=1");
   document.write ("'><\/scr"+"ipt>");
//]]>--></script><script type="text/javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/ajs.php"></script><div id="beacon_912d834f12" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/lg.gif" alt="" style="width: 0px; height: 0px;" width="0" height="0"></div>

</span>
	<style type="text/css">
		a.mred:link{ color:#ff0000; text-decoration:underline;}
		a.mred:visited{color:#ff0000;}
		a.mred:hover{color:#ff0000;}
		a.mred:active{color:#ff0000;}
	</style>
</div>
<div style="display:none" rel="" id="ggBox">
<script type="text/javascript"><!--//<![CDATA[
   var m3_u = 
(location.protocol=='https:'?'https://gg.51cto.com/www/delivery/ajs.php':'http://gg2.51cto.com/www/delivery/ajs.php');

   var m3_r = Math.floor(Math.random()*99999999999);
   if (!document.MAX_used) document.MAX_used = ',';
   document.write ("<scr"+"ipt type='text/javascript' src='"+m3_u);
   document.write ("?zoneid=460");
   document.write ('&amp;cb=' + m3_r);
   if (document.MAX_used != ',') document.write ("&amp;exclude=" + 
document.MAX_used);
   document.write (document.charset ? '&amp;charset='+document.charset :
 (document.characterSet ? '&amp;charset='+document.characterSet : ''));
   document.write ("&amp;loc=" + escape(window.location));
   if (document.referrer) document.write ("&amp;referer=" + 
escape(document.referrer));
   if (document.context) document.write ("&context=" + 
escape(document.context));
   if (document.mmm_fo) document.write ("&amp;mmm_fo=1");
   document.write ("'><\/scr"+"ipt>");
//]]>--></script><script type="text/javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/ajs.php"></script><div id="beacon_912d834f12" style="position: absolute; left: 0px; top: 0px; visibility: hidden;"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/lg.gif" alt="" style="width: 0px; height: 0px;" width="0" height="0"></div>

</div>
<script>
document.getElementById("messageTj").innerHTML = document.getElementById("ggBox").innerHTML;
</script>
 <div class="modCon">

 <div class="commForm">
<dl>
<dt>昵&nbsp;&nbsp;称：</dt>
<dd>

<input id="commentusername" name="username" class="commInput fl" type="text"><span><a href="http://home.51cto.com/index.php?reback=http%253A%252F%252Fshyluo.blog.51cto.com%252F5725845%252F1229261" style="text-decoration:underline">登录</a>&nbsp;&nbsp;<a href="http://home.51cto.com/user/register?reback=http%253A%252F%252Fshyluo.blog.51cto.com%252F5725845%252F1229261" target="_blank" style="text-decoration: underline;">快速注册</a></span>



</dd>
</dl>



<dl id="commentyanzheng">


<dt>验证码：</dt>
<dd><input class="code" id="commentauthnum" name="authnum" onclick="displaysecunum();" type="text">

  <img class="fl" id="secunum" onclick="refimg()" style="display:none;" width="78" height="29"><p class="fl"><span style="display:none;" id="spanfont">点击图片可刷新验证码</span><span style="display:inline;" id="clickfont">请点击后输入验证码</span><span class="pl5"><a href="http://51ctoblog.blog.51cto.com/26414/5591" target="_blank" style="text-decoration: underline;">博客过2级，无需填写验证码</a></span></p></dd>
</dl>
<dl>
<dt>内&nbsp;&nbsp;容：</dt>
<dd>
<textarea class="writeCommCon f12" id="commentcontent" name="content"></textarea>
</dd>
</dl>
</div>
<div class="writeCommBot">
  <input name="parentid" value="" id="parentid" type="hidden">
  <input class="commBtn fl" name="submit" id="commentsubmit" value="" onclick="commentSubmitend2()" type="button">

 <p class="fl" style="display:none;"><input class="fl" name="favour" id="favour" checked="checked" value="1" type="checkbox"><span class="fl">同时赞一个</span></p>

</div>
<span class="blank"></span>

</div><!--modCon-->
<span class="modBot"></span>
</div>
</form>
<iframe id="iframe1" name="iframe1" width="0" height="0"></iframe>
<!--发表评论 end-->
</div>
</div>
<!-- <div style="width:100px; height:300px; position:fixed; top:25%;left:50%;margin-left:-613px;z-index:100; _position:absolute; _margin-top: 0; _top:expression(documentElement.scrollTop+(documentElement.clientHeight-this.offsetHeight)/2+50);" id="f_close_box">
<img border="0" usemap="#Map1" src="https://s1.51cto.com/wyfs02/M00/93/21/wKiom1kISujgrYSbAADPIiyteUc221.jpg">
<map id="Map1" name="Map1">
<area onclick="document.getElementById('f_close_box').style.display='none';" href="javascript:void(0);" coords="86,14,10"  shape="circle">
</map>

</div> -->
<iframe src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/get-station-ads.htm" style="position: fixed;left:0; top:240px;width:100px; height:300px;" scrolling="no" frameborder="0"></iframe>
<script language="javascript">
	function refimg(){
		var randval = Math.random();
		document.getElementById("secunum").src="/seccode.php?rnum="+randval;
	}
	function displaysecunum()
	{
		var displaystr = document.getElementById("secunum").style.display;
		if(displaystr == 'none')
		{
			refimg();
			document.getElementById("clickfont").style.display = 'none';
			document.getElementById("secunum").style.display = 'inline';
			document.getElementById("spanfont").style.display = 'inline';
		}
	}

	function showMsn(){
		document.getElementById("c02").style.display = "none";
		document.getElementById("c01").style.display = "block";
		document.getElementById("share").style.height = "83px";
		document.getElementById("share").style.background = "none";
	}
	function showBBS(){
		document.getElementById("c01").style.display = "none";
		document.getElementById("c02").style.display = "block";
		document.getElementById("share").style.height = "83px";
		document.getElementById("share").style.background = "none";
	}

	//资源页面，分享按钮
	function copyShareUrl(title){

		if (window.clipboardData){

			if(document.getElementById("c01").style.display == 'block')
			{
				copy = "推荐：" + title + 
"http://shyluo.blog.51cto.com/5725845/1229261";
				var alertText = "复制成功，你可以粘贴到MSN或QQ中发给好友。";
			}
			else
			{
				copy = "[url=" + "http://shyluo.blog.51cto.com/5725845/1229261" + 
"][u]" + title + "[/u][/url]";
				var alertText = "复制成功，你可以粘贴到论坛分享给坛友。";
			}
			window.clipboardData.clearData();
			window.clipboardData.setData("Text", copy);
			alert(alertText);
		}
		else if (window.netscape){
			alert("您使用的浏览器不支持此复制功能，请使用Ctrl+C或鼠标右键。");
			if(document.getElementById("c01").style.display == 'block')
			{
				document.getElementById("shareTextQM").value = "推荐：" + title + 
"http://shyluo.blog.51cto.com/5725845/1229261";
				document.getElementById("shareTextQM").select();
			}
			else
			{
				document.getElementById("shareTextBBS").value = "[url=" + 
"http://shyluo.blog.51cto.com/5725845/1229261" + "][u]" + title + 
"[/u][/url]";
                document.getElementById("shareTextBBS").select();
			}
		}
		return false;
	}
	function select_login(){
		document.getElementById('fixed').style.display='';
	}
	function commentcheck()
	{
		if(document.form1.content.value == "")
		{
			alert("评论内容为空!");
			document.form1.content.focus();
			return false;
		}
	}
	function changename(){

	var memberid=0;
	memberid="";

	if(document.getElementById('commentniming').checked){
		document.getElementById('commentusername').disabled=false;
		document.getElementById('commentusername').value='';
		document.getElementById("indexhidden").style.display="none";
		document.getElementById("commentindex").value='';
		document.getElementById("commentyanzheng").style.display="";
	}else{
		document.getElementById('commentusername').disabled=true;
		document.getElementById('commentusername').value="";
		document.getElementById("indexhidden").style.display="";
		
document.getElementById("commentindex").value="http://.blog.51cto.com";
		if(memberid>8)
		{
			document.getElementById("commentyanzheng").style.display="none";
		}
	}
	}
	function openFavoulist()
	{
		window.open 
('http://blog.51cto.com/mod/favourlist.php?tid=1229261','newwindow','height=300,width=500,top=400,left=400,toolbar=no,menubar=no,scrollbars=no,
 resizable=no,location=no, status=no,z-look=yes');
	}

	var e_zti = document.getElementById('zti');//有专题锚点
	var maodian = window.location.href;//锚点
	if (e_zti) {
		//e_zti.href= (/[#]+/.test(maodian)) ? maodian : maodian + "#zhuanti";
	}
</script>
<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/jquery-1.js"></script>
<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/jquery_002.js"></script>
<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/jquery.js"></script>
<link href="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/blog_top.css" rel="stylesheet" type="text/css">
<!-- <script src="http://blog.51cto.com/js/blog_top_list.php" type="text/javascript" language="javascript"></script> -->
<script type="text/javascript" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/edu_search.js"></script>
<!--<div id="message" class="blogpop" style="background-color:#FFFFFF;z-index:100;width:389px;height:196px;position:absolute; display:none; bottom:0; top:'document.documentElement.scrollTop + document.documentElement.clientHeight-196+'px;right:0; overflow:hidden;"><iframe style="width:800px;height:536px;top:0px;left:0px;position:absolute;visibility:inherit;z-index:-1;" frameborder=0 ></iframe>-->
<!--<div style="height:36px;background:url(http://blog.51cto.com/image/blog_top/popbgx.jpg) repeat-x; position:relative;width:387px;border-right-color:#2668B7;border-right-width:2px;border-right-style:solid 2px #2668B7;"><span style="right:10px;padding:12px 0 0;position:absolute;top:0"><span style="margin-right:80px;color:#828282;width:190px;padding:10px 0 0 10px;font-size:14px">每日博报 精彩不止一点</span><img title="关闭" id="message_close" src="http://blog.51cto.com/image/blog_top/close.jpg" alt="关闭" /></span><div style="width:387px;height:36px;left:0;overflow:hidden; text-indent:-999em;background:url(http://blog.51cto.com/image/blog_top/hdtit.jpg) no-repeat;border-right:solid 2px #2668B7;"><a style="display: block; height: 36px;width:138px;" target="_blank" href="http://blog.51cto.com"></a>-->
<!--</div>-->
<!--<div style="clear:both;"></div>-->
<!--</div>-->
	<!--<div id="message_content" style="border-top:none;font-family:Microsoft YaHei;font-size:12px;width:389px;height:160pxpx;text-align:left;overflow:hidden;">-->
	<!--<script type='text/javascript'>&lt;!&ndash;//<![CDATA[-->
	   <!--var m3_u = (location.protocol=='https:'?'https://gg.51cto.com/www/delivery/ajs.php':'http://gg3.51cto.com/www/delivery/ajs.php');-->
	   <!--var m3_r = Math.floor(Math.random()*99999999999);-->
	   <!--if (!document.MAX_used) document.MAX_used = ',';-->
	   <!--document.write ("<scr"+"ipt type='text/javascript' src='"+m3_u);-->
	   <!--document.write ("?zoneid=454");-->
	   <!--document.write ('&amp;cb=' + m3_r);-->
	   <!--if (document.MAX_used != ',') document.write ("&amp;exclude=" + document.MAX_used);-->
	   <!--document.write (document.charset ? '&amp;charset='+document.charset : (document.characterSet ? '&amp;charset='+document.characterSet : ''));-->
	   <!--document.write ("&amp;loc=" + escape(window.location));-->
	   <!--if (document.referrer) document.write ("&amp;referer=" + escape(document.referrer));-->
	   <!--if (document.context) document.write ("&context=" + escape(document.context));-->
	   <!--if (document.mmm_fo) document.write ("&amp;mmm_fo=1");-->
	   <!--document.write ("'><\/scr"+"ipt>");-->
	<!--//]]>&ndash;&gt;</script>-->
	<!--</div>-->
<!--</div>-->
<style>
.backToTop {
    display: none;
	WIDTH: 45px;
	height:45px;
	BOTTOM: 20px;
     position: fixed;
    _position: absolute;
    right: 140px;
    bottom: 10px;
    _bottom: "auto";
    cursor: pointer;
    opacity: .6;
    filter: Alpha(opacity=60);
	text-indent:-9999px;
}
.tops { background:url(/images/tops.jpg) no-repeat center center; }
</style>
<script>
(function() {
	  $('#showMessagerDim').show();
	   var _html = $("#addTop").html();
	  if(get_cookie('blog_top')==''){
//		 show_pop();
	     jQuery.messager.showblogtop('', _html);
	     $("#message").find("#adTop").show();
	     var date=new Date();
	     var test = date.getTime();
	     document.cookie="blog_top=yes;domain=.blog.51cto.com;expires="+date.toGMTString()+";path=/;";
	     }
	    $("#showMessagerDim").click(function(){
	    	jQuery.messager.showblogtop('', _html);
			$("#message").find("#adTop").show();
			//removeIframe();
		});

		function get_cookie(Name) {
		    var search = Name + "=";
		    var returnvalue = "";
		    if (document.cookie.length > 0) {
		        offset = document.cookie.indexOf(search);
		        if (offset != -1) {
		            offset += search.length;

		            end1 = document.cookie.indexOf(";", offset);

		            if (end1 == -1)
		            end1 = document.cookie.length;
		            returnvalue=unescape(document.cookie.substring(offset, end1));
		        }
		    }
		    return returnvalue;
		}
	})();

</script>
<script type="text/javascript">
(function() {
    var backToTopTxt = "返回顶部", backToTopEle = $('<div class="backToTop tops"></div>').appendTo($("body"))
        .text(backToTopTxt).attr("title", backToTopTxt).click(function() {
            $("html, body").animate({ scrollTop: 0 }, 520);
    }), backToTopFun = function() {
        var st = $(document).scrollTop(), winh = $(window).height();
        (st > 0)? backToTopEle.show(): backToTopEle.hide();
        //IE6下的定位
        if (!window.XMLHttpRequest) {
            backToTopEle.css("top", st + winh - 60);
        }
    };
    $(window).bind("scroll", backToTopFun);
    $(function() { backToTopFun(); });
})();
</script><div class="backToTop tops" title="返回顶部" style="display: block;">返回顶部</div>








<div class="clear"></div>
<!-- <script>
jQuery(function(){
	var html= "<div id=\"sogou_se_tgbar\" style=\"text-align:center;margin:0px auto 2px auto;clear:both;background:url(http://home.51cto.com/public/images/notice/sogou_se_tgbar_bg_final1.gif) repeat-x;width:950px;color:#000;font-size:13px;height:36px;z-index:21474836471\"><div style=\"float:left;cursor:pointer;width:910px;text-align:center;border-left:solid #efbf00 1px;height:32px; line-height:32px;txt-align:center;\"><span style=\"\">	<a href=\"http://51ctoblog.blog.51cto.com/26414/1093282\">【新年祝福征集】51CTO社区年底嘉年华活动正在征集博主祝福语，祝福以红包的形式随机的赠送给访问51CTO的网友 点此送祝福>></a></span></div><div onclick=\"document.getElementById('sogou_se_tgbar').style.display = 'none';\" style=\"float:right;width:20px;cursor:pointer;height:28px;padding:4px 8px 0px 8px;border-right:solid #efbf00 1px\"><img style=\"border:none;margin:4px 0px 0px 0px;\" src=\"http://home.51cto.com/public/images/notice/sogou_se_tgbar_close_final1.gif\"></div></div>"
	jQuery('body').prepend(html);
})
</script> -->

<style>
    .fixexit_small {
        bottom: 185px;
        position: fixed;
        right: 10px;
        z-index: 99;
    }
    .fixexit_small .exit_list {
        margin-top: 4px;
    }
    .fixexit_small .exit_list .ina {
        border-radius: 5px;
        display: block;
        height: 40px;
        text-align: center;
        width: 40px;
    }
    .fixexit_small .exit_list .ina b {
        color: #fff;
        cursor: pointer;
        display: inline-block;
        font-size: 12px;
        font-weight: normal;
        line-height: 15px;
        padding-top: 5px;
        text-align: center;
    }
    .fixexit_small .exit_list_fkui .ina {
        background: #40afff none repeat scroll 0 0;
    }
    .fixexit_small .exit_list_fkui .ina:hover {
        background: #2ea7ff none repeat scroll 0 0;
    }
    .fixexit_small .exit_list_zxun .ina {
        background: #c1c1c1 url("./images/anchor_qq.png") no-repeat scroll 9px 9px;
    }
    .fixexit_small .exit_list_zxun .ina:hover {
        background: #40afff url("./images/anchor_qq.png") no-repeat scroll 9px 9px;
    }
    .fixexit_small .exit_list_zxun .ina img {
        height: 18px;
        width: 18px;
    }
    .fixexit_small .exit_list_gaozhao .ina {
        background: #c1c1c1 url("./images/gaozhao.jpg")  no-repeat center center;
    }
    .fixexit_small .exit_list_gaozhao .ina:hover {
        background: #40afff url("./images/gaozhao.jpg")  no-repeat center center;
    }
    .fixexit_small .exit_list_gaozhao .ina img {
        height: 18px;
        width: 18px;
    }
    .fixexit_small .exit_list_back {
        bottom: 0;
        display: none;
        left: 0;
        position: absolute;
    }
    .fixexit_small .exit_list_back .ina {
        background: #c1c1c1 url("./images/anchor_top.png") no-repeat scroll 10px 12px;
    }
    .fixexit_small .exit_list_back .ina:hover {
        background: #40afff none repeat scroll 0 0;
    }
    .fixexit_small .exit_list_back .ina b {
        display: none;
    }
    .fixexit_small .exit_list_back .ina:hover b {
        display: block;
    }

</style>
<div class="fixexit_small">
    <div class="infixexit" style="font-family: &quot;微软雅黑&quot;">
        <div class="exit_list exit_list_zxun"><a href="http://wpa.qq.com/msgrd?v=3&amp;uin=1173854158&amp;site=qq&amp;menu=yes" class="ina" target="_blank"></a></div>
        <div class="exit_list exit_list_fkui "><span class="ina"><a href="http://51ctoblog.blog.51cto.com/26414/1933645"><b>意见<br>反馈</b></a></span></div>
        <div class="exit_list  exit_list_gaozhao"><a href="http://51ctoblog.blog.51cto.com/" target="_black" class="ina"></a></div>

    </div>
</div>
<div id="footer">
  <div id="innerFooter">
	<center>
		<small>
			Copyright By 51CTO.COM 版权所有<br><br>
			<a href="http://blog.51cto.com/" target="_blank"><img src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/copyright.jpg"></a>
	  </small>
	</center>
  </div>
</div>
<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/index.htm" charset="utf-8"></script><script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/vip_top.js"></script>
<div style="display:none">
<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/count.js"></script><script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/count.htm"></script>
<div style="display:none">
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?2283d46608159c3b39fc9f1178809c21";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
    <script type="text/javascript">
        var uid = "";
        var _educto = _educto || [];
        _educto.push(['_setUserId',uid]);
    </script>

    <script type="text/javascript">
        document.write(decodeURI("%3Cscript 
src='https://tongji.51cto.com/cto.js/d2cb9d6ccefce8d1e89582c2a2a24cc0' 
type='text/javascript'%3E%3C/script%3E"));
        function bdmsPoint(behavior,method){
            _educto.push(['_trackEvent', behavior, method])
        }
        $(function(){
            $(".bdms_point").click(function(){
                
bdmsPoint($(this).attr("data-behavior"),$(this).attr("data-method"));
            })
        })
    </script><script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/d2cb9d6ccefce8d1e89582c2a2a24cc0.htm" type="text/javascript"></script>


</div>
<iframe scrolling="no" src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/pageview.htm" width="0" height="0" frameborder="0"></iframe>
</div>

<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/poptop.js"></script>
<script src="Android%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%9A%84%E7%BC%96%E8%AF%91%E5%92%8C%E6%89%93%E5%8C%85%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90%20-%20%E8%80%81%E7%BD%97%E7%9A%84Android%E4%B9%8B%E6%97%85%20-%2051CTO%E6%8A%80%E6%9C%AF%E5%8D%9A%E5%AE%A2_files/iframe-member-adv.htm"></script>


</body></html>